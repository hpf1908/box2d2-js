function extend(a,c){for(var b in c)a[b]=c[b]};var b2Settings=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Settings.prototype.__constructor=function(){};b2Settings.prototype.__varz=function(){};b2Settings.USHRT_MAX=65535;b2Settings.b2_pi=Math.PI;b2Settings.b2_maxManifoldPoints=2;b2Settings.b2_maxPolygonVertices=8;b2Settings.b2_maxProxies=512;b2Settings.b2_maxPairs=8*b2Settings.b2_maxProxies;b2Settings.b2_linearSlop=0.0050;b2Settings.b2_angularSlop=2/180*b2Settings.b2_pi;b2Settings.b2_toiSlop=8*b2Settings.b2_linearSlop;
b2Settings.b2_maxTOIContactsPerIsland=32;b2Settings.b2_velocityThreshold=1;b2Settings.b2_maxLinearCorrection=0.2;b2Settings.b2_maxAngularCorrection=8/180*b2Settings.b2_pi;b2Settings.b2_maxLinearVelocity=200;b2Settings.b2_maxLinearVelocitySquared=b2Settings.b2_maxLinearVelocity*b2Settings.b2_maxLinearVelocity;b2Settings.b2_maxAngularVelocity=250;b2Settings.b2_maxAngularVelocitySquared=b2Settings.b2_maxAngularVelocity*b2Settings.b2_maxAngularVelocity;b2Settings.b2_contactBaumgarte=0.2;
b2Settings.b2_timeToSleep=0.5;b2Settings.b2_linearSleepTolerance=0.01;b2Settings.b2_angularSleepTolerance=2/180;b2Settings.b2Assert=function(a){a||(void 0).x++};var b2Vec2=function(a,c){if(arguments.length==2)this.x=a,this.y=c};b2Vec2.Make=function(a,c){return new b2Vec2(a,c)};b2Vec2.prototype.x=0;b2Vec2.prototype.y=0;b2Vec2.prototype.SetZero=function(){this.y=this.x=0};b2Vec2.prototype.Set=function(a,c){this.x=a;this.y=c};b2Vec2.prototype.SetV=function(a){this.x=a.x;this.y=a.y};b2Vec2.prototype.Negative=function(){return new b2Vec2(-this.x,-this.y)};b2Vec2.prototype.Copy=function(){return new b2Vec2(this.x,this.y)};
b2Vec2.prototype.Add=function(a){this.x+=a.x;this.y+=a.y};b2Vec2.prototype.Subtract=function(a){this.x-=a.x;this.y-=a.y};b2Vec2.prototype.Multiply=function(a){this.x*=a;this.y*=a};b2Vec2.prototype.MulM=function(a){var c=this.x;this.x=a.col1.x*c+a.col2.x*this.y;this.y=a.col1.y*c+a.col2.y*this.y};b2Vec2.prototype.MulTM=function(a){var c=b2Math.b2Dot(this,a.col1);this.y=b2Math.b2Dot(this,a.col2);this.x=c};b2Vec2.prototype.CrossVF=function(a){var c=this.x;this.x=a*this.y;this.y=-a*c};
b2Vec2.prototype.CrossFV=function(a){var c=this.x;this.x=-a*this.y;this.y=a*c};b2Vec2.prototype.MinV=function(a){this.x=this.x<a.x?this.x:a.x;this.y=this.y<a.y?this.y:a.y};b2Vec2.prototype.MaxV=function(a){this.x=this.x>a.x?this.x:a.x;this.y=this.y>a.y?this.y:a.y};b2Vec2.prototype.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};b2Vec2.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};
b2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};b2Vec2.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Number.MIN_VALUE)return 0;var c=1/a;this.x*=c;this.y*=c;return a};b2Vec2.prototype.IsValid=function(){return b2Math.b2IsValid(this.x)&&b2Math.b2IsValid(this.y)};
extend(b2Vec2.prototype,{clone:function(){return new b2Vec2(this.x,this.y)},set:function(a){this.x=a.x;this.y=a.y;return this},add:function(a){this.x+=a.x;this.y+=a.y;return this},sub:function(a){this.x-=a.x;this.y-=a.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},projection:function(a){return a.clone().norm().scale(this.clone().dot(a)/a.length())},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},distance:function(a){var c=this.x-a.x,a=this.y-a.y;return Math.sqrt(c*c+
a*a)},distance2:function(a){var c=this.x-a.x,a=this.y-a.y;return c*c+a*a},theta:function(){return Math.atan2(this.y,this.x)},thetaTo:function(a){var c=this.clone().norm(),a=a.clone().norm();return Math.acos(c.dot(a))},thetaTo2:function(a){return Math.atan2(a.y,a.x)-Math.atan2(this.y,this.x)},norm:function(){var a=this.length();if(a==0)return this;this.x/=a;this.y/=a;return this},rotate:function(a){var c=Math.cos(a),a=Math.sin(a);with(this)x=x*c-y*a,y=x*a+y*c;return this},invert:function(){this.x=
-this.x;this.y=-this.y;return this},scale:function(a){this.x*=a;this.y*=a;return this},x:null,y:null});var b2BufferedPair=function(){this.__varz();this.__constructor.apply(this,arguments)};b2BufferedPair.prototype.__constructor=function(){};b2BufferedPair.prototype.__varz=function(){};b2BufferedPair.prototype.proxyId1=0;b2BufferedPair.prototype.proxyId2=0;var b2AABB=function(){this.__varz();this.__constructor.apply(this,arguments)};b2AABB.prototype.__constructor=function(){};b2AABB.prototype.__varz=function(){this.lowerBound=new b2Vec2;this.upperBound=new b2Vec2};b2AABB.prototype.lowerBound=new b2Vec2;b2AABB.prototype.upperBound=new b2Vec2;b2AABB.prototype.IsValid=function(){var a=this.upperBound.y-this.lowerBound.y;return a=(a=this.upperBound.x-this.lowerBound.x>=0&&a>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};var b2Pair=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Pair.prototype.__constructor=function(){};b2Pair.prototype.__varz=function(){};b2Pair.b2_nullPair=b2Settings.USHRT_MAX;b2Pair.b2_nullProxy=b2Settings.USHRT_MAX;b2Pair.b2_tableCapacity=b2Settings.b2_maxPairs;b2Pair.b2_tableMask=b2Pair.b2_tableCapacity-1;b2Pair.e_pairBuffered=1;b2Pair.e_pairRemoved=2;b2Pair.e_pairFinal=4;b2Pair.prototype.userData=null;b2Pair.prototype.proxyId1=0;b2Pair.prototype.proxyId2=0;
b2Pair.prototype.next=0;b2Pair.prototype.status=0;b2Pair.prototype.SetBuffered=function(){this.status|=b2Pair.e_pairBuffered};b2Pair.prototype.ClearBuffered=function(){this.status&=~b2Pair.e_pairBuffered};b2Pair.prototype.IsBuffered=function(){return(this.status&b2Pair.e_pairBuffered)==b2Pair.e_pairBuffered};b2Pair.prototype.SetRemoved=function(){this.status|=b2Pair.e_pairRemoved};b2Pair.prototype.ClearRemoved=function(){this.status&=~b2Pair.e_pairRemoved};
b2Pair.prototype.IsRemoved=function(){return(this.status&b2Pair.e_pairRemoved)==b2Pair.e_pairRemoved};b2Pair.prototype.SetFinal=function(){this.status|=b2Pair.e_pairFinal};b2Pair.prototype.IsFinal=function(){return(this.status&b2Pair.e_pairFinal)==b2Pair.e_pairFinal};var b2TimeStep=function(){this.__varz();this.__constructor.apply(this,arguments)};b2TimeStep.prototype.__constructor=function(){};b2TimeStep.prototype.__varz=function(){};b2TimeStep.prototype.dt=null;b2TimeStep.prototype.inv_dt=null;b2TimeStep.prototype.dtRatio=null;b2TimeStep.prototype.maxIterations=0;b2TimeStep.prototype.warmStarting=null;b2TimeStep.prototype.positionCorrection=null;var b2Manifold=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Manifold.prototype.__constructor=function(){this.points=Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.points[a]=new b2ManifoldPoint;this.normal=new b2Vec2};b2Manifold.prototype.__varz=function(){};b2Manifold.prototype.points=null;b2Manifold.prototype.normal=null;b2Manifold.prototype.pointCount=0;
b2Manifold.prototype.Reset=function(){for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.points[a].Reset();this.normal.SetZero();this.pointCount=0};b2Manifold.prototype.Set=function(a){this.pointCount=a.pointCount;for(var c=0;c<b2Settings.b2_maxManifoldPoints;c++)this.points[c].Set(a.points[c]);this.normal.SetV(a.normal)};var b2Point=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Point.prototype.__constructor=function(){};b2Point.prototype.__varz=function(){this.p=new b2Vec2};b2Point.prototype.p=new b2Vec2;b2Point.prototype.Support=function(){return this.p};b2Point.prototype.GetFirstVertex=function(){return this.p};var b2Bound=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Bound.prototype.__constructor=function(){};b2Bound.prototype.__varz=function(){};b2Bound.prototype.value=0;b2Bound.prototype.proxyId=0;b2Bound.prototype.stabbingCount=0;b2Bound.prototype.IsLower=function(){return(this.value&1)==0};b2Bound.prototype.IsUpper=function(){return(this.value&1)==1};
b2Bound.prototype.Swap=function(a){var c=this.value,b=this.proxyId,d=this.stabbingCount;this.value=a.value;this.proxyId=a.proxyId;this.stabbingCount=a.stabbingCount;a.value=c;a.proxyId=b;a.stabbingCount=d};var b2Mat22=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Mat22.prototype.__constructor=function(a,c,b){c!=null&&b!=null?(this.col1.SetV(c),this.col2.SetV(b)):(c=Math.cos(a),a=Math.sin(a),this.col1.x=c,this.col2.x=-a,this.col1.y=a,this.col2.y=c)};b2Mat22.prototype.__varz=function(){this.col1=new b2Vec2;this.col2=new b2Vec2};b2Mat22.prototype.col1=new b2Vec2;b2Mat22.prototype.col2=new b2Vec2;
b2Mat22.prototype.Set=function(a){var c=Math.cos(a),a=Math.sin(a);this.col1.x=c;this.col2.x=-a;this.col1.y=a;this.col2.y=c};b2Mat22.prototype.SetVV=function(a,c){this.col1.SetV(a);this.col2.SetV(c)};b2Mat22.prototype.Copy=function(){return new b2Mat22(0,this.col1,this.col2)};b2Mat22.prototype.SetM=function(a){this.col1.SetV(a.col1);this.col2.SetV(a.col2)};b2Mat22.prototype.AddM=function(a){this.col1.x+=a.col1.x;this.col1.y+=a.col1.y;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y};
b2Mat22.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};b2Mat22.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};b2Mat22.prototype.Invert=function(a){var c=this.col1.x,b=this.col2.x,d=this.col1.y,e=this.col2.y,f;f=1/(c*e-b*d);a.col1.x=f*e;a.col2.x=-f*b;a.col1.y=-f*d;a.col2.y=f*c;return a};
b2Mat22.prototype.Solve=function(a,c,b){var d=this.col1.x,e=this.col2.x,f=this.col1.y,g=this.col2.y,h;h=1/(d*g-e*f);a.x=h*(g*c-e*b);a.y=h*(d*b-f*c);return a};b2Mat22.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};var b2BoundaryListener=function(){this.__varz();this.__constructor.apply(this,arguments)};b2BoundaryListener.prototype.__constructor=function(){};b2BoundaryListener.prototype.__varz=function(){};b2BoundaryListener.prototype.Violation=function(){};var b2MassData=function(){this.__varz();this.__constructor.apply(this,arguments)};b2MassData.prototype.__constructor=function(){};b2MassData.prototype.__varz=function(){this.center=new b2Vec2(0,0)};b2MassData.prototype.mass=0;b2MassData.prototype.center=new b2Vec2(0,0);b2MassData.prototype.I=0;var b2JointEdge=function(){this.__varz();this.__constructor.apply(this,arguments)};b2JointEdge.prototype.__constructor=function(){};b2JointEdge.prototype.__varz=function(){};b2JointEdge.prototype.other=null;b2JointEdge.prototype.joint=null;b2JointEdge.prototype.prev=null;b2JointEdge.prototype.next=null;var b2Collision=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Collision.prototype.__constructor=function(){};b2Collision.prototype.__varz=function(){};b2Collision.b2_nullFeature=255;b2Collision.b2CollidePolyTempVec=new b2Vec2;
b2Collision.ClipSegmentToLine=function(a,c,b,d){var e,f=0;e=c[0];var g=e.v;e=c[1];var h=e.v,i=b2Math.b2Dot(b,g)-d;e=b2Math.b2Dot(b,h)-d;i<=0&&(a[f++]=c[0]);e<=0&&(a[f++]=c[1]);if(i*e<0)b=i/(i-e),e=a[f],e=e.v,e.x=g.x+b*(h.x-g.x),e.y=g.y+b*(h.y-g.y),e=a[f],e.id=(i>0?c[0]:c[1]).id,++f;return f};
b2Collision.EdgeSeparation=function(a,c,b,d,e){var f=a.m_vertices,a=a.m_normals,g=d.m_vertexCount,h=d.m_vertices,i,j;i=c.R;j=a[b];a=i.col1.x*j.x+i.col2.x*j.y;d=i.col1.y*j.x+i.col2.y*j.y;i=e.R;var k=i.col1.x*a+i.col1.y*d;i=i.col2.x*a+i.col2.y*d;for(var l=0,m=Number.MAX_VALUE,n=0;n<g;++n)j=h[n],j=j.x*k+j.y*i,j<m&&(m=j,l=n);j=f[b];i=c.R;b=c.position.x+(i.col1.x*j.x+i.col2.x*j.y);c=c.position.y+(i.col1.y*j.x+i.col2.y*j.y);j=h[l];i=e.R;f=e.position.x+(i.col1.x*j.x+i.col2.x*j.y);e=e.position.y+(i.col1.y*
j.x+i.col2.y*j.y);f-=b;e-=c;return f*a+e*d};
b2Collision.FindMaxSeparation=function(a,c,b,d,e){var f=c.m_vertexCount,g=c.m_normals,h,i;i=e.R;h=d.m_centroid;var j=e.position.x+(i.col1.x*h.x+i.col2.x*h.y),k=e.position.y+(i.col1.y*h.x+i.col2.y*h.y);i=b.R;h=c.m_centroid;j-=b.position.x+(i.col1.x*h.x+i.col2.x*h.y);k-=b.position.y+(i.col1.y*h.x+i.col2.y*h.y);i=j*b.R.col1.x+k*b.R.col1.y;for(var k=j*b.R.col2.x+k*b.R.col2.y,j=0,l=-Number.MAX_VALUE,m=0;m<f;++m)h=g[m],h=h.x*i+h.y*k,h>l&&(l=h,j=m);g=b2Collision.EdgeSeparation(c,b,j,d,e);if(g>0)return g;
k=j-1>=0?j-1:f-1;l=b2Collision.EdgeSeparation(c,b,k,d,e);if(l>0)return l;var m=j+1<f?j+1:0,n=b2Collision.EdgeSeparation(c,b,m,d,e);if(n>0)return n;i=h=0;if(l>g&&l>n)i=-1,h=k,k=l;else if(n>g)i=1,h=m,k=n;else return a[0]=j,g;for(;;){j=i==-1?h-1>=0?h-1:f-1:h+1<f?h+1:0;g=b2Collision.EdgeSeparation(c,b,j,d,e);if(g>0)return g;if(g>k)h=j,k=g;else break}a[0]=h;return k};
b2Collision.FindIncidentEdge=function(a,c,b,d,e,f){var g=c.m_normals,h=e.m_vertexCount,c=e.m_vertices,e=e.m_normals,i;i=b.R;var b=g[d],g=i.col1.x*b.x+i.col2.x*b.y,j=i.col1.y*b.x+i.col2.y*b.y;i=f.R;b=i.col1.x*g+i.col1.y*j;j=i.col2.x*g+i.col2.y*j;g=b;i=0;for(var k=Number.MAX_VALUE,l=0;l<h;++l)b=e[l],b=g*b.x+j*b.y,b<k&&(k=b,i=l);e=i;g=e+1<h?e+1:0;h=a[0];b=c[e];i=f.R;h.v.x=f.position.x+(i.col1.x*b.x+i.col2.x*b.y);h.v.y=f.position.y+(i.col1.y*b.x+i.col2.y*b.y);h.id.features.referenceEdge=d;h.id.features.incidentEdge=
e;h.id.features.incidentVertex=0;h=a[1];b=c[g];i=f.R;h.v.x=f.position.x+(i.col1.x*b.x+i.col2.x*b.y);h.v.y=f.position.y+(i.col1.y*b.x+i.col2.y*b.y);h.id.features.referenceEdge=d;h.id.features.incidentEdge=g;h.id.features.incidentVertex=1};
b2Collision.b2CollidePolygons=function(a,c,b,d,e){a.pointCount=0;var f,g=[0],h=b2Collision.FindMaxSeparation(g,c,b,d,e);f=g[0];if(!(h>0)){var i,g=[0],j=b2Collision.FindMaxSeparation(g,d,e,c,b);i=g[0];if(!(j>0)){var k=new b2XForm,l=new b2XForm,m=0,g=0;j>0.98*h+0.0010?(h=d,d=c,k.Set(e),l.Set(b),m=i,g=1):(h=c,k.Set(b),l.Set(e),m=f,g=0);c=[new ClipVertex,new ClipVertex];b2Collision.FindIncidentEdge(c,h,k,m,d,l);f=h.m_vertexCount;l=h.m_vertices;h=l[m];d=h.Copy();h=m+1<f?l[parseInt(m+1)]:l[0];h=h.Copy();
b2Math.SubtractVV(h,d);f=b2Math.b2MulMV(k.R,b2Math.SubtractVV(h,d));f.Normalize();m=b2Math.b2CrossVF(f,1);d=b2Math.b2MulX(k,d);h=b2Math.b2MulX(k,h);k=b2Math.b2Dot(m,d);l=-b2Math.b2Dot(f,d);h=b2Math.b2Dot(f,h);i=[new ClipVertex,new ClipVertex];d=[new ClipVertex,new ClipVertex];j=0;j=b2Collision.ClipSegmentToLine(i,c,f.Negative(),l);if(!(j<2)&&(j=b2Collision.ClipSegmentToLine(d,i,f,h),!(j<2))){a.normal=g?m.Negative():m.Copy();for(l=f=0;l<b2Settings.b2_maxManifoldPoints;++l)if(c=d[l],h=b2Math.b2Dot(m,
c.v)-k,h<=0)i=a.points[f],i.separation=h,i.localPoint1=b2Math.b2MulXT(b,c.v),i.localPoint2=b2Math.b2MulXT(e,c.v),i.id.key=c.id._key,i.id.features.flip=g,++f;a.pointCount=f}}}};
b2Collision.b2CollideCircles=function(a,c,b,d,e){a.pointCount=0;var f,g;f=b.R;g=c.m_localPosition;var h=b.position.x+(f.col1.x*g.x+f.col2.x*g.y),i=b.position.y+(f.col1.y*g.x+f.col2.y*g.y);f=e.R;g=d.m_localPosition;var j=e.position.x+(f.col1.x*g.x+f.col2.x*g.y);f=e.position.y+(f.col1.y*g.x+f.col2.y*g.y);g=j-h;var k=f-i,l=g*g+k*k,c=c.m_radius,d=d.m_radius,m=c+d;if(!(l>m*m)){if(l<Number.MIN_VALUE)l=-m,a.normal.Set(0,1);else{var n=Math.sqrt(l),l=n-m,m=1/n;a.normal.x=m*g;a.normal.y=m*k}a.pointCount=1;
g=a.points[0];g.id.key=0;g.separation=l;h+=c*a.normal.x;i+=c*a.normal.y;j-=d*a.normal.x;f-=d*a.normal.y;a=0.5*(h+j);i=0.5*(i+f);h=a-b.position.x;j=i-b.position.y;g.localPoint1.x=h*b.R.col1.x+j*b.R.col1.y;g.localPoint1.y=h*b.R.col2.x+j*b.R.col2.y;h=a-e.position.x;j=i-e.position.y;g.localPoint2.x=h*e.R.col1.x+j*e.R.col1.y;g.localPoint2.y=h*e.R.col2.x+j*e.R.col2.y}};
b2Collision.b2CollidePolygonAndCircle=function(a,c,b,d,e){a.pointCount=0;var f,g,h,i,j,k;k=e.R;j=d.m_localPosition;i=e.position.x+(k.col1.x*j.x+k.col2.x*j.y);var l=e.position.y+(k.col1.y*j.x+k.col2.y*j.y);g=i-b.position.x;h=l-b.position.y;k=b.R;var m=g*k.col1.x+h*k.col1.y;k=g*k.col2.x+h*k.col2.y;var n=0,o=-Number.MAX_VALUE,d=d.m_radius,p=c.m_vertexCount;f=c.m_vertices;for(var c=c.m_normals,q=0;q<p;++q){j=f[q];g=m-j.x;h=k-j.y;j=c[q];g=j.x*g+j.y*h;if(g>d)return;g>o&&(o=g,n=q)}if(o<Number.MIN_VALUE)a.pointCount=
1,j=c[n],k=b.R,a.normal.x=k.col1.x*j.x+k.col2.x*j.y,a.normal.y=k.col1.y*j.x+k.col2.y*j.y,f=a.points[0],f.id.features.incidentEdge=n,f.id.features.incidentVertex=b2Collision.b2_nullFeature,f.id.features.referenceEdge=0,f.id.features.flip=0,i-=d*a.normal.x,a=l-d*a.normal.y,g=i-b.position.x,h=a-b.position.y,k=b.R,f.localPoint1.x=g*k.col1.x+h*k.col1.y,f.localPoint1.y=g*k.col2.x+h*k.col2.y,g=i-e.position.x,h=a-e.position.y,k=e.R,f.localPoint2.x=g*k.col1.x+h*k.col1.y,f.localPoint2.y=g*k.col2.x+h*k.col2.y,
f.separation=o-d;else{o=n;p=o+1<p?o+1:0;j=f[o];var c=f[p],s=c.x-j.x,q=c.y-j.y,w=Math.sqrt(s*s+q*q);s/=w;q/=w;g=m-j.x;h=k-j.y;g=g*s+h*q;f=a.points[0];g<=0?(h=j.x,j=j.y,f.id.features.incidentEdge=b2Collision.b2_nullFeature,f.id.features.incidentVertex=o):g>=w?(h=c.x,j=c.y,f.id.features.incidentEdge=b2Collision.b2_nullFeature,f.id.features.incidentVertex=p):(h=s*g+j.x,j=q*g+j.y,f.id.features.incidentEdge=n,f.id.features.incidentVertex=b2Collision.b2_nullFeature);g=m-h;h=k-j;m=Math.sqrt(g*g+h*h);g/=m;
h/=m;if(!(m>d))a.pointCount=1,k=b.R,a.normal.x=k.col1.x*g+k.col2.x*h,a.normal.y=k.col1.y*g+k.col2.y*h,i-=d*a.normal.x,a=l-d*a.normal.y,g=i-b.position.x,h=a-b.position.y,k=b.R,f.localPoint1.x=g*k.col1.x+h*k.col1.y,f.localPoint1.y=g*k.col2.x+h*k.col2.y,g=i-e.position.x,h=a-e.position.y,k=e.R,f.localPoint2.x=g*k.col1.x+h*k.col1.y,f.localPoint2.y=g*k.col2.x+h*k.col2.y,f.separation=m-d,f.id.features.referenceEdge=0,f.id.features.flip=0}};
b2Collision.b2TestOverlap=function(a,c){var b=c.lowerBound,d=a.upperBound,e=b.x-d.x,f=b.y-d.y,b=a.lowerBound,d=c.upperBound,g=b.y-d.y;return e>0||f>0?!1:b.x-d.x>0||g>0?!1:!0};var b2ContactListener=function(){this.__varz();this.__constructor.apply(this,arguments)};b2ContactListener.prototype.__constructor=function(){};b2ContactListener.prototype.__varz=function(){};b2ContactListener.prototype.Add=function(){};b2ContactListener.prototype.Persist=function(){};b2ContactListener.prototype.Remove=function(){};b2ContactListener.prototype.Result=function(){};var b2PairCallback=function(){this.__varz();this.__constructor.apply(this,arguments)};b2PairCallback.prototype.__constructor=function(){};b2PairCallback.prototype.__varz=function(){};b2PairCallback.prototype.PairAdded=function(){return null};b2PairCallback.prototype.PairRemoved=function(){};var b2JointDef=function(){this.__varz();this.__constructor.apply(this,arguments)};b2JointDef.prototype.__constructor=function(){this.type=b2Joint.e_unknownJoint;this.body2=this.body1=this.userData=null;this.collideConnected=!1};b2JointDef.prototype.__varz=function(){};b2JointDef.prototype.type=0;b2JointDef.prototype.userData=null;b2JointDef.prototype.body1=null;b2JointDef.prototype.body2=null;b2JointDef.prototype.collideConnected=null;var b2Proxy=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Proxy.prototype.__constructor=function(){};b2Proxy.prototype.__varz=function(){this.lowerBounds=[0,0];this.upperBounds=[0,0]};b2Proxy.prototype.lowerBounds=[0,0];b2Proxy.prototype.upperBounds=[0,0];b2Proxy.prototype.overlapCount=0;b2Proxy.prototype.timeStamp=0;b2Proxy.prototype.userData=null;b2Proxy.prototype.GetNext=function(){return this.lowerBounds[0]};b2Proxy.prototype.SetNext=function(a){this.lowerBounds[0]=a%65535};
b2Proxy.prototype.IsValid=function(){return this.overlapCount!=b2BroadPhase.b2_invalid};var b2Color=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Color.prototype.__constructor=function(a,c,b){this._r=parseInt(255*b2Math.b2Clamp(a,0,1));this._g=parseInt(255*b2Math.b2Clamp(c,0,1));this._b=parseInt(255*b2Math.b2Clamp(b,0,1))};b2Color.prototype.__varz=function(){};b2Color.prototype._r=0;b2Color.prototype._g=0;b2Color.prototype._b=0;
b2Color.prototype.Set=function(a,c,b){this._r=parseInt(255*b2Math.b2Clamp(a,0,1));this._g=parseInt(255*b2Math.b2Clamp(c,0,1));this._b=parseInt(255*b2Math.b2Clamp(b,0,1))};b2Color.prototype.set=function(a){this._r=parseInt(255*b2Math.b2Clamp(a,0,1))};b2Color.prototype.set=function(a){this._g=parseInt(255*b2Math.b2Clamp(a,0,1))};b2Color.prototype.set=function(a){this._b=parseInt(255*b2Math.b2Clamp(a,0,1))};b2Color.prototype.get=function(){return this._r|this._g<<8|this._b<<16};var b2FilterData=function(){this.__varz();this.__constructor.apply(this,arguments)};b2FilterData.prototype.__constructor=function(){};b2FilterData.prototype.__varz=function(){this.categoryBits=1;this.maskBits=65535};b2FilterData.prototype.categoryBits=1;b2FilterData.prototype.maskBits=65535;b2FilterData.prototype.groupIndex=0;b2FilterData.prototype.Copy=function(){var a=new b2FilterData;a.categoryBits=this.categoryBits;a.maskBits=this.maskBits;a.groupIndex=this.groupIndex;return a};var b2PairManager=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2PairManager.prototype.__constructor=function(){var a=0;this.m_hashTable=Array(b2Pair.b2_tableCapacity);for(a=0;a<b2Pair.b2_tableCapacity;++a)this.m_hashTable[a]=b2Pair.b2_nullPair;this.m_pairs=Array(b2Settings.b2_maxPairs);for(a=0;a<b2Settings.b2_maxPairs;++a)this.m_pairs[a]=new b2Pair;this.m_pairBuffer=Array(b2Settings.b2_maxPairs);for(a=0;a<b2Settings.b2_maxPairs;++a)this.m_pairBuffer[a]=new b2BufferedPair;for(a=0;a<b2Settings.b2_maxPairs;++a)this.m_pairs[a].proxyId1=b2Pair.b2_nullProxy,this.m_pairs[a].proxyId2=
b2Pair.b2_nullProxy,this.m_pairs[a].userData=null,this.m_pairs[a].status=0,this.m_pairs[a].next=a+1;this.m_pairs[parseInt(b2Settings.b2_maxPairs-1)].next=b2Pair.b2_nullPair;this.m_pairBufferCount=this.m_pairCount=0};b2PairManager.prototype.__varz=function(){};b2PairManager.Hash=function(a,c){var b=c<<16&4294901760|a,b=~b+(b<<15&4294934528);b^=b>>12&1048575;b+=b<<2&4294967292;b^=b>>4&268435455;b*=2057;b^=(b>>16)%65535;return b};
b2PairManager.Equals=function(a,c,b){return a.proxyId1==c&&a.proxyId2==b};b2PairManager.EqualsPair=function(a,c){return a.proxyId1==c.proxyId1&&a.proxyId2==c.proxyId2};b2PairManager.prototype.m_broadPhase=null;b2PairManager.prototype.m_callback=null;b2PairManager.prototype.m_pairs=null;b2PairManager.prototype.m_freePair=0;b2PairManager.prototype.m_pairCount=0;b2PairManager.prototype.m_pairBuffer=null;b2PairManager.prototype.m_pairBufferCount=0;b2PairManager.prototype.m_hashTable=null;
b2PairManager.prototype.AddPair=function(a,c){if(a>c)var b=a,a=c,c=b;var b=b2PairManager.Hash(a,c)&b2Pair.b2_tableMask,d=d=this.FindHash(a,c,b);if(d!=null)return d;var e=this.m_freePair,d=this.m_pairs[e];this.m_freePair=d.next;d.proxyId1=a;d.proxyId2=c;d.status=0;d.userData=null;d.next=this.m_hashTable[b];this.m_hashTable[b]=e;++this.m_pairCount;return d};
b2PairManager.prototype.RemovePair=function(a,c){var b;if(a>c)var d=a,a=c,c=d;var e=b2PairManager.Hash(a,c)&b2Pair.b2_tableMask;b=this.m_hashTable[e];for(var f=null;b!=b2Pair.b2_nullPair;)if(b2PairManager.Equals(this.m_pairs[b],a,c))return d=b,b=this.m_pairs[b],f?f.next=b.next:this.m_hashTable[e]=b.next,b=this.m_pairs[d],e=b.userData,b.next=this.m_freePair,b.proxyId1=b2Pair.b2_nullProxy,b.proxyId2=b2Pair.b2_nullProxy,b.userData=null,b.status=0,this.m_freePair=d,--this.m_pairCount,e;else f=this.m_pairs[b],
b=f.next;return null};b2PairManager.prototype.Find=function(a,c){if(a>c)var b=a,a=c,c=b;b=b2PairManager.Hash(a,c)&b2Pair.b2_tableMask;return this.FindHash(a,c,b)};b2PairManager.prototype.FindHash=function(a,c,b){for(var d=this.m_hashTable[b],b=this.m_pairs[d];d!=b2Pair.b2_nullPair&&b2PairManager.Equals(b,a,c)==!1;)d=b.next,b=this.m_pairs[d];return d==b2Pair.b2_nullPair?null:b};b2PairManager.prototype.ValidateBuffer=function(){};b2PairManager.prototype.ValidateTable=function(){};
b2PairManager.prototype.Initialize=function(a,c){this.m_broadPhase=a;this.m_callback=c};b2PairManager.prototype.AddBufferedPair=function(a,c){var b,d=this.AddPair(a,c);if(d.IsBuffered()==!1)d.SetBuffered(),b=this.m_pairBuffer[this.m_pairBufferCount],b.proxyId1=d.proxyId1,b.proxyId2=d.proxyId2,++this.m_pairBufferCount;d.ClearRemoved();b2BroadPhase.s_validate&&this.ValidateBuffer()};
b2PairManager.prototype.RemoveBufferedPair=function(a,c){var b,d=this.Find(a,c);if(d!=null){if(d.IsBuffered()==!1)d.SetBuffered(),b=this.m_pairBuffer[this.m_pairBufferCount],b.proxyId1=d.proxyId1,b.proxyId2=d.proxyId2,++this.m_pairBufferCount;d.SetRemoved();b2BroadPhase.s_validate&&this.ValidateBuffer()}};
b2PairManager.prototype.Commit=function(){for(var a,c=0,b=0,d=this.m_broadPhase.m_proxyPool,c=0;c<this.m_pairBufferCount;++c){a=this.m_pairBuffer[c];var e=this.Find(a.proxyId1,a.proxyId2);e.ClearBuffered();a=d[e.proxyId1];var f=d[e.proxyId2];if(e.IsRemoved())e.IsFinal()==!0&&this.m_callback.PairRemoved(a.userData,f.userData,e.userData),a=this.m_pairBuffer[b],a.proxyId1=e.proxyId1,a.proxyId2=e.proxyId2,++b;else if(e.IsFinal()==!1)e.userData=this.m_callback.PairAdded(a.userData,f.userData),e.SetFinal()}for(c=
0;c<b;++c)a=this.m_pairBuffer[c],this.RemovePair(a.proxyId1,a.proxyId2);this.m_pairBufferCount=0;b2BroadPhase.s_validate&&this.ValidateTable()};var b2ContactSolver=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2ContactSolver.prototype.__constructor=function(a,c,b,d){var e;this.m_step.dt=a.dt;this.m_step.inv_dt=a.inv_dt;this.m_step.maxIterations=a.maxIterations;this.m_allocator=d;for(var a=0,f,a=this.m_constraintCount=0;a<b;++a)e=c[a],this.m_constraintCount+=e.m_manifoldCount;for(a=0;a<this.m_constraintCount;a++)this.m_constraints[a]=new b2ContactConstraint;for(a=d=0;a<b;++a){e=c[a];var g=e.m_shape1.m_body,h=e.m_shape2.m_body,i=e.m_manifoldCount,j=e.GetManifolds(),k=e.m_friction;e=e.m_restitution;for(var l=
g.m_linearVelocity.x,m=g.m_linearVelocity.y,n=h.m_linearVelocity.x,o=h.m_linearVelocity.y,p=g.m_angularVelocity,q=h.m_angularVelocity,s=0;s<i;++s){var w=j[s],z=w.normal.x,t=w.normal.y,u=this.m_constraints[d];u.body1=g;u.body2=h;u.manifold=w;u.normal.x=z;u.normal.y=t;u.pointCount=w.pointCount;u.friction=k;u.restitution=e;for(var A=0;A<u.pointCount;++A){var r=w.points[A],v=u.points[A];v.normalImpulse=r.normalImpulse;v.tangentImpulse=r.tangentImpulse;v.separation=r.separation;v.positionImpulse=0;v.localAnchor1.SetV(r.localPoint1);
v.localAnchor2.SetV(r.localPoint2);var B;f=g.m_xf.R;var C=r.localPoint1.x-g.m_sweep.localCenter.x,F=r.localPoint1.y-g.m_sweep.localCenter.y;B=f.col1.x*C+f.col2.x*F;F=f.col1.y*C+f.col2.y*F;C=B;v.r1.Set(C,F);f=h.m_xf.R;var G=r.localPoint2.x-h.m_sweep.localCenter.x,r=r.localPoint2.y-h.m_sweep.localCenter.y;B=f.col1.x*G+f.col2.x*r;r=f.col1.y*G+f.col2.y*r;G=B;v.r2.Set(G,r);f=C*C+F*F;B=G*G+r*r;var H=C*z+F*t,E=G*z+r*t,D=g.m_invMass+h.m_invMass;D+=g.m_invI*(f-H*H)+h.m_invI*(B-E*E);v.normalMass=1/D;D=g.m_mass*
g.m_invMass+h.m_mass*h.m_invMass;D+=g.m_mass*g.m_invI*(f-H*H)+h.m_mass*h.m_invI*(B-E*E);v.equalizedMass=1/D;E=t;D=-z;H=C*E+F*D;E=G*E+r*D;D=g.m_invMass+h.m_invMass;D+=g.m_invI*(f-H*H)+h.m_invI*(B-E*E);v.tangentMass=1/D;v.velocityBias=0;if(v.separation>0)v.velocityBias=-60*v.separation;B=n+-q*r-l- -p*F;C=u.normal.x*B+u.normal.y*(o+q*G-m-p*C);C<-b2Settings.b2_velocityThreshold&&(v.velocityBias+=-u.restitution*C)}++d}}};
b2ContactSolver.prototype.__varz=function(){this.m_step=new b2TimeStep;this.m_constraints=[]};b2ContactSolver.prototype.m_step=new b2TimeStep;b2ContactSolver.prototype.m_allocator=null;b2ContactSolver.prototype.m_constraints=[];b2ContactSolver.prototype.m_constraintCount=0;
b2ContactSolver.prototype.InitVelocityConstraints=function(a){for(var c=0;c<this.m_constraintCount;++c){var b=this.m_constraints[c],d=b.body1,e=b.body2,f=d.m_invMass,g=d.m_invI,h=e.m_invMass,i=e.m_invI,j=b.normal.x,k=b.normal.y,l=k,m=-j,n=0,o=0;if(a.warmStarting){o=b.pointCount;for(n=0;n<o;++n){var p=b.points[n];p.normalImpulse*=a.dtRatio;p.tangentImpulse*=a.dtRatio;var q=p.normalImpulse*j+p.tangentImpulse*l,s=p.normalImpulse*k+p.tangentImpulse*m;d.m_angularVelocity-=g*(p.r1.x*s-p.r1.y*q);d.m_linearVelocity.x-=
f*q;d.m_linearVelocity.y-=f*s;e.m_angularVelocity+=i*(p.r2.x*s-p.r2.y*q);e.m_linearVelocity.x+=h*q;e.m_linearVelocity.y+=h*s}}else{o=b.pointCount;for(n=0;n<o;++n)d=b.points[n],d.normalImpulse=0,d.tangentImpulse=0}}};
b2ContactSolver.prototype.SolveVelocityConstraints=function(){for(var a=0,c,b,d,e,f,g,h=0;h<this.m_constraintCount;++h){for(var i=this.m_constraints[h],j=i.body1,k=i.body2,l=j.m_angularVelocity,m=k.m_angularVelocity,n=j.m_linearVelocity,o=k.m_linearVelocity,p=j.m_invMass,q=j.m_invI,s=k.m_invMass,w=k.m_invI,z=i.normal.x,t=i.normal.y,u=t,A=-z,r=i.friction,v=i.pointCount,a=0;a<v;++a)c=i.points[a],b=o.x+-m*c.r2.y-n.x- -l*c.r1.y,d=o.y+m*c.r2.x-n.y-l*c.r1.x,e=b*z+d*t,e=-c.normalMass*(e-c.velocityBias),
b=b*u+d*A,d=c.tangentMass*-b,b=b2Math.b2Max(c.normalImpulse+e,0),e=b-c.normalImpulse,f=r*c.normalImpulse,f=b2Math.b2Clamp(c.tangentImpulse+d,-f,f),d=f-c.tangentImpulse,g=e*z+d*u,e=e*t+d*A,n.x-=p*g,n.y-=p*e,l-=q*(c.r1.x*e-c.r1.y*g),o.x+=s*g,o.y+=s*e,m+=w*(c.r2.x*e-c.r2.y*g),c.normalImpulse=b,c.tangentImpulse=f;j.m_angularVelocity=l;k.m_angularVelocity=m}};
b2ContactSolver.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;++a)for(var c=this.m_constraints[a],b=c.manifold,d=0;d<c.pointCount;++d){var e=b.points[d],f=c.points[d];e.normalImpulse=f.normalImpulse;e.tangentImpulse=f.tangentImpulse}};
b2ContactSolver.prototype.SolvePositionConstraints=function(a){for(var c=0,b,d,e=0;e<this.m_constraintCount;++e)for(var f=this.m_constraints[e],g=f.body1,h=f.body2,i=g.m_sweep.c,j=g.m_sweep.a,k=h.m_sweep.c,l=h.m_sweep.a,m=g.m_mass*g.m_invMass,n=g.m_mass*g.m_invI,o=h.m_mass*h.m_invMass,p=h.m_mass*h.m_invI,q=f.normal.x,s=f.normal.y,w=f.pointCount,z=0;z<w;++z){var t=f.points[z];b=g.m_xf.R;d=g.m_sweep.localCenter;var u=t.localAnchor1.x-d.x,A=t.localAnchor1.y-d.y,r=b.col1.x*u+b.col2.x*A,A=b.col1.y*u+b.col2.y*
A,u=r;b=h.m_xf.R;d=h.m_sweep.localCenter;var v=t.localAnchor2.x-d.x;d=t.localAnchor2.y-d.y;var r=b.col1.x*v+b.col2.x*d;d=b.col1.y*v+b.col2.y*d;v=r;b=(k.x+v-(i.x+u))*q+(k.y+d-(i.y+A))*s+t.separation;c=b2Math.b2Min(c,b);b=a*b2Math.b2Clamp(b+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0);b*=-t.equalizedMass;r=t.positionImpulse;t.positionImpulse=b2Math.b2Max(r+b,0);b=t.positionImpulse-r;t=b*q;b*=s;i.x-=m*t;i.y-=m*b;j-=n*(u*b-A*t);g.m_sweep.a=j;g.SynchronizeTransform();k.x+=o*t;k.y+=o*
b;l+=p*(v*b-d*t);h.m_sweep.a=l;h.SynchronizeTransform()}return c>=-1.5*b2Settings.b2_linearSlop};var b2BoundValues=function(){this.__varz();this.__constructor.apply(this,arguments)};b2BoundValues.prototype.__constructor=function(){};b2BoundValues.prototype.__varz=function(){this.lowerValues=[0,0];this.upperValues=[0,0]};b2BoundValues.prototype.lowerValues=[0,0];b2BoundValues.prototype.upperValues=[0,0];var b2Segment=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Segment.prototype.__constructor=function(){};b2Segment.prototype.__varz=function(){this.p1=new b2Vec2;this.p2=new b2Vec2};b2Segment.prototype.p1=new b2Vec2;b2Segment.prototype.p2=new b2Vec2;
b2Segment.prototype.TestSegment=function(a,c,b,d){var e=b.p1,f=b.p2.x-e.x,g=b.p2.y-e.y,b=this.p2.y-this.p1.y,h=-(this.p2.x-this.p1.x),i=100*Number.MIN_VALUE,j=-(f*b+g*h);if(j>i){var k=e.x-this.p1.x,l=e.y-this.p1.y,e=k*b+l*h;if(0<=e&&e<=d*j&&(d=-f*l+g*k,-i*j<=d&&d<=j*(1+i)))return e/=j,d=Math.sqrt(b*b+h*h),b/=d,h/=d,a[0]=e,c.Set(b,h),!0}return!1};var Features=function(){this.__varz();this.__constructor.apply(this,arguments)};
Features.prototype={get referenceEdge(){return this._referenceEdge},set referenceEdge(a){this._referenceEdge=a;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255},get incidentEdge(){return this._incidentEdge},set incidentEdge(a){this._incidentEdge=a;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280},set incidentVertex(a){this._incidentVertex=a;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680},get incidentVertex(){return this._incidentVertex},
set flip(a){this._flip=a;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080},get flip(){return this._flip}};Features.prototype.__constructor=function(){};Features.prototype.__varz=function(){};Features.prototype._referenceEdge=0;Features.prototype._incidentEdge=0;Features.prototype._incidentVertex=0;Features.prototype._flip=0;Features.prototype._m_id=null;var b2MouseJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2MouseJointDef.prototype,b2JointDef.prototype);b2MouseJointDef.prototype._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};b2MouseJointDef.prototype.__constructor=function(){this.type=b2Joint.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7;this.timeStep=1/60};b2MouseJointDef.prototype.__varz=function(){this.target=new b2Vec2};
b2MouseJointDef.prototype.target=new b2Vec2;b2MouseJointDef.prototype.maxForce=null;b2MouseJointDef.prototype.frequencyHz=null;b2MouseJointDef.prototype.dampingRatio=null;b2MouseJointDef.prototype.timeStep=null;var b2ContactConstraintPoint=function(){this.__varz();this.__constructor.apply(this,arguments)};b2ContactConstraintPoint.prototype.__constructor=function(){};b2ContactConstraintPoint.prototype.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2;this.r1=new b2Vec2;this.r2=new b2Vec2};b2ContactConstraintPoint.prototype.localAnchor1=new b2Vec2;b2ContactConstraintPoint.prototype.localAnchor2=new b2Vec2;b2ContactConstraintPoint.prototype.r1=new b2Vec2;
b2ContactConstraintPoint.prototype.r2=new b2Vec2;b2ContactConstraintPoint.prototype.normalImpulse=null;b2ContactConstraintPoint.prototype.tangentImpulse=null;b2ContactConstraintPoint.prototype.positionImpulse=null;b2ContactConstraintPoint.prototype.normalMass=null;b2ContactConstraintPoint.prototype.tangentMass=null;b2ContactConstraintPoint.prototype.equalizedMass=null;b2ContactConstraintPoint.prototype.separation=null;b2ContactConstraintPoint.prototype.velocityBias=null;var b2ContactRegister=function(){this.__varz();this.__constructor.apply(this,arguments)};b2ContactRegister.prototype.__constructor=function(){};b2ContactRegister.prototype.__varz=function(){};b2ContactRegister.prototype.createFcn=null;b2ContactRegister.prototype.destroyFcn=null;b2ContactRegister.prototype.primary=null;var b2DestructionListener=function(){this.__varz();this.__constructor.apply(this,arguments)};b2DestructionListener.prototype.__constructor=function(){};b2DestructionListener.prototype.__varz=function(){};b2DestructionListener.prototype.SayGoodbyeJoint=function(){};b2DestructionListener.prototype.SayGoodbyeShape=function(){};var b2PulleyJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PulleyJointDef.prototype,b2JointDef.prototype);b2PulleyJointDef.prototype._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
b2PulleyJointDef.prototype.__constructor=function(){this.type=b2Joint.e_pulleyJoint;this.groundAnchor1.Set(-1,1);this.groundAnchor2.Set(1,1);this.localAnchor1.Set(-1,0);this.localAnchor2.Set(1,0);this.maxLength2=this.length2=this.maxLength1=this.length1=0;this.ratio=1;this.collideConnected=!0};b2PulleyJointDef.prototype.__varz=function(){this.groundAnchor1=new b2Vec2;this.groundAnchor2=new b2Vec2;this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2};b2PulleyJointDef.prototype.groundAnchor1=new b2Vec2;
b2PulleyJointDef.prototype.groundAnchor2=new b2Vec2;b2PulleyJointDef.prototype.localAnchor1=new b2Vec2;b2PulleyJointDef.prototype.localAnchor2=new b2Vec2;b2PulleyJointDef.prototype.length1=null;b2PulleyJointDef.prototype.maxLength1=null;b2PulleyJointDef.prototype.length2=null;b2PulleyJointDef.prototype.maxLength2=null;b2PulleyJointDef.prototype.ratio=null;
b2PulleyJointDef.prototype.Initialize=function(a,c,b,d,e,f,g){this.body1=a;this.body2=c;this.groundAnchor1.SetV(b);this.groundAnchor2.SetV(d);this.localAnchor1=this.body1.GetLocalPoint(e);this.localAnchor2=this.body2.GetLocalPoint(f);a=e.x-b.x;b=e.y-b.y;this.length1=Math.sqrt(a*a+b*b);b=f.x-d.x;d=f.y-d.y;this.length2=Math.sqrt(b*b+d*d);this.ratio=g;g=this.length1+this.ratio*this.length2;this.maxLength1=g-this.ratio*b2PulleyJoint.b2_minPulleyLength;this.maxLength2=(g-b2PulleyJoint.b2_minPulleyLength)/
this.ratio};var b2Jacobian=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Jacobian.prototype.__constructor=function(){};b2Jacobian.prototype.__varz=function(){this.linear1=new b2Vec2;this.linear2=new b2Vec2};b2Jacobian.prototype.linear1=new b2Vec2;b2Jacobian.prototype.angular1=null;b2Jacobian.prototype.linear2=new b2Vec2;b2Jacobian.prototype.angular2=null;b2Jacobian.prototype.SetZero=function(){this.linear1.SetZero();this.angular1=0;this.linear2.SetZero();this.angular2=0};
b2Jacobian.prototype.Set=function(a,c,b,d){this.linear1.SetV(a);this.angular1=c;this.linear2.SetV(b);this.angular2=d};b2Jacobian.prototype.Compute=function(a,c,b,d){return this.linear1.x*a.x+this.linear1.y*a.y+this.angular1*c+(this.linear2.x*b.x+this.linear2.y*b.y)+this.angular2*d};var b2DebugDraw=function(){this.__varz();this.__constructor.apply(this,arguments)};b2DebugDraw.prototype.__constructor=function(){this.m_drawFlags=0};b2DebugDraw.prototype.__varz=function(){};b2DebugDraw.e_shapeBit=1;b2DebugDraw.e_jointBit=2;b2DebugDraw.e_coreShapeBit=4;b2DebugDraw.e_aabbBit=8;b2DebugDraw.e_obbBit=16;b2DebugDraw.e_pairBit=32;b2DebugDraw.e_centerOfMassBit=64;b2DebugDraw.prototype.m_drawFlags=0;b2DebugDraw.prototype.m_sprite=null;b2DebugDraw.prototype.m_drawScale=1;
b2DebugDraw.prototype.m_lineThickness=1;b2DebugDraw.prototype.m_alpha=1;b2DebugDraw.prototype.m_fillAlpha=1;b2DebugDraw.prototype.m_xformScale=1;b2DebugDraw.prototype.SetFlags=function(a){this.m_drawFlags=a};b2DebugDraw.prototype.GetFlags=function(){return this.m_drawFlags};b2DebugDraw.prototype.AppendFlags=function(a){this.m_drawFlags|=a};b2DebugDraw.prototype.ClearFlags=function(a){this.m_drawFlags&=~a};
b2DebugDraw.prototype.DrawPolygon=function(a,c,b){this.m_sprite.graphics.lineStyle(this.m_lineThickness,b.color,this.m_alpha);this.m_sprite.graphics.moveTo(a[0].x*this.m_drawScale,a[0].y*this.m_drawScale);for(b=1;b<c;b++)this.m_sprite.graphics.lineTo(a[b].x*this.m_drawScale,a[b].y*this.m_drawScale);this.m_sprite.graphics.lineTo(a[0].x*this.m_drawScale,a[0].y*this.m_drawScale)};
b2DebugDraw.prototype.DrawSolidPolygon=function(a,c,b){this.m_sprite.graphics.lineStyle(this.m_lineThickness,b.color,this.m_alpha);this.m_sprite.graphics.moveTo(a[0].x*this.m_drawScale,a[0].y*this.m_drawScale);this.m_sprite.graphics.beginFill(b.color,this.m_fillAlpha);for(b=1;b<c;b++)this.m_sprite.graphics.lineTo(a[b].x*this.m_drawScale,a[b].y*this.m_drawScale);this.m_sprite.graphics.lineTo(a[0].x*this.m_drawScale,a[0].y*this.m_drawScale);this.m_sprite.graphics.endFill()};
b2DebugDraw.prototype.DrawCircle=function(a,c,b){this.m_sprite.graphics.lineStyle(this.m_lineThickness,b.color,this.m_alpha);this.m_sprite.graphics.drawCircle(a.x*this.m_drawScale,a.y*this.m_drawScale,c*this.m_drawScale)};
b2DebugDraw.prototype.DrawSolidCircle=function(a,c,b,d){this.m_sprite.graphics.lineStyle(this.m_lineThickness,d.color,this.m_alpha);this.m_sprite.graphics.moveTo(0,0);this.m_sprite.graphics.beginFill(d.color,this.m_fillAlpha);this.m_sprite.graphics.drawCircle(a.x*this.m_drawScale,a.y*this.m_drawScale,c*this.m_drawScale);this.m_sprite.graphics.endFill();this.m_sprite.graphics.moveTo(a.x*this.m_drawScale,a.y*this.m_drawScale);this.m_sprite.graphics.lineTo((a.x+b.x*c)*this.m_drawScale,(a.y+b.y*c)*this.m_drawScale)};
b2DebugDraw.prototype.DrawSegment=function(a,c,b){this.m_sprite.graphics.lineStyle(this.m_lineThickness,b.color,this.m_alpha);this.m_sprite.graphics.moveTo(a.x*this.m_drawScale,a.y*this.m_drawScale);this.m_sprite.graphics.lineTo(c.x*this.m_drawScale,c.y*this.m_drawScale)};
b2DebugDraw.prototype.DrawXForm=function(a){this.m_sprite.graphics.lineStyle(this.m_lineThickness,16711680,this.m_alpha);this.m_sprite.graphics.moveTo(a.position.x*this.m_drawScale,a.position.y*this.m_drawScale);this.m_sprite.graphics.lineTo((a.position.x+this.m_xformScale*a.R.col1.x)*this.m_drawScale,(a.position.y+this.m_xformScale*a.R.col1.y)*this.m_drawScale);this.m_sprite.graphics.lineStyle(this.m_lineThickness,65280,this.m_alpha);this.m_sprite.graphics.moveTo(a.position.x*this.m_drawScale,a.position.y*
this.m_drawScale);this.m_sprite.graphics.lineTo((a.position.x+this.m_xformScale*a.R.col2.x)*this.m_drawScale,(a.position.y+this.m_xformScale*a.R.col2.y)*this.m_drawScale)};var b2ContactEdge=function(){this.__varz();this.__constructor.apply(this,arguments)};b2ContactEdge.prototype.__constructor=function(){};b2ContactEdge.prototype.__varz=function(){};b2ContactEdge.prototype.other=null;b2ContactEdge.prototype.contact=null;b2ContactEdge.prototype.prev=null;b2ContactEdge.prototype.next=null;var b2Sweep=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Sweep.prototype.__constructor=function(){};b2Sweep.prototype.__varz=function(){this.localCenter=new b2Vec2;this.c0=new b2Vec2;this.c=new b2Vec2};b2Sweep.prototype.localCenter=new b2Vec2;b2Sweep.prototype.c0=new b2Vec2;b2Sweep.prototype.c=new b2Vec2;b2Sweep.prototype.a0=null;b2Sweep.prototype.a=null;b2Sweep.prototype.t0=null;
b2Sweep.prototype.GetXForm=function(a,c){if(1-this.t0>Number.MIN_VALUE){var b=(c-this.t0)/(1-this.t0);a.position.x=(1-b)*this.c0.x+b*this.c.x;a.position.y=(1-b)*this.c0.y+b*this.c.y;a.R.Set((1-b)*this.a0+b*this.a)}else a.position.SetV(this.c),a.R.Set(this.a);b=a.R;a.position.x-=b.col1.x*this.localCenter.x+b.col2.x*this.localCenter.y;a.position.y-=b.col1.y*this.localCenter.x+b.col2.y*this.localCenter.y};
b2Sweep.prototype.Advance=function(a){if(this.t0<a&&1-this.t0>Number.MIN_VALUE){var c=(a-this.t0)/(1-this.t0);this.c0.x=(1-c)*this.c0.x+c*this.c.x;this.c0.y=(1-c)*this.c0.y+c*this.c.y;this.a0=(1-c)*this.a0+c*this.a;this.t0=a}};var b2ContactConstraint=function(){this.__varz();this.__constructor.apply(this,arguments)};b2ContactConstraint.prototype.__constructor=function(){this.points=Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.points[a]=new b2ContactConstraintPoint};b2ContactConstraint.prototype.__varz=function(){this.normal=new b2Vec2};b2ContactConstraint.prototype.points=null;b2ContactConstraint.prototype.normal=new b2Vec2;b2ContactConstraint.prototype.manifold=null;
b2ContactConstraint.prototype.body1=null;b2ContactConstraint.prototype.body2=null;b2ContactConstraint.prototype.friction=null;b2ContactConstraint.prototype.restitution=null;b2ContactConstraint.prototype.pointCount=0;var b2Distance=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Distance.prototype.__constructor=function(){};b2Distance.prototype.__varz=function(){};b2Distance.g_GJK_Iterations=0;b2Distance.s_p1s=[new b2Vec2,new b2Vec2,new b2Vec2];b2Distance.s_p2s=[new b2Vec2,new b2Vec2,new b2Vec2];b2Distance.s_points=[new b2Vec2,new b2Vec2,new b2Vec2];b2Distance.gPoint=new b2Point;
b2Distance.ProcessTwo=function(a,c,b,d,e){var f=e[0],e=e[1],g=b[0],b=b[1],h=d[0],d=d[1],i=-e.x,j=-e.y,k=f.x-e.x,l=f.y-e.y,m=Math.sqrt(k*k+l*l);k/=m;l/=m;i=i*k+j*l;if(i<=0||m<Number.MIN_VALUE)return a.SetV(b),c.SetV(d),g.SetV(b),h.SetV(d),f.SetV(e),1;i/=m;a.x=b.x+i*(g.x-b.x);a.y=b.y+i*(g.y-b.y);c.x=d.x+i*(h.x-d.x);c.y=d.y+i*(h.y-d.y);return 2};
b2Distance.ProcessThree=function(a,c,b,d,e){var f=e[0],g=e[1],h=e[2],e=b[0],i=b[1],b=b[2],j=d[0],k=d[1],d=d[2],l=f.x,m=f.y,n=g.x,o=g.y,p=h.x,q=h.y,s=n-l,w=o-m,z=p-l,t=q-m,u=p-n,A=q-o,r=-(l*z+m*t),v=p*z+q*t,B=-(n*u+o*A),u=p*u+q*A;if(v<=0&&u<=0)return a.SetV(b),c.SetV(d),e.SetV(b),j.SetV(d),f.SetV(h),1;w=s*t-w*z;s=w*(l*o-m*n);n=w*(n*q-o*p);if(n<=0&&B>=0&&u>=0&&B+u>0)return r=B/(B+u),a.x=i.x+r*(b.x-i.x),a.y=i.y+r*(b.y-i.y),c.x=k.x+r*(d.x-k.x),c.y=k.y+r*(d.y-k.y),e.SetV(b),j.SetV(d),f.SetV(h),2;f=w*(p*
m-q*l);if(f<=0&&r>=0&&v>=0&&r+v>0)return r/=r+v,a.x=e.x+r*(b.x-e.x),a.y=e.y+r*(b.y-e.y),c.x=j.x+r*(d.x-j.x),c.y=j.y+r*(d.y-j.y),i.SetV(b),k.SetV(d),g.SetV(h),2;h=1/(n+f+s);g=n*h;f*=h;h=1-g-f;a.x=g*e.x+f*i.x+h*b.x;a.y=g*e.y+f*i.y+h*b.y;c.x=g*j.x+f*k.x+h*d.x;c.y=g*j.y+f*k.y+h*d.y;return 3};
b2Distance.InPoints=function(a,c,b){for(var d=100*Number.MIN_VALUE,e=0;e<b;++e){var f=c[e],g=Math.abs(a.x-f.x),h=Math.abs(a.y-f.y),i=Math.max(Math.abs(a.x),Math.abs(f.x)),f=Math.max(Math.abs(a.y),Math.abs(f.y));if(g<d*(i+1)&&h<d*(f+1))return!0}return!1};
b2Distance.DistanceGeneric=function(a,c,b,d,e,f){var g,h=b2Distance.s_p1s,i=b2Distance.s_p2s,j=b2Distance.s_points,k=0;a.SetV(b.GetFirstVertex(d));c.SetV(e.GetFirstVertex(f));for(var l=0,m=0;m<20;++m){g=c.x-a.x;var n=c.y-a.y,o=b.Support(d,g,n),p=e.Support(f,-g,-n),l=g*g+n*n,q=p.x-o.x,s=p.y-o.y;if(l-(g*q+n*s)<=0.01*l)return k==0&&(a.SetV(o),c.SetV(p)),b2Distance.g_GJK_Iterations=m,Math.sqrt(l);switch(k){case 0:g=h[0];g.SetV(o);g=i[0];g.SetV(p);g=j[0];g.x=q;g.y=s;a.SetV(h[0]);c.SetV(i[0]);++k;break;
case 1:g=h[1];g.SetV(o);g=i[1];g.SetV(p);g=j[1];g.x=q;g.y=s;k=b2Distance.ProcessTwo(a,c,h,i,j);break;case 2:g=h[2],g.SetV(o),g=i[2],g.SetV(p),g=j[2],g.x=q,g.y=s,k=b2Distance.ProcessThree(a,c,h,i,j)}if(k==3)return b2Distance.g_GJK_Iterations=m,0;o=-Number.MAX_VALUE;for(p=0;p<k;++p)g=j[p],o=b2Math.b2Max(o,g.x*g.x+g.y*g.y);if(k==3||l<=100*Number.MIN_VALUE*o)return b2Distance.g_GJK_Iterations=m,g=c.x-a.x,n=c.y-a.y,l=g*g+n*n,Math.sqrt(l)}b2Distance.g_GJK_Iterations=20;return Math.sqrt(l)};
b2Distance.DistanceCC=function(a,c,b,d,e,f){var g,h;g=d.R;h=b.m_localPosition;var i=d.position.x+(g.col1.x*h.x+g.col2.x*h.y),d=d.position.y+(g.col1.y*h.x+g.col2.y*h.y);g=f.R;h=e.m_localPosition;var j=f.position.x+(g.col1.x*h.x+g.col2.x*h.y),f=f.position.y+(g.col1.y*h.x+g.col2.y*h.y);g=j-i;h=f-d;var k=g*g+h*h,b=b.m_radius-b2Settings.b2_toiSlop,e=e.m_radius-b2Settings.b2_toiSlop,l=b+e;if(k>l*l)return k=Math.sqrt(k),g/=k,h/=k,a.x=i+b*g,a.y=d+b*h,c.x=j-e*g,c.y=f-e*h,k-l;else if(k>Number.MIN_VALUE*Number.MIN_VALUE)return k=
Math.sqrt(k),g/=k,h/=k,a.x=i+b*g,a.y=d+b*h,c.x=a.x,c.y=a.y,0;a.x=i;a.y=d;c.x=a.x;c.y=a.y;return 0};b2Distance.DistancePC=function(a,c,b,d,e,f){var g,h,i=b2Distance.gPoint;h=e.m_localPosition;g=f.R;i.p.x=f.position.x+(g.col1.x*h.x+g.col2.x*h.y);i.p.y=f.position.y+(g.col1.y*h.x+g.col2.y*h.y);b=b2Distance.DistanceGeneric(a,c,b,d,i,b2Math.b2XForm_identity);e=e.m_radius-b2Settings.b2_toiSlop;b>e?(b-=e,d=c.x-a.x,a=c.y-a.y,f=Math.sqrt(d*d+a*a),d/=f,a/=f,c.x-=e*d,c.y-=e*a):(b=0,c.x=a.x,c.y=a.y);return b};
b2Distance.Distance=function(a,c,b,d,e,f){var g=b.m_type,h=e.m_type;return g==b2Shape.e_circleShape&&h==b2Shape.e_circleShape?b2Distance.DistanceCC(a,c,b,d,e,f):g==b2Shape.e_polygonShape&&h==b2Shape.e_circleShape?b2Distance.DistancePC(a,c,b,d,e,f):g==b2Shape.e_circleShape&&h==b2Shape.e_polygonShape?b2Distance.DistancePC(c,a,e,f,b,d):g==b2Shape.e_polygonShape&&h==b2Shape.e_polygonShape?b2Distance.DistanceGeneric(a,c,b,d,e,f):0};var b2Shape=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Shape.prototype.__constructor=function(a){this.m_userData=a.userData;this.m_friction=a.friction;this.m_restitution=a.restitution;this.m_density=a.density;this.m_body=null;this.m_sweepRadius=0;this.m_next=null;this.m_proxyId=b2Pair.b2_nullProxy;this.m_filter=a.filter.Copy();this.m_isSensor=a.isSensor};b2Shape.prototype.__varz=function(){};b2Shape.e_unknownShape=-1;b2Shape.e_circleShape=0;b2Shape.e_polygonShape=1;
b2Shape.e_shapeTypeCount=2;b2Shape.s_proxyAABB=new b2AABB;b2Shape.s_syncAABB=new b2AABB;b2Shape.s_resetAABB=new b2AABB;b2Shape.Create=function(a){switch(a.type){case b2Shape.e_circleShape:return new b2CircleShape(a);case b2Shape.e_polygonShape:return new b2PolygonShape(a);default:return null}};b2Shape.Destroy=function(){};b2Shape.prototype.m_type=0;b2Shape.prototype.m_next=null;b2Shape.prototype.m_body=null;b2Shape.prototype.m_sweepRadius=null;b2Shape.prototype.m_density=null;
b2Shape.prototype.m_friction=null;b2Shape.prototype.m_restitution=null;b2Shape.prototype.m_proxyId=0;b2Shape.prototype.m_filter=null;b2Shape.prototype.m_isSensor=null;b2Shape.prototype.m_userData=null;b2Shape.prototype.GetType=function(){return this.m_type};b2Shape.prototype.IsSensor=function(){return this.m_isSensor};b2Shape.prototype.SetFilterData=function(a){this.m_filter=a.Copy()};b2Shape.prototype.GetFilterData=function(){return this.m_filter.Copy()};b2Shape.prototype.GetBody=function(){return this.m_body};
b2Shape.prototype.GetNext=function(){return this.m_next};b2Shape.prototype.GetUserData=function(){return this.m_userData};b2Shape.prototype.SetUserData=function(a){this.m_userData=a};b2Shape.prototype.TestPoint=function(){return!1};b2Shape.prototype.TestSegment=function(){return!1};b2Shape.prototype.ComputeAABB=function(){};b2Shape.prototype.ComputeSweptAABB=function(){};b2Shape.prototype.ComputeMass=function(){};b2Shape.prototype.GetSweepRadius=function(){return this.m_sweepRadius};
b2Shape.prototype.GetFriction=function(){return this.m_friction};b2Shape.prototype.GetRestitution=function(){return this.m_restitution};b2Shape.prototype.CreateProxy=function(a,c){var b=b2Shape.s_proxyAABB;this.ComputeAABB(b,c);this.m_proxyId=a.InRange(b)?a.CreateProxy(b,this):b2Pair.b2_nullProxy};b2Shape.prototype.DestroyProxy=function(a){if(this.m_proxyId!=b2Pair.b2_nullProxy)a.DestroyProxy(this.m_proxyId),this.m_proxyId=b2Pair.b2_nullProxy};
b2Shape.prototype.Synchronize=function(a,c,b){if(this.m_proxyId==b2Pair.b2_nullProxy)return!1;var d=b2Shape.s_syncAABB;this.ComputeSweptAABB(d,c,b);return a.InRange(d)?(a.MoveProxy(this.m_proxyId,d),!0):!1};b2Shape.prototype.RefilterProxy=function(a,c){if(this.m_proxyId!=b2Pair.b2_nullProxy){a.DestroyProxy(this.m_proxyId);var b=b2Shape.s_resetAABB;this.ComputeAABB(b,c);this.m_proxyId=a.InRange(b)?a.CreateProxy(b,this):b2Pair.b2_nullProxy}};b2Shape.prototype.UpdateSweepRadius=function(){};var b2XForm=function(){this.__varz();this.__constructor.apply(this,arguments)};b2XForm.prototype.__constructor=function(a,c){a&&(this.position.SetV(a),this.R.SetM(c))};b2XForm.prototype.__varz=function(){this.position=new b2Vec2;this.R=new b2Mat22};b2XForm.prototype.position=new b2Vec2;b2XForm.prototype.R=new b2Mat22;b2XForm.prototype.Initialize=function(a,c){this.position.SetV(a);this.R.SetM(c)};b2XForm.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};
b2XForm.prototype.Set=function(a){this.position.SetV(a.position);this.R.SetM(a.R)};var b2DistanceJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2DistanceJointDef.prototype,b2JointDef.prototype);b2DistanceJointDef.prototype._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};b2DistanceJointDef.prototype.__constructor=function(){this.type=b2Joint.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};
b2DistanceJointDef.prototype.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2};b2DistanceJointDef.prototype.localAnchor1=new b2Vec2;b2DistanceJointDef.prototype.localAnchor2=new b2Vec2;b2DistanceJointDef.prototype.length=null;b2DistanceJointDef.prototype.frequencyHz=null;b2DistanceJointDef.prototype.dampingRatio=null;
b2DistanceJointDef.prototype.Initialize=function(a,c,b,d){this.body1=a;this.body2=c;this.localAnchor1.SetV(this.body1.GetLocalPoint(b));this.localAnchor2.SetV(this.body2.GetLocalPoint(d));a=d.x-b.x;b=d.y-b.y;this.length=Math.sqrt(a*a+b*b);this.dampingRatio=this.frequencyHz=0};var b2OBB=function(){this.__varz();this.__constructor.apply(this,arguments)};b2OBB.prototype.__constructor=function(){};b2OBB.prototype.__varz=function(){this.R=new b2Mat22;this.center=new b2Vec2;this.extents=new b2Vec2};b2OBB.prototype.R=new b2Mat22;b2OBB.prototype.center=new b2Vec2;b2OBB.prototype.extents=new b2Vec2;var b2BodyDef=function(){this.__varz();this.__constructor.apply(this,arguments)};b2BodyDef.prototype.__constructor=function(){this.massData.center.SetZero();this.massData.mass=0;this.massData.I=0;this.userData=null;this.position.Set(0,0);this.angularDamping=this.linearDamping=this.angle=0;this.allowSleep=!0;this.isBullet=this.fixedRotation=this.isSleeping=!1};b2BodyDef.prototype.__varz=function(){this.massData=new b2MassData;this.position=new b2Vec2};b2BodyDef.prototype.massData=new b2MassData;
b2BodyDef.prototype.userData=null;b2BodyDef.prototype.position=new b2Vec2;b2BodyDef.prototype.angle=null;b2BodyDef.prototype.linearDamping=null;b2BodyDef.prototype.angularDamping=null;b2BodyDef.prototype.allowSleep=null;b2BodyDef.prototype.isSleeping=null;b2BodyDef.prototype.fixedRotation=null;b2BodyDef.prototype.isBullet=null;var b2PrismaticJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PrismaticJointDef.prototype,b2JointDef.prototype);b2PrismaticJointDef.prototype._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
b2PrismaticJointDef.prototype.__constructor=function(){this.type=b2Joint.e_prismaticJoint;this.localAxis1.Set(1,0);this.referenceAngle=0;this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};b2PrismaticJointDef.prototype.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2;this.localAxis1=new b2Vec2};b2PrismaticJointDef.prototype.localAnchor1=new b2Vec2;b2PrismaticJointDef.prototype.localAnchor2=new b2Vec2;
b2PrismaticJointDef.prototype.localAxis1=new b2Vec2;b2PrismaticJointDef.prototype.referenceAngle=null;b2PrismaticJointDef.prototype.enableLimit=null;b2PrismaticJointDef.prototype.lowerTranslation=null;b2PrismaticJointDef.prototype.upperTranslation=null;b2PrismaticJointDef.prototype.enableMotor=null;b2PrismaticJointDef.prototype.maxMotorForce=null;b2PrismaticJointDef.prototype.motorSpeed=null;
b2PrismaticJointDef.prototype.Initialize=function(a,c,b,d){this.body1=a;this.body2=c;this.localAnchor1=this.body1.GetLocalPoint(b);this.localAnchor2=this.body2.GetLocalPoint(b);this.localAxis1=this.body1.GetLocalVector(d);this.referenceAngle=this.body2.GetAngle()-this.body1.GetAngle()};var b2ContactID=function(){this.__varz();this.__constructor.apply(this,arguments)};b2ContactID.prototype={get key(){return this._key},set key(a){this._key=a;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}};b2ContactID.prototype.__constructor=function(){this.features._m_id=this};b2ContactID.prototype.__varz=function(){this.features=new Features};
b2ContactID.prototype.features=new Features;b2ContactID.prototype._key=0;b2ContactID.prototype.Set=function(a){this.key=a._key};b2ContactID.prototype.Copy=function(){var a=new b2ContactID;a.key=this._key;return a};var b2RevoluteJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2RevoluteJointDef.prototype,b2JointDef.prototype);b2RevoluteJointDef.prototype._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};
b2RevoluteJointDef.prototype.__constructor=function(){this.type=b2Joint.e_revoluteJoint;this.localAnchor1.Set(0,0);this.localAnchor2.Set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=!1};b2RevoluteJointDef.prototype.__varz=function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2};b2RevoluteJointDef.prototype.localAnchor1=new b2Vec2;b2RevoluteJointDef.prototype.localAnchor2=new b2Vec2;
b2RevoluteJointDef.prototype.referenceAngle=null;b2RevoluteJointDef.prototype.enableLimit=null;b2RevoluteJointDef.prototype.lowerAngle=null;b2RevoluteJointDef.prototype.upperAngle=null;b2RevoluteJointDef.prototype.enableMotor=null;b2RevoluteJointDef.prototype.motorSpeed=null;b2RevoluteJointDef.prototype.maxMotorTorque=null;
b2RevoluteJointDef.prototype.Initialize=function(a,c,b){this.body1=a;this.body2=c;this.localAnchor1=this.body1.GetLocalPoint(b);this.localAnchor2=this.body2.GetLocalPoint(b);this.referenceAngle=this.body2.GetAngle()-this.body1.GetAngle()};var b2CircleShape=function(){b2Shape.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2CircleShape.prototype,b2Shape.prototype);b2CircleShape.prototype._super=function(){b2Shape.prototype.__constructor.apply(this,arguments)};b2CircleShape.prototype.__constructor=function(a){this._super(a);this.m_type=b2Shape.e_circleShape;this.m_localPosition.SetV(a.localPosition);this.m_radius=a.radius};b2CircleShape.prototype.__varz=function(){this.m_localPosition=new b2Vec2};
b2CircleShape.prototype.m_localPosition=new b2Vec2;b2CircleShape.prototype.m_radius=null;b2CircleShape.prototype.TestPoint=function(a,c){var b=a.R,d=a.position.x+(b.col1.x*this.m_localPosition.x+b.col2.x*this.m_localPosition.y),b=a.position.y+(b.col1.y*this.m_localPosition.x+b.col2.y*this.m_localPosition.y),d=c.x-d,b=c.y-b;return d*d+b*b<=this.m_radius*this.m_radius};
b2CircleShape.prototype.TestSegment=function(a,c,b,d,e){var f=a.R,g=d.p1.x-(a.position.x+(f.col1.x*this.m_localPosition.x+f.col2.x*this.m_localPosition.y)),a=d.p1.y-(a.position.y+(f.col1.y*this.m_localPosition.x+f.col2.y*this.m_localPosition.y)),h=g*g+a*a-this.m_radius*this.m_radius;if(h<0)return!1;var f=d.p2.x-d.p1.x,d=d.p2.y-d.p1.y,i=g*f+a*d,j=f*f+d*d,h=i*i-j*h;if(h<0||j<Number.MIN_VALUE)return!1;h=-(i+Math.sqrt(h));return 0<=h&&h<=e*j?(h/=j,c[0]=h,b.x=g+h*f,b.y=a+h*d,b.Normalize(),!0):!1};
b2CircleShape.prototype.ComputeAABB=function(a,c){var b=c.R,d=c.position.x+(b.col1.x*this.m_localPosition.x+b.col2.x*this.m_localPosition.y),b=c.position.y+(b.col1.y*this.m_localPosition.x+b.col2.y*this.m_localPosition.y);a.lowerBound.Set(d-this.m_radius,b-this.m_radius);a.upperBound.Set(d+this.m_radius,b+this.m_radius)};
b2CircleShape.prototype.ComputeSweptAABB=function(a,c,b){var d;d=c.R;var e=c.position.x+(d.col1.x*this.m_localPosition.x+d.col2.x*this.m_localPosition.y),c=c.position.y+(d.col1.y*this.m_localPosition.x+d.col2.y*this.m_localPosition.y);d=b.R;var f=b.position.x+(d.col1.x*this.m_localPosition.x+d.col2.x*this.m_localPosition.y),b=b.position.y+(d.col1.y*this.m_localPosition.x+d.col2.y*this.m_localPosition.y);a.lowerBound.Set((e<f?e:f)-this.m_radius,(c<b?c:b)-this.m_radius);a.upperBound.Set((e>f?e:f)+this.m_radius,
(c>b?c:b)+this.m_radius)};b2CircleShape.prototype.ComputeMass=function(a){a.mass=this.m_density*b2Settings.b2_pi*this.m_radius*this.m_radius;a.center.SetV(this.m_localPosition);a.I=a.mass*(0.5*this.m_radius*this.m_radius+(this.m_localPosition.x*this.m_localPosition.x+this.m_localPosition.y*this.m_localPosition.y))};b2CircleShape.prototype.GetLocalPosition=function(){return this.m_localPosition};b2CircleShape.prototype.GetRadius=function(){return this.m_radius};
b2CircleShape.prototype.UpdateSweepRadius=function(a){var c=this.m_localPosition.x-a.x,a=this.m_localPosition.y-a.y,c=Math.sqrt(c*c+a*a);this.m_sweepRadius=c+this.m_radius-b2Settings.b2_toiSlop};var b2Joint=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Joint.prototype.__constructor=function(a){this.m_type=a.type;this.m_next=this.m_prev=null;this.m_body1=a.body1;this.m_body2=a.body2;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=a.userData};b2Joint.prototype.__varz=function(){this.m_node1=new b2JointEdge;this.m_node2=new b2JointEdge};b2Joint.e_unknownJoint=0;b2Joint.e_revoluteJoint=1;b2Joint.e_prismaticJoint=2;
b2Joint.e_distanceJoint=3;b2Joint.e_pulleyJoint=4;b2Joint.e_mouseJoint=5;b2Joint.e_gearJoint=6;b2Joint.e_inactiveLimit=0;b2Joint.e_atLowerLimit=1;b2Joint.e_atUpperLimit=2;b2Joint.e_equalLimits=3;
b2Joint.Create=function(a){var c=null;switch(a.type){case b2Joint.e_distanceJoint:c=new b2DistanceJoint(a);break;case b2Joint.e_mouseJoint:c=new b2MouseJoint(a);break;case b2Joint.e_prismaticJoint:c=new b2PrismaticJoint(a);break;case b2Joint.e_revoluteJoint:c=new b2RevoluteJoint(a);break;case b2Joint.e_pulleyJoint:c=new b2PulleyJoint(a);break;case b2Joint.e_gearJoint:c=new b2GearJoint(a)}return c};b2Joint.Destroy=function(){};b2Joint.prototype.m_type=0;b2Joint.prototype.m_prev=null;
b2Joint.prototype.m_next=null;b2Joint.prototype.m_node1=new b2JointEdge;b2Joint.prototype.m_node2=new b2JointEdge;b2Joint.prototype.m_body1=null;b2Joint.prototype.m_body2=null;b2Joint.prototype.m_inv_dt=null;b2Joint.prototype.m_islandFlag=null;b2Joint.prototype.m_collideConnected=null;b2Joint.prototype.m_userData=null;b2Joint.prototype.GetType=function(){return this.m_type};b2Joint.prototype.GetAnchor1=function(){return null};b2Joint.prototype.GetAnchor2=function(){return null};
b2Joint.prototype.GetReactionForce=function(){return null};b2Joint.prototype.GetReactionTorque=function(){return 0};b2Joint.prototype.GetBody1=function(){return this.m_body1};b2Joint.prototype.GetBody2=function(){return this.m_body2};b2Joint.prototype.GetNext=function(){return this.m_next};b2Joint.prototype.GetUserData=function(){return this.m_userData};b2Joint.prototype.SetUserData=function(a){this.m_userData=a};b2Joint.prototype.InitVelocityConstraints=function(){};
b2Joint.prototype.SolveVelocityConstraints=function(){};b2Joint.prototype.InitPositionConstraints=function(){};b2Joint.prototype.SolvePositionConstraints=function(){return!1};var b2GearJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2GearJoint.prototype,b2Joint.prototype);b2GearJoint.prototype._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
b2GearJoint.prototype.__constructor=function(a){this._super(a);var c=a.joint1.m_type,b=a.joint2.m_type;this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;this.m_ground1=a.joint1.m_body1;this.m_body1=a.joint1.m_body2;c==b2Joint.e_revoluteJoint?(this.m_revolute1=a.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),c=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=a.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),
this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),c=this.m_prismatic1.GetJointTranslation());this.m_ground2=a.joint2.m_body1;this.m_body2=a.joint2.m_body2;b==b2Joint.e_revoluteJoint?(this.m_revolute2=a.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),b=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=a.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),
b=this.m_prismatic2.GetJointTranslation());this.m_ratio=a.ratio;this.m_constant=c+this.m_ratio*b;this.m_force=0};b2GearJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2;this.m_groundAnchor2=new b2Vec2;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_J=new b2Jacobian};b2GearJoint.prototype.m_ground1=null;b2GearJoint.prototype.m_ground2=null;b2GearJoint.prototype.m_revolute1=null;b2GearJoint.prototype.m_prismatic1=null;b2GearJoint.prototype.m_revolute2=null;
b2GearJoint.prototype.m_prismatic2=null;b2GearJoint.prototype.m_groundAnchor1=new b2Vec2;b2GearJoint.prototype.m_groundAnchor2=new b2Vec2;b2GearJoint.prototype.m_localAnchor1=new b2Vec2;b2GearJoint.prototype.m_localAnchor2=new b2Vec2;b2GearJoint.prototype.m_J=new b2Jacobian;b2GearJoint.prototype.m_constant=null;b2GearJoint.prototype.m_ratio=null;b2GearJoint.prototype.m_mass=null;b2GearJoint.prototype.m_force=null;b2GearJoint.prototype.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};
b2GearJoint.prototype.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};b2GearJoint.prototype.GetReactionForce=function(){return new b2Vec2(this.m_force*this.m_J.linear2.x,this.m_force*this.m_J.linear2.y)};
b2GearJoint.prototype.GetReactionTorque=function(){var a=this.m_body2.m_xf.R,c=this.m_localAnchor1.x-this.m_body2.m_sweep.localCenter.x,b=this.m_localAnchor1.y-this.m_body2.m_sweep.localCenter.y,d=a.col1.x*c+a.col2.x*b,b=a.col1.y*c+a.col2.y*b;return d=this.m_force*this.m_J.angular2-(d*this.m_force*this.m_J.linear2.y-b*this.m_force*this.m_J.linear2.x)};b2GearJoint.prototype.GetRatio=function(){return this.m_ratio};
b2GearJoint.prototype.InitVelocityConstraints=function(a){var c=this.m_ground1,b=this.m_ground2,d=this.m_body1,e=this.m_body2,f,g,h,i,j,k=0;this.m_J.SetZero();this.m_revolute1?(this.m_J.angular1=-1,k+=d.m_invI):(i=c.m_xf.R,f=this.m_prismatic1.m_localXAxis1,c=i.col1.x*f.x+i.col2.x*f.y,f=i.col1.y*f.x+i.col2.y*f.y,i=d.m_xf.R,g=this.m_localAnchor1.x-d.m_sweep.localCenter.x,h=this.m_localAnchor1.y-d.m_sweep.localCenter.y,j=i.col1.x*g+i.col2.x*h,h=i.col1.y*g+i.col2.y*h,i=j*f-h*c,this.m_J.linear1.Set(-c,
-f),this.m_J.angular1=-i,k+=d.m_invMass+d.m_invI*i*i);this.m_revolute2?(this.m_J.angular2=-this.m_ratio,k+=this.m_ratio*this.m_ratio*e.m_invI):(i=b.m_xf.R,f=this.m_prismatic2.m_localXAxis1,c=i.col1.x*f.x+i.col2.x*f.y,f=i.col1.y*f.x+i.col2.y*f.y,i=e.m_xf.R,g=this.m_localAnchor2.x-e.m_sweep.localCenter.x,h=this.m_localAnchor2.y-e.m_sweep.localCenter.y,j=i.col1.x*g+i.col2.x*h,h=i.col1.y*g+i.col2.y*h,i=j*f-h*c,this.m_J.linear2.Set(-this.m_ratio*c,-this.m_ratio*f),this.m_J.angular2=-this.m_ratio*i,k+=
this.m_ratio*this.m_ratio*(e.m_invMass+e.m_invI*i*i));this.m_mass=1/k;a.warmStarting?(a=a.dt*this.m_force,d.m_linearVelocity.x+=d.m_invMass*a*this.m_J.linear1.x,d.m_linearVelocity.y+=d.m_invMass*a*this.m_J.linear1.y,d.m_angularVelocity+=d.m_invI*a*this.m_J.angular1,e.m_linearVelocity.x+=e.m_invMass*a*this.m_J.linear2.x,e.m_linearVelocity.y+=e.m_invMass*a*this.m_J.linear2.y,e.m_angularVelocity+=e.m_invI*a*this.m_J.angular2):this.m_force=0};
b2GearJoint.prototype.SolveVelocityConstraints=function(a){var c=this.m_body1,b=this.m_body2,d=this.m_J.Compute(c.m_linearVelocity,c.m_angularVelocity,b.m_linearVelocity,b.m_angularVelocity);d*=-a.inv_dt*this.m_mass;this.m_force+=d;a=a.dt*d;c.m_linearVelocity.x+=c.m_invMass*a*this.m_J.linear1.x;c.m_linearVelocity.y+=c.m_invMass*a*this.m_J.linear1.y;c.m_angularVelocity+=c.m_invI*a*this.m_J.angular1;b.m_linearVelocity.x+=b.m_invMass*a*this.m_J.linear2.x;b.m_linearVelocity.y+=b.m_invMass*a*this.m_J.linear2.y;
b.m_angularVelocity+=b.m_invI*a*this.m_J.angular2};
b2GearJoint.prototype.SolvePositionConstraints=function(){var a=this.m_body1,c=this.m_body2,b,d;b=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation();d=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();b=-this.m_mass*(this.m_constant-(b+this.m_ratio*d));a.m_sweep.c.x+=a.m_invMass*b*this.m_J.linear1.x;a.m_sweep.c.y+=a.m_invMass*b*this.m_J.linear1.y;a.m_sweep.a+=a.m_invI*b*this.m_J.angular1;c.m_sweep.c.x+=c.m_invMass*b*this.m_J.linear2.x;
c.m_sweep.c.y+=c.m_invMass*b*this.m_J.linear2.y;c.m_sweep.a+=c.m_invI*b*this.m_J.angular2;a.SynchronizeTransform();c.SynchronizeTransform();return 0<b2Settings.b2_linearSlop};var b2GearJointDef=function(){b2JointDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2GearJointDef.prototype,b2JointDef.prototype);b2GearJointDef.prototype._super=function(){b2JointDef.prototype.__constructor.apply(this,arguments)};b2GearJointDef.prototype.__constructor=function(){this.type=b2Joint.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};b2GearJointDef.prototype.__varz=function(){};b2GearJointDef.prototype.joint1=null;
b2GearJointDef.prototype.joint2=null;b2GearJointDef.prototype.ratio=null;var b2BroadPhase=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2BroadPhase.prototype.__constructor=function(a,c){var b=0;this.m_pairManager.Initialize(this,c);this.m_worldAABB=a;for(b=this.m_proxyCount=0;b<b2Settings.b2_maxProxies;b++)this.m_queryResults[b]=0;this.m_bounds=Array(2);for(b=0;b<2;b++){this.m_bounds[b]=Array(2*b2Settings.b2_maxProxies);for(var d=0;d<2*b2Settings.b2_maxProxies;d++)this.m_bounds[b][d]=new b2Bound}b=a.upperBound.y-a.lowerBound.y;this.m_quantizationFactor.x=b2Settings.USHRT_MAX/(a.upperBound.x-a.lowerBound.x);this.m_quantizationFactor.y=
b2Settings.USHRT_MAX/b;for(b=0;b<b2Settings.b2_maxProxies-1;++b)d=new b2Proxy,this.m_proxyPool[b]=d,d.SetNext(b+1),d.timeStamp=0,d.overlapCount=b2BroadPhase.b2_invalid,d.userData=null;d=new b2Proxy;this.m_proxyPool[parseInt(b2Settings.b2_maxProxies-1)]=d;d.SetNext(b2Pair.b2_nullProxy);d.timeStamp=0;d.overlapCount=b2BroadPhase.b2_invalid;d.userData=null;this.m_freeProxy=0;this.m_timeStamp=1;this.m_queryResultCount=0};
b2BroadPhase.prototype.__varz=function(){this.m_pairManager=new b2PairManager;this.m_proxyPool=Array(b2Settings.b2_maxPairs);this.m_bounds=Array(2*b2Settings.b2_maxProxies);this.m_queryResults=Array(b2Settings.b2_maxProxies);this.m_quantizationFactor=new b2Vec2};b2BroadPhase.s_validate=!1;b2BroadPhase.b2_invalid=b2Settings.USHRT_MAX;b2BroadPhase.b2_nullEdge=b2Settings.USHRT_MAX;
b2BroadPhase.BinarySearch=function(a,c,b){var d=0;for(c-=1;d<=c;){var e=Math.round((d+c)/2),f=a[e];if(f.value>b)c=e-1;else if(f.value<b)d=e+1;else return parseInt(e)}return parseInt(d)};b2BroadPhase.prototype.m_pairManager=new b2PairManager;b2BroadPhase.prototype.m_proxyPool=Array(b2Settings.b2_maxPairs);b2BroadPhase.prototype.m_freeProxy=0;b2BroadPhase.prototype.m_bounds=Array(2*b2Settings.b2_maxProxies);b2BroadPhase.prototype.m_queryResults=Array(b2Settings.b2_maxProxies);
b2BroadPhase.prototype.m_queryResultCount=0;b2BroadPhase.prototype.m_worldAABB=null;b2BroadPhase.prototype.m_quantizationFactor=new b2Vec2;b2BroadPhase.prototype.m_proxyCount=0;b2BroadPhase.prototype.m_timeStamp=0;
b2BroadPhase.prototype.ComputeBounds=function(a,c,b){var d=b.lowerBound.x,e=b.lowerBound.y,d=b2Math.b2Min(d,this.m_worldAABB.upperBound.x),e=b2Math.b2Min(e,this.m_worldAABB.upperBound.y),d=b2Math.b2Max(d,this.m_worldAABB.lowerBound.x),e=b2Math.b2Max(e,this.m_worldAABB.lowerBound.y),f=b.upperBound.x,b=b.upperBound.y,f=b2Math.b2Min(f,this.m_worldAABB.upperBound.x),b=b2Math.b2Min(b,this.m_worldAABB.upperBound.y),f=b2Math.b2Max(f,this.m_worldAABB.lowerBound.x),b=b2Math.b2Max(b,this.m_worldAABB.lowerBound.y);
a[0]=parseInt(this.m_quantizationFactor.x*(d-this.m_worldAABB.lowerBound.x))&b2Settings.USHRT_MAX-1;c[0]=parseInt(this.m_quantizationFactor.x*(f-this.m_worldAABB.lowerBound.x))%65535|1;a[1]=parseInt(this.m_quantizationFactor.y*(e-this.m_worldAABB.lowerBound.y))&b2Settings.USHRT_MAX-1;c[1]=parseInt(this.m_quantizationFactor.y*(b-this.m_worldAABB.lowerBound.y))%65535|1};
b2BroadPhase.prototype.TestOverlapValidate=function(a,c){for(var b=0;b<2;++b){var d=this.m_bounds[b],e=d[a.lowerBounds[b]],f=d[c.upperBounds[b]];if(e.value>f.value)return!1;e=d[a.upperBounds[b]];f=d[c.lowerBounds[b]];if(e.value<f.value)return!1}return!0};
b2BroadPhase.prototype.Query=function(a,c,b,d,e,f,g){for(var b=b2BroadPhase.BinarySearch(e,f,b),d=b2BroadPhase.BinarySearch(e,f,d),h=b;h<d;++h)f=e[h],f.IsLower()&&this.IncrementOverlapCount(f.proxyId);if(b>0)for(var h=b-1,f=e[h],i=f.stabbingCount;i;)f=e[h],f.IsLower()&&b<=this.m_proxyPool[f.proxyId].upperBounds[g]&&(this.IncrementOverlapCount(f.proxyId),--i),--h;a[0]=b;c[0]=d};
b2BroadPhase.prototype.IncrementOverlapCount=function(a){var c=this.m_proxyPool[a];c.timeStamp<this.m_timeStamp?(c.timeStamp=this.m_timeStamp,c.overlapCount=1):(c.overlapCount=2,this.m_queryResults[this.m_queryResultCount]=a,++this.m_queryResultCount)};b2BroadPhase.prototype.IncrementTimeStamp=function(){if(this.m_timeStamp==b2Settings.USHRT_MAX){for(var a=0;a<b2Settings.b2_maxProxies;++a)this.m_proxyPool[a].timeStamp=0;this.m_timeStamp=1}else++this.m_timeStamp};
b2BroadPhase.prototype.InRange=function(a){var c,b,d,e;c=a.lowerBound.x;b=a.lowerBound.y;c-=this.m_worldAABB.upperBound.x;b-=this.m_worldAABB.upperBound.y;d=this.m_worldAABB.lowerBound.x;e=this.m_worldAABB.lowerBound.y;d-=a.upperBound.x;e-=a.upperBound.y;c=b2Math.b2Max(c,d);b=b2Math.b2Max(b,e);return b2Math.b2Max(c,b)<0};b2BroadPhase.prototype.GetProxy=function(a){var c=this.m_proxyPool[a];return a==b2Pair.b2_nullProxy||c.IsValid()==!1?null:c};
b2BroadPhase.prototype.CreateProxy=function(a,c){var b=0,d,e=this.m_freeProxy;d=this.m_proxyPool[e];this.m_freeProxy=d.GetNext();d.overlapCount=0;d.userData=c;d=2*this.m_proxyCount;var f=[],g=[];this.ComputeBounds(f,g,a);for(var h=0;h<2;++h){var i=this.m_bounds[h],j=0,k=0,j=[j],k=[k];this.Query(j,k,f[h],g[h],i,d,h);for(var j=j[0],k=k[0],l=[],m=0,n=d-k,o,m=0;m<n;m++)l[m]=new b2Bound,o=l[m],b=i[parseInt(k+m)],o.value=b.value,o.proxyId=b.proxyId,o.stabbingCount=b.stabbingCount;for(var n=l.length,p=k+
2,m=0;m<n;m++)b=l[m],o=i[parseInt(p+m)],o.value=b.value,o.proxyId=b.proxyId,o.stabbingCount=b.stabbingCount;l=[];n=k-j;for(m=0;m<n;m++)l[m]=new b2Bound,o=l[m],b=i[parseInt(j+m)],o.value=b.value,o.proxyId=b.proxyId,o.stabbingCount=b.stabbingCount;n=l.length;p=j+1;for(m=0;m<n;m++)b=l[m],o=i[parseInt(p+m)],o.value=b.value,o.proxyId=b.proxyId,o.stabbingCount=b.stabbingCount;++k;o=i[j];b=i[k];o.value=f[h];o.proxyId=e;b.value=g[h];b.proxyId=e;l=i[parseInt(j-1)];o.stabbingCount=j==0?0:l.stabbingCount;l=
i[parseInt(k-1)];b.stabbingCount=l.stabbingCount;for(b=j;b<k;++b)l=i[b],l.stabbingCount++;for(b=j;b<d+2;++b)o=i[b],j=this.m_proxyPool[o.proxyId],o.IsLower()?j.lowerBounds[h]=b:j.upperBounds[h]=b}++this.m_proxyCount;for(d=0;d<this.m_queryResultCount;++d)this.m_pairManager.AddBufferedPair(e,this.m_queryResults[d]);this.m_pairManager.Commit();this.m_queryResultCount=0;this.IncrementTimeStamp();return e};
b2BroadPhase.prototype.DestroyProxy=function(a){for(var c,b,d=this.m_proxyPool[a],e=2*this.m_proxyCount,f=0;f<2;++f){var g=this.m_bounds[f],h=d.lowerBounds[f],i=d.upperBounds[f];c=g[h];var j=c.value;b=g[i];for(var k=b.value,l=[],m=0,n=i-h-1,m=0;m<n;m++)l[m]=new b2Bound,c=l[m],b=g[parseInt(h+1+m)],c.value=b.value,c.proxyId=b.proxyId,c.stabbingCount=b.stabbingCount;for(var n=l.length,o=h,m=0;m<n;m++)b=l[m],c=g[parseInt(o+m)],c.value=b.value,c.proxyId=b.proxyId,c.stabbingCount=b.stabbingCount;l=[];n=
e-i-1;for(m=0;m<n;m++)l[m]=new b2Bound,c=l[m],b=g[parseInt(i+1+m)],c.value=b.value,c.proxyId=b.proxyId,c.stabbingCount=b.stabbingCount;n=l.length;o=i-1;for(m=0;m<n;m++)b=l[m],c=g[parseInt(o+m)],c.value=b.value,c.proxyId=b.proxyId,c.stabbingCount=b.stabbingCount;n=e-2;for(b=h;b<n;++b)c=g[b],l=this.m_proxyPool[c.proxyId],c.IsLower()?l.lowerBounds[f]=b:l.upperBounds[f]=b;for(n=i-1;h<n;++h)c=g[h],c.stabbingCount--;this.Query([0],[0],j,k,g,e-2,f)}for(c=0;c<this.m_queryResultCount;++c)this.m_pairManager.RemoveBufferedPair(a,
this.m_queryResults[c]);this.m_pairManager.Commit();this.m_queryResultCount=0;this.IncrementTimeStamp();d.userData=null;d.overlapCount=b2BroadPhase.b2_invalid;d.lowerBounds[0]=b2BroadPhase.b2_invalid;d.lowerBounds[1]=b2BroadPhase.b2_invalid;d.upperBounds[0]=b2BroadPhase.b2_invalid;d.upperBounds[1]=b2BroadPhase.b2_invalid;d.SetNext(this.m_freeProxy);this.m_freeProxy=a;--this.m_proxyCount};
b2BroadPhase.prototype.MoveProxy=function(a,c){var b,d,e=0,f=0,g,h;b=0;if(!(a==b2Pair.b2_nullProxy||b2Settings.b2_maxProxies<=a)&&c.IsValid()!=!1){var i=2*this.m_proxyCount,j=this.m_proxyPool[a],k=new b2BoundValues;this.ComputeBounds(k.lowerValues,k.upperValues,c);for(var l=new b2BoundValues,e=0;e<2;++e)g=this.m_bounds[e][j.lowerBounds[e]],l.lowerValues[e]=g.value,g=this.m_bounds[e][j.upperBounds[e]],l.upperValues[e]=g.value;for(e=0;e<2;++e){var m=this.m_bounds[e],n=j.lowerBounds[e],o=j.upperBounds[e],
p=k.lowerValues[e],q=k.upperValues[e];g=m[n];var s=p-g.value;g.value=p;g=m[o];var w=q-g.value;g.value=q;if(s<0)for(f=n;f>0&&p<m[parseInt(f-1)].value;)g=m[f],h=m[parseInt(f-1)],b=h.proxyId,d=this.m_proxyPool[h.proxyId],h.stabbingCount++,h.IsUpper()==!0?(this.TestOverlap(k,d)&&this.m_pairManager.AddBufferedPair(a,b),b=d.upperBounds,d=b[e],d++,b[e]=d,g.stabbingCount++):(b=d.lowerBounds,d=b[e],d++,b[e]=d,g.stabbingCount--),b=j.lowerBounds,d=b[e],d--,b[e]=d,g.Swap(h),--f;if(w>0)for(f=o;f<i-1&&m[parseInt(f+
1)].value<=q;)g=m[f],h=m[parseInt(f+1)],b=h.proxyId,d=this.m_proxyPool[b],h.stabbingCount++,h.IsLower()==!0?(this.TestOverlap(k,d)&&this.m_pairManager.AddBufferedPair(a,b),b=d.lowerBounds,d=b[e],d--,b[e]=d,g.stabbingCount++):(b=d.upperBounds,d=b[e],d--,b[e]=d,g.stabbingCount--),b=j.upperBounds,d=b[e],d++,b[e]=d,g.Swap(h),f++;if(s>0)for(f=n;f<i-1&&m[parseInt(f+1)].value<=p;)g=m[f],h=m[parseInt(f+1)],b=h.proxyId,d=this.m_proxyPool[b],h.stabbingCount--,h.IsUpper()?(this.TestOverlap(l,d)&&this.m_pairManager.RemoveBufferedPair(a,
b),b=d.upperBounds,d=b[e],d--,b[e]=d,g.stabbingCount--):(b=d.lowerBounds,d=b[e],d--,b[e]=d,g.stabbingCount++),b=j.lowerBounds,d=b[e],d++,b[e]=d,g.Swap(h),f++;if(w<0)for(f=o;f>0&&q<m[parseInt(f-1)].value;)g=m[f],h=m[parseInt(f-1)],b=h.proxyId,d=this.m_proxyPool[b],h.stabbingCount--,h.IsLower()==!0?(this.TestOverlap(l,d)&&this.m_pairManager.RemoveBufferedPair(a,b),b=d.lowerBounds,d=b[e],d++,b[e]=d,g.stabbingCount--):(b=d.upperBounds,d=b[e],d++,b[e]=d,g.stabbingCount++),b=j.upperBounds,d=b[e],d--,b[e]=
d,g.Swap(h),f--}}};b2BroadPhase.prototype.Commit=function(){this.m_pairManager.Commit()};b2BroadPhase.prototype.QueryAABB=function(a,c,b){var d=[],e=[];this.ComputeBounds(d,e,a);var a=[0],f=[0];this.Query(a,f,d[0],e[0],this.m_bounds[0],2*this.m_proxyCount,0);this.Query(a,f,d[1],e[1],this.m_bounds[1],2*this.m_proxyCount,1);for(e=d=0;e<this.m_queryResultCount&&d<b;++e,++d)c[e]=this.m_proxyPool[this.m_queryResults[e]].userData;this.m_queryResultCount=0;this.IncrementTimeStamp();return d};
b2BroadPhase.prototype.Validate=function(){for(var a=0;a<2;++a)for(var c=this.m_bounds[a],b=2*this.m_proxyCount,d=0,e=0;e<b;++e)c[e].IsLower()==!0?d++:d--};b2BroadPhase.prototype.TestOverlap=function(a,c){for(var b=0;b<2;++b){var d=this.m_bounds[b],e=d[c.upperBounds[b]];if(a.lowerValues[b]>e.value)return!1;e=d[c.lowerBounds[b]];if(a.upperValues[b]<e.value)return!1}return!0};var b2TimeOfImpact=function(){this.__varz();this.__constructor.apply(this,arguments)};b2TimeOfImpact.prototype.__constructor=function(){};b2TimeOfImpact.prototype.__varz=function(){};b2TimeOfImpact.s_p1=new b2Vec2;b2TimeOfImpact.s_p2=new b2Vec2;b2TimeOfImpact.s_xf1=new b2XForm;b2TimeOfImpact.s_xf2=new b2XForm;
b2TimeOfImpact.TimeOfImpact=function(a,c,b,d){var e,f,g=a.m_sweepRadius,h=b.m_sweepRadius,i=c.t0,j=c.c.x-c.c0.x,k=c.c.y-c.c0.y,l=d.c.x-d.c0.x,m=d.c.y-d.c0.y,n=c.a-c.a0,o=d.a-d.a0,p=0,q=b2TimeOfImpact.s_p1,s=b2TimeOfImpact.s_p2,w=0,z=f=0,t=0;for(e=0;;){t=(1-p)*i+p;f=b2TimeOfImpact.s_xf1;z=b2TimeOfImpact.s_xf2;c.GetXForm(f,t);d.GetXForm(z,t);t=b2Distance.Distance(q,s,a,f,b,z);w==0&&(t>2*b2Settings.b2_toiSlop?e=1.5*b2Settings.b2_toiSlop:(e=0.05*b2Settings.b2_toiSlop,f=t-0.5*b2Settings.b2_toiSlop,e=e>
f?e:f));if(t-e<0.05*b2Settings.b2_toiSlop||w==20)break;f=s.x-q.x;var z=s.y-q.y,u=Math.sqrt(f*f+z*z);f/=u;z/=u;f=f*(j-l)+z*(k-m)+(n<0?-n:n)*g+(o<0?-o:o)*h;if(f==0){p=1;break}t=p+(t-e)/f;if(t<0||1<t){p=1;break}if(t<(1+100*Number.MIN_VALUE)*p)break;p=t;++w}return p};var b2ShapeDef=function(){this.__varz();this.__constructor.apply(this,arguments)};b2ShapeDef.prototype.__constructor=function(){};b2ShapeDef.prototype.__varz=function(){this.type=b2Shape.e_unknownShape;this.filter=new b2FilterData};b2ShapeDef.prototype.type=b2Shape.e_unknownShape;b2ShapeDef.prototype.userData=null;b2ShapeDef.prototype.friction=0.2;b2ShapeDef.prototype.restitution=0;b2ShapeDef.prototype.density=0;b2ShapeDef.prototype.isSensor=!1;b2ShapeDef.prototype.filter=new b2FilterData;var b2PolygonDef=function(){b2ShapeDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolygonDef.prototype,b2ShapeDef.prototype);b2PolygonDef.prototype._super=function(){b2ShapeDef.prototype.__constructor.apply(this,arguments)};b2PolygonDef.prototype.__constructor=function(){this.type=b2Shape.e_polygonShape;for(var a=this.vertexCount=0;a<b2Settings.b2_maxPolygonVertices;a++)this.vertices[a]=new b2Vec2};
b2PolygonDef.prototype.__varz=function(){this.vertices=Array(b2Settings.b2_maxPolygonVertices)};b2PolygonDef.s_mat=new b2Mat22;b2PolygonDef.prototype.vertices=Array(b2Settings.b2_maxPolygonVertices);b2PolygonDef.prototype.vertexCount=0;b2PolygonDef.prototype.SetAsBox=function(a,c){this.vertexCount=4;this.vertices[0].Set(-a,-c);this.vertices[1].Set(a,-c);this.vertices[2].Set(a,c);this.vertices[3].Set(-a,c)};
b2PolygonDef.prototype.SetAsOrientedBox=function(a,c,b,d){this.vertexCount=4;this.vertices[0].Set(-a,-c);this.vertices[1].Set(a,-c);this.vertices[2].Set(a,c);this.vertices[3].Set(-a,c);if(b){var c=b,e=b2PolygonDef.s_mat;e.Set(d);for(d=0;d<this.vertexCount;++d)b=this.vertices[d],a=c.x+(e.col1.x*b.x+e.col2.x*b.y),b.y=c.y+(e.col1.y*b.x+e.col2.y*b.y),b.x=a}};var b2Contact=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Contact.prototype.__constructor=function(a,c){this.m_flags=0;if(!a||!c)this.m_shape2=this.m_shape1=null;else{if(a.IsSensor()||c.IsSensor())this.m_flags|=b2Contact.e_nonSolidFlag;this.m_shape1=a;this.m_shape2=c;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_next=this.m_prev=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;
this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null}};b2Contact.prototype.__varz=function(){this.m_node1=new b2ContactEdge;this.m_node2=new b2ContactEdge};b2Contact.e_nonSolidFlag=1;b2Contact.e_slowFlag=2;b2Contact.e_islandFlag=4;b2Contact.e_toiFlag=8;b2Contact.s_registers=null;b2Contact.s_initialized=!1;
b2Contact.AddType=function(a,c,b,d){b2Contact.s_registers[b][d].createFcn=a;b2Contact.s_registers[b][d].destroyFcn=c;b2Contact.s_registers[b][d].primary=!0;if(b!=d)b2Contact.s_registers[d][b].createFcn=a,b2Contact.s_registers[d][b].destroyFcn=c,b2Contact.s_registers[d][b].primary=!1};
b2Contact.InitializeRegisters=function(){b2Contact.s_registers=Array(b2Shape.e_shapeTypeCount);for(var a=0;a<b2Shape.e_shapeTypeCount;a++){b2Contact.s_registers[a]=Array(b2Shape.e_shapeTypeCount);for(var c=0;c<b2Shape.e_shapeTypeCount;c++)b2Contact.s_registers[a][c]=new b2ContactRegister}b2Contact.AddType(b2CircleContact.Create,b2CircleContact.Destroy,b2Shape.e_circleShape,b2Shape.e_circleShape);b2Contact.AddType(b2PolyAndCircleContact.Create,b2PolyAndCircleContact.Destroy,b2Shape.e_polygonShape,
b2Shape.e_circleShape);b2Contact.AddType(b2PolygonContact.Create,b2PolygonContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_polygonShape)};b2Contact.Create=function(a,c,b){if(b2Contact.s_initialized==!1)b2Contact.InitializeRegisters(),b2Contact.s_initialized=!0;var d=b2Contact.s_registers[a.m_type][c.m_type],e=d.createFcn;if(e!=null)if(d.primary)return e(a,c,b);else{a=e(c,a,b);for(c=0;c<a.m_manifoldCount;++c)b=a.GetManifolds()[c],b.normal=b.normal.Negative();return a}else return null};
b2Contact.Destroy=function(a,c){a.m_manifoldCount>0&&(a.m_shape1.m_body.WakeUp(),a.m_shape2.m_body.WakeUp());var b=b2Contact.s_registers[a.m_shape1.m_type][a.m_shape2.m_type].destroyFcn;b(a,c)};b2Contact.prototype.m_flags=0;b2Contact.prototype.m_prev=null;b2Contact.prototype.m_next=null;b2Contact.prototype.m_node1=new b2ContactEdge;b2Contact.prototype.m_node2=new b2ContactEdge;b2Contact.prototype.m_shape1=null;b2Contact.prototype.m_shape2=null;b2Contact.prototype.m_manifoldCount=0;
b2Contact.prototype.m_friction=null;b2Contact.prototype.m_restitution=null;b2Contact.prototype.m_toi=null;b2Contact.prototype.GetManifolds=function(){return null};b2Contact.prototype.GetManifoldCount=function(){return this.m_manifoldCount};b2Contact.prototype.IsSolid=function(){return(this.m_flags&b2Contact.e_nonSolidFlag)==0};b2Contact.prototype.GetNext=function(){return this.m_next};b2Contact.prototype.GetShape1=function(){return this.m_shape1};b2Contact.prototype.GetShape2=function(){return this.m_shape2};
b2Contact.prototype.Update=function(a){var c=this.m_manifoldCount;this.Evaluate(a);var a=this.m_shape1.m_body,b=this.m_shape2.m_body;this.m_manifoldCount==0&&c>0&&(a.WakeUp(),b.WakeUp());a.IsStatic()||a.IsBullet()||b.IsStatic()||b.IsBullet()?this.m_flags&=~b2Contact.e_slowFlag:this.m_flags|=b2Contact.e_slowFlag};b2Contact.prototype.Evaluate=function(){};var b2DistanceJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2DistanceJoint.prototype,b2Joint.prototype);b2DistanceJoint.prototype._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
b2DistanceJoint.prototype.__constructor=function(a){this._super(a);this.m_localAnchor1.SetV(a.localAnchor1);this.m_localAnchor2.SetV(a.localAnchor2);this.m_length=a.length;this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_inv_dt=this.m_bias=this.m_gamma=this.m_impulse=0};b2DistanceJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_u=new b2Vec2};b2DistanceJoint.prototype.m_localAnchor1=new b2Vec2;
b2DistanceJoint.prototype.m_localAnchor2=new b2Vec2;b2DistanceJoint.prototype.m_u=new b2Vec2;b2DistanceJoint.prototype.m_frequencyHz=null;b2DistanceJoint.prototype.m_dampingRatio=null;b2DistanceJoint.prototype.m_gamma=null;b2DistanceJoint.prototype.m_bias=null;b2DistanceJoint.prototype.m_impulse=null;b2DistanceJoint.prototype.m_mass=null;b2DistanceJoint.prototype.m_length=null;
b2DistanceJoint.prototype.InitVelocityConstraints=function(a){var c,b;this.m_inv_dt=a.inv_dt;var d=this.m_body1,e=this.m_body2;c=d.m_xf.R;var f=this.m_localAnchor1.x-d.m_sweep.localCenter.x,g=this.m_localAnchor1.y-d.m_sweep.localCenter.y;b=c.col1.x*f+c.col2.x*g;g=c.col1.y*f+c.col2.y*g;f=b;c=e.m_xf.R;var h=this.m_localAnchor2.x-e.m_sweep.localCenter.x,i=this.m_localAnchor2.y-e.m_sweep.localCenter.y;b=c.col1.x*h+c.col2.x*i;i=c.col1.y*h+c.col2.y*i;h=b;this.m_u.x=e.m_sweep.c.x+h-d.m_sweep.c.x-f;this.m_u.y=
e.m_sweep.c.y+i-d.m_sweep.c.y-g;b=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);b>b2Settings.b2_linearSlop?this.m_u.Multiply(1/b):this.m_u.SetZero();c=f*this.m_u.y-g*this.m_u.x;var j=h*this.m_u.y-i*this.m_u.x;c=d.m_invMass+d.m_invI*c*c+e.m_invMass+e.m_invI*j*j;this.m_mass=1/c;if(this.m_frequencyHz>0){b-=this.m_length;var j=2*Math.PI*this.m_frequencyHz,k=this.m_mass*j*j;this.m_gamma=1/(a.dt*(2*this.m_mass*this.m_dampingRatio*j+a.dt*k));this.m_bias=b*a.dt*k*this.m_gamma;this.m_mass=1/(c+this.m_gamma)}a.warmStarting?
(this.m_impulse*=a.dtRatio,a=this.m_impulse*this.m_u.x,c=this.m_impulse*this.m_u.y,d.m_linearVelocity.x-=d.m_invMass*a,d.m_linearVelocity.y-=d.m_invMass*c,d.m_angularVelocity-=d.m_invI*(f*c-g*a),e.m_linearVelocity.x+=e.m_invMass*a,e.m_linearVelocity.y+=e.m_invMass*c,e.m_angularVelocity+=e.m_invI*(h*c-i*a)):this.m_impulse=0};
b2DistanceJoint.prototype.SolveVelocityConstraints=function(){var a,c=this.m_body1,b=this.m_body2;a=c.m_xf.R;var d=this.m_localAnchor1.x-c.m_sweep.localCenter.x,e=this.m_localAnchor1.y-c.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e,e=a.col1.y*d+a.col2.y*e,d=f;a=b.m_xf.R;var g=this.m_localAnchor2.x-b.m_sweep.localCenter.x,h=this.m_localAnchor2.y-b.m_sweep.localCenter.y,f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f,f=-this.m_mass*(this.m_u.x*(b.m_linearVelocity.x+-b.m_angularVelocity*h-(c.m_linearVelocity.x+
-c.m_angularVelocity*e))+this.m_u.y*(b.m_linearVelocity.y+b.m_angularVelocity*g-(c.m_linearVelocity.y+c.m_angularVelocity*d))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=f;a=f*this.m_u.x;f*=this.m_u.y;c.m_linearVelocity.x-=c.m_invMass*a;c.m_linearVelocity.y-=c.m_invMass*f;c.m_angularVelocity-=c.m_invI*(d*f-e*a);b.m_linearVelocity.x+=b.m_invMass*a;b.m_linearVelocity.y+=b.m_invMass*f;b.m_angularVelocity+=b.m_invI*(g*f-h*a)};
b2DistanceJoint.prototype.SolvePositionConstraints=function(){var a;if(this.m_frequencyHz>0)return!0;var c=this.m_body1,b=this.m_body2;a=c.m_xf.R;var d=this.m_localAnchor1.x-c.m_sweep.localCenter.x,e=this.m_localAnchor1.y-c.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e,e=a.col1.y*d+a.col2.y*e,d=f;a=b.m_xf.R;var g=this.m_localAnchor2.x-b.m_sweep.localCenter.x,h=this.m_localAnchor2.y-b.m_sweep.localCenter.y,f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f,f=b.m_sweep.c.x+g-c.m_sweep.c.x-d,i=b.m_sweep.c.y+
h-c.m_sweep.c.y-e;a=Math.sqrt(f*f+i*i);f/=a;i/=a;a-=this.m_length;a=b2Math.b2Clamp(a,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var j=-this.m_mass*a;this.m_u.Set(f,i);f=j*this.m_u.x;i=j*this.m_u.y;c.m_sweep.c.x-=c.m_invMass*f;c.m_sweep.c.y-=c.m_invMass*i;c.m_sweep.a-=c.m_invI*(d*i-e*f);b.m_sweep.c.x+=b.m_invMass*f;b.m_sweep.c.y+=b.m_invMass*i;b.m_sweep.a+=b.m_invI*(g*i-h*f);c.SynchronizeTransform();b.SynchronizeTransform();return b2Math.b2Abs(a)<b2Settings.b2_linearSlop};
b2DistanceJoint.prototype.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};b2DistanceJoint.prototype.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};b2DistanceJoint.prototype.GetReactionForce=function(){var a=new b2Vec2;a.SetV(this.m_u);a.Multiply(this.m_inv_dt*this.m_impulse);return a};b2DistanceJoint.prototype.GetReactionTorque=function(){return 0};var b2Body=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Body.prototype.__constructor=function(a,c){this.m_flags=0;a.isBullet&&(this.m_flags|=b2Body.e_bulletFlag);a.fixedRotation&&(this.m_flags|=b2Body.e_fixedRotationFlag);a.allowSleep&&(this.m_flags|=b2Body.e_allowSleepFlag);a.isSleeping&&(this.m_flags|=b2Body.e_sleepFlag);this.m_world=c;this.m_xf.position.SetV(a.position);this.m_xf.R.Set(a.angle);this.m_sweep.localCenter.SetV(a.massData.center);this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=a.angle;var b=this.m_xf.R,d=this.m_sweep.localCenter;this.m_sweep.c.x=
b.col1.x*d.x+b.col2.x*d.y;this.m_sweep.c.y=b.col1.y*d.x+b.col2.y*d.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_next=this.m_prev=this.m_contactList=this.m_jointList=null;this.m_linearDamping=a.linearDamping;this.m_angularDamping=a.angularDamping;this.m_force.Set(0,0);this.m_torque=0;this.m_linearVelocity.SetZero();this.m_invI=this.m_I=this.m_invMass=this.m_sleepTime=this.m_angularVelocity=0;this.m_mass=a.massData.mass;
if(this.m_mass>0)this.m_invMass=1/this.m_mass;if((this.m_flags&b2Body.e_fixedRotationFlag)==0)this.m_I=a.massData.I;if(this.m_I>0)this.m_invI=1/this.m_I;this.m_type=this.m_invMass==0&&this.m_invI==0?b2Body.e_staticType:b2Body.e_dynamicType;this.m_userData=a.userData;this.m_shapeList=null;this.m_shapeCount=0};b2Body.prototype.__varz=function(){this.m_xf=new b2XForm;this.m_sweep=new b2Sweep;this.m_linearVelocity=new b2Vec2;this.m_force=new b2Vec2};b2Body.e_frozenFlag=2;b2Body.e_islandFlag=4;
b2Body.e_sleepFlag=8;b2Body.e_allowSleepFlag=16;b2Body.e_bulletFlag=32;b2Body.e_fixedRotationFlag=64;b2Body.e_staticType=1;b2Body.e_dynamicType=2;b2Body.e_maxTypes=3;b2Body.s_massData=new b2MassData;b2Body.s_xf1=new b2XForm;b2Body.prototype.m_flags=0;b2Body.prototype.m_type=0;b2Body.prototype.m_xf=new b2XForm;b2Body.prototype.m_sweep=new b2Sweep;b2Body.prototype.m_linearVelocity=new b2Vec2;b2Body.prototype.m_angularVelocity=null;b2Body.prototype.m_force=new b2Vec2;b2Body.prototype.m_torque=null;
b2Body.prototype.m_world=null;b2Body.prototype.m_prev=null;b2Body.prototype.m_next=null;b2Body.prototype.m_shapeList=null;b2Body.prototype.m_shapeCount=0;b2Body.prototype.m_jointList=null;b2Body.prototype.m_contactList=null;b2Body.prototype.m_mass=null;b2Body.prototype.m_invMass=null;b2Body.prototype.m_I=null;b2Body.prototype.m_invI=null;b2Body.prototype.m_linearDamping=null;b2Body.prototype.m_angularDamping=null;b2Body.prototype.m_sleepTime=null;b2Body.prototype.m_userData=null;
b2Body.prototype.CreateShape=function(a){if(this.m_world.m_lock==!0)return null;a=b2Shape.Create(a,this.m_world.m_blockAllocator);a.m_next=this.m_shapeList;this.m_shapeList=a;++this.m_shapeCount;a.m_body=this;a.CreateProxy(this.m_world.m_broadPhase,this.m_xf);a.UpdateSweepRadius(this.m_sweep.localCenter);return a};
b2Body.prototype.DestroyShape=function(a){if(this.m_world.m_lock!=!0){a.DestroyProxy(this.m_world.m_broadPhase);for(var c=this.m_shapeList,b=null;c!=null;){if(c==a){b?b.m_next=a.m_next:this.m_shapeList=a.m_next;break}b=c;c=c.m_next}a.m_body=null;a.m_next=null;--this.m_shapeCount;b2Shape.Destroy(a,this.m_world.m_blockAllocator)}};
b2Body.prototype.SetMass=function(a){if(this.m_world.m_lock!=!0){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=a.mass;if(this.m_mass>0)this.m_invMass=1/this.m_mass;if((this.m_flags&b2Body.e_fixedRotationFlag)==0)this.m_I=a.I;if(this.m_I>0)this.m_invI=1/this.m_I;this.m_sweep.localCenter.SetV(a.center);var a=this.m_xf.R,c=this.m_sweep.localCenter;this.m_sweep.c.x=a.col1.x*c.x+a.col2.x*c.y;this.m_sweep.c.y=a.col1.y*c.x+a.col2.y*c.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;
this.m_sweep.c0.SetV(this.m_sweep.c);for(a=this.m_shapeList;a;a=a.m_next)a.UpdateSweepRadius(this.m_sweep.localCenter);a=this.m_type;this.m_type=this.m_invMass==0&&this.m_invI==0?b2Body.e_staticType:b2Body.e_dynamicType;if(a!=this.m_type)for(a=this.m_shapeList;a;a=a.m_next)a.RefilterProxy(this.m_world.m_broadPhase,this.m_xf)}};
b2Body.prototype.SetMassFromShapes=function(){var a;if(this.m_world.m_lock!=!0){var c=this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,b=0,d=b2Body.s_massData;for(a=this.m_shapeList;a;a=a.m_next)a.ComputeMass(d),this.m_mass+=d.mass,c+=d.mass*d.center.x,b+=d.mass*d.center.y,this.m_I+=d.I;if(this.m_mass>0)this.m_invMass=1/this.m_mass,c*=this.m_invMass,b*=this.m_invMass;this.m_I>0&&(this.m_flags&b2Body.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(c*c+b*b),this.m_invI=1/this.m_I):this.m_invI=this.m_I=
0;this.m_sweep.localCenter.Set(c,b);a=this.m_xf.R;c=this.m_sweep.localCenter;this.m_sweep.c.x=a.col1.x*c.x+a.col2.x*c.y;this.m_sweep.c.y=a.col1.y*c.x+a.col2.y*c.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);for(a=this.m_shapeList;a;a=a.m_next)a.UpdateSweepRadius(this.m_sweep.localCenter);a=this.m_type;this.m_type=this.m_invMass==0&&this.m_invI==0?b2Body.e_staticType:b2Body.e_dynamicType;if(a!=this.m_type)for(a=this.m_shapeList;a;a=
a.m_next)a.RefilterProxy(this.m_world.m_broadPhase,this.m_xf)}};
b2Body.prototype.SetXForm=function(a,c){var b;if(this.m_world.m_lock==!0)return!0;if(this.IsFrozen())return!1;this.m_xf.R.Set(c);this.m_xf.position.SetV(a);b=this.m_xf.R;var d=this.m_sweep.localCenter;this.m_sweep.c.x=b.col1.x*d.x+b.col2.x*d.y;this.m_sweep.c.y=b.col1.y*d.x+b.col2.y*d.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=c;d=!1;for(b=this.m_shapeList;b;b=b.m_next)if(b.Synchronize(this.m_world.m_broadPhase,
this.m_xf,this.m_xf)==!1){d=!0;break}if(d==!0){this.m_flags|=b2Body.e_frozenFlag;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;for(b=this.m_shapeList;b;b=b.m_next)b.DestroyProxy(this.m_world.m_broadPhase);return!1}this.m_world.m_broadPhase.Commit();return!0};b2Body.prototype.GetXForm=function(){return this.m_xf};b2Body.prototype.GetPosition=function(){return this.m_xf.position};b2Body.prototype.GetAngle=function(){return this.m_sweep.a};b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c};
b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};b2Body.prototype.SetLinearVelocity=function(a){this.m_linearVelocity.SetV(a)};b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};b2Body.prototype.SetAngularVelocity=function(a){this.m_angularVelocity=a};b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};
b2Body.prototype.ApplyForce=function(a,c){this.IsSleeping()&&this.WakeUp();this.m_force.x+=a.x;this.m_force.y+=a.y;this.m_torque+=(c.x-this.m_sweep.c.x)*a.y-(c.y-this.m_sweep.c.y)*a.x};b2Body.prototype.ApplyTorque=function(a){this.IsSleeping()&&this.WakeUp();this.m_torque+=a};
b2Body.prototype.ApplyImpulse=function(a,c){this.IsSleeping()&&this.WakeUp();this.m_linearVelocity.x+=this.m_invMass*a.x;this.m_linearVelocity.y+=this.m_invMass*a.y;this.m_angularVelocity+=this.m_invI*((c.x-this.m_sweep.c.x)*a.y-(c.y-this.m_sweep.c.y)*a.x)};b2Body.prototype.GetMass=function(){return this.m_mass};b2Body.prototype.GetInertia=function(){return this.m_I};
b2Body.prototype.GetWorldPoint=function(a){var c=this.m_xf.R,a=new b2Vec2(c.col1.x*a.x+c.col2.x*a.y,c.col1.y*a.x+c.col2.y*a.y);a.x+=this.m_xf.position.x;a.y+=this.m_xf.position.y;return a};b2Body.prototype.GetWorldVector=function(a){return b2Math.b2MulMV(this.m_xf.R,a)};b2Body.prototype.GetLocalPoint=function(a){return b2Math.b2MulXT(this.m_xf,a)};b2Body.prototype.GetLocalVector=function(a){return b2Math.b2MulTMV(this.m_xf.R,a)};
b2Body.prototype.GetLinearVelocityFromWorldPoint=function(a){return new b2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))};
b2Body.prototype.GetLinearVelocityFromLocalPoint=function(a){var c=this.m_xf.R,a=new b2Vec2(c.col1.x*a.x+c.col2.x*a.y,c.col1.y*a.x+c.col2.y*a.y);a.x+=this.m_xf.position.x;a.y+=this.m_xf.position.y;return new b2Vec2(this.m_linearVelocity.x+this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.x-this.m_angularVelocity*(a.x-this.m_sweep.c.x))};b2Body.prototype.IsBullet=function(){return(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag};
b2Body.prototype.SetBullet=function(a){a?this.m_flags|=b2Body.e_bulletFlag:this.m_flags&=~b2Body.e_bulletFlag};b2Body.prototype.IsStatic=function(){return this.m_type==b2Body.e_staticType};b2Body.prototype.IsDynamic=function(){return this.m_type==b2Body.e_dynamicType};b2Body.prototype.IsFrozen=function(){return(this.m_flags&b2Body.e_frozenFlag)==b2Body.e_frozenFlag};b2Body.prototype.IsSleeping=function(){return(this.m_flags&b2Body.e_sleepFlag)==b2Body.e_sleepFlag};
b2Body.prototype.AllowSleeping=function(a){a?this.m_flags|=b2Body.e_allowSleepFlag:(this.m_flags&=~b2Body.e_allowSleepFlag,this.WakeUp())};b2Body.prototype.WakeUp=function(){this.m_flags&=~b2Body.e_sleepFlag;this.m_sleepTime=0};b2Body.prototype.PutToSleep=function(){this.m_flags|=b2Body.e_sleepFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0};b2Body.prototype.GetShapeList=function(){return this.m_shapeList};
b2Body.prototype.GetJointList=function(){return this.m_jointList};b2Body.prototype.GetNext=function(){return this.m_next};b2Body.prototype.GetUserData=function(){return this.m_userData};b2Body.prototype.SetUserData=function(a){this.m_userData=a};b2Body.prototype.GetWorld=function(){return this.m_world};
b2Body.prototype.SynchronizeShapes=function(){var a=b2Body.s_xf1;a.R.Set(this.m_sweep.a0);var c=a.R,b=this.m_sweep.localCenter;a.position.x=this.m_sweep.c0.x-(c.col1.x*b.x+c.col2.x*b.y);a.position.y=this.m_sweep.c0.y-(c.col1.y*b.x+c.col2.y*b.y);b=!0;for(c=this.m_shapeList;c;c=c.m_next)if(b=c.Synchronize(this.m_world.m_broadPhase,a,this.m_xf),b==!1)break;if(b==!1){this.m_flags|=b2Body.e_frozenFlag;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;for(c=this.m_shapeList;c;c=c.m_next)c.DestroyProxy(this.m_world.m_broadPhase);
return!1}return!0};b2Body.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var a=this.m_xf.R,c=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*c.x+a.col2.x*c.y);this.m_xf.position.y=this.m_sweep.c.y-(a.col1.y*c.x+a.col2.y*c.y)};b2Body.prototype.IsConnected=function(a){for(var c=this.m_jointList;c;c=c.next)if(c.other==a)return c.joint.m_collideConnected==!1;return!1};
b2Body.prototype.Advance=function(a){this.m_sweep.Advance(a);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};var b2ContactFilter=function(){this.__varz();this.__constructor.apply(this,arguments)};b2ContactFilter.prototype.__constructor=function(){};b2ContactFilter.prototype.__varz=function(){};b2ContactFilter.b2_defaultFilter=new b2ContactFilter;b2ContactFilter.prototype.ShouldCollide=function(a,c){var b=a.GetFilterData(),d=c.GetFilterData();return b.groupIndex==d.groupIndex&&b.groupIndex!=0?b.groupIndex>0:(b.maskBits&d.categoryBits)!=0&&(b.categoryBits&d.maskBits)!=0};var b2PolygonShape=function(){b2Shape.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolygonShape.prototype,b2Shape.prototype);b2PolygonShape.prototype._super=function(){b2Shape.prototype.__constructor.apply(this,arguments)};
b2PolygonShape.prototype.__constructor=function(a){this._super(a);this.m_type=b2Shape.e_polygonShape;this.m_vertexCount=a.vertexCount;for(var c=0,b=c,d=c,c=0;c<this.m_vertexCount;++c)this.m_vertices[c]=a.vertices[c].Copy();for(c=0;c<this.m_vertexCount;++c){var b=c,d=c+1<this.m_vertexCount?c+1:0,e=this.m_vertices[d].x-this.m_vertices[b].x,b=this.m_vertices[d].y-this.m_vertices[b].y,d=Math.sqrt(e*e+b*b);this.m_normals[c]=new b2Vec2(b/d,-e/d)}this.m_centroid=b2PolygonShape.ComputeCentroid(a.vertices,
a.vertexCount);b2PolygonShape.ComputeOBB(this.m_obb,this.m_vertices,this.m_vertexCount);for(c=0;c<this.m_vertexCount;++c){var b=c-1>=0?c-1:this.m_vertexCount-1,d=c,a=this.m_normals[b].x,e=this.m_normals[b].y,b=this.m_normals[d].x,d=this.m_normals[d].y,f=this.m_vertices[c].x-this.m_centroid.x,g=this.m_vertices[c].y-this.m_centroid.y,h=a*f+e*g-b2Settings.b2_toiSlop,f=b*f+d*g-b2Settings.b2_toiSlop,g=1/(a*d-e*b);this.m_coreVertices[c]=new b2Vec2(g*(d*h-e*f)+this.m_centroid.x,g*(a*f-b*h)+this.m_centroid.y)}};
b2PolygonShape.prototype.__varz=function(){this.s_supportVec=new b2Vec2;this.m_obb=new b2OBB;this.m_vertices=Array(b2Settings.b2_maxPolygonVertices);this.m_normals=Array(b2Settings.b2_maxPolygonVertices);this.m_coreVertices=Array(b2Settings.b2_maxPolygonVertices)};b2PolygonShape.s_computeMat=new b2Mat22;b2PolygonShape.s_sweptAABB1=new b2AABB;b2PolygonShape.s_sweptAABB2=new b2AABB;
b2PolygonShape.ComputeCentroid=function(a,c){for(var b=new b2Vec2,d=0,e=1/3,f=0;f<c;++f){var g=a[f],h=f+1<c?a[parseInt(f+1)]:a[0],i=0.5*((g.x-0)*(h.y-0)-(g.y-0)*(h.x-0));d+=i;b.x+=i*e*(0+g.x+h.x);b.y+=i*e*(0+g.y+h.y)}b.x*=1/d;b.y*=1/d;return b};
b2PolygonShape.ComputeOBB=function(a,c,b){for(var d=0,e=Array(b2Settings.b2_maxPolygonVertices+1),d=0;d<b;++d)e[d]=c[d];e[b]=e[0];c=Number.MAX_VALUE;for(d=1;d<=b;++d){var f=e[parseInt(d-1)],g=e[d].x-f.x,h=e[d].y-f.y,i=Math.sqrt(g*g+h*h);g/=i;h/=i;for(var j=-h,k=g,l=i=Number.MAX_VALUE,m=-Number.MAX_VALUE,n=-Number.MAX_VALUE,o=0;o<b;++o){var p=e[o].x-f.x,q=e[o].y-f.y,s=g*p+h*q,p=j*p+k*q;s<i&&(i=s);p<l&&(l=p);s>m&&(m=s);p>n&&(n=p)}o=(m-i)*(n-l);if(o<0.95*c)c=o,a.R.col1.x=g,a.R.col1.y=h,a.R.col2.x=j,
a.R.col2.y=k,g=0.5*(i+m),h=0.5*(l+n),j=a.R,a.center.x=f.x+(j.col1.x*g+j.col2.x*h),a.center.y=f.y+(j.col1.y*g+j.col2.y*h),a.extents.x=0.5*(m-i),a.extents.y=0.5*(n-l)}};b2PolygonShape.prototype.s_supportVec=new b2Vec2;b2PolygonShape.prototype.m_centroid=null;b2PolygonShape.prototype.m_obb=new b2OBB;b2PolygonShape.prototype.m_vertices=Array(b2Settings.b2_maxPolygonVertices);b2PolygonShape.prototype.m_normals=Array(b2Settings.b2_maxPolygonVertices);b2PolygonShape.prototype.m_coreVertices=Array(b2Settings.b2_maxPolygonVertices);
b2PolygonShape.prototype.m_vertexCount=0;b2PolygonShape.prototype.TestPoint=function(a,c){var b;b=a.R;for(var d=c.x-a.position.x,e=c.y-a.position.y,f=d*b.col1.x+e*b.col1.y,g=d*b.col2.x+e*b.col2.y,h=0;h<this.m_vertexCount;++h)if(b=this.m_vertices[h],d=f-b.x,e=g-b.y,b=this.m_normals[h],b.x*d+b.y*e>0)return!1;return!0};
b2PolygonShape.prototype.TestSegment=function(a,c,b,d,e){var f=0,g,h,i,j;g=d.p1.x-a.position.x;h=d.p1.y-a.position.y;i=a.R;var k=g*i.col1.x+h*i.col1.y,l=g*i.col2.x+h*i.col2.y;g=d.p2.x-a.position.x;h=d.p2.y-a.position.y;i=a.R;d=g*i.col1.x+h*i.col1.y-k;i=g*i.col2.x+h*i.col2.y-l;for(var m=-1,n=0;n<this.m_vertexCount;++n)if(j=this.m_vertices[n],g=j.x-k,h=j.y-l,j=this.m_normals[n],g=j.x*g+j.y*h,h=j.x*d+j.y*i,h<0&&g<f*h?(f=g/h,m=n):h>0&&g<e*h&&(e=g/h),e<f)return!1;return m>=0?(c[0]=f,i=a.R,j=this.m_normals[m],
b.x=i.col1.x*j.x+i.col2.x*j.y,b.y=i.col1.y*j.x+i.col2.y*j.y,!0):!1};
b2PolygonShape.prototype.ComputeAABB=function(a,c){var b,d,e=b2PolygonShape.s_computeMat;b=c.R;d=this.m_obb.R.col1;e.col1.x=b.col1.x*d.x+b.col2.x*d.y;e.col1.y=b.col1.y*d.x+b.col2.y*d.y;d=this.m_obb.R.col2;e.col2.x=b.col1.x*d.x+b.col2.x*d.y;e.col2.y=b.col1.y*d.x+b.col2.y*d.y;e.Abs();d=this.m_obb.extents;var f=e.col1.x*d.x+e.col2.x*d.y,e=e.col1.y*d.x+e.col2.y*d.y;b=c.R;d=this.m_obb.center;var g=c.position.x+(b.col1.x*d.x+b.col2.x*d.y);b=c.position.y+(b.col1.y*d.x+b.col2.y*d.y);a.lowerBound.Set(g-f,
b-e);a.upperBound.Set(g+f,b+e)};b2PolygonShape.prototype.ComputeSweptAABB=function(a,c,b){var d=b2PolygonShape.s_sweptAABB1,e=b2PolygonShape.s_sweptAABB2;this.ComputeAABB(d,c);this.ComputeAABB(e,b);a.lowerBound.Set(d.lowerBound.x<e.lowerBound.x?d.lowerBound.x:e.lowerBound.x,d.lowerBound.y<e.lowerBound.y?d.lowerBound.y:e.lowerBound.y);a.upperBound.Set(d.upperBound.x>e.upperBound.x?d.upperBound.x:e.upperBound.x,d.upperBound.y>e.upperBound.y?d.upperBound.y:e.upperBound.y)};
b2PolygonShape.prototype.ComputeMass=function(a){for(var c=0,b=0,d=0,e=0,f=1/3,g=0;g<this.m_vertexCount;++g){var h=this.m_vertices[g],i=g+1<this.m_vertexCount?this.m_vertices[parseInt(g+1)]:this.m_vertices[0],j=h.x-0,k=h.y-0,l=i.x-0,m=i.y-0,n=j*m-k*l,o=0.5*n;d+=o;c+=o*f*(0+h.x+i.x);b+=o*f*(0+h.y+i.y);h=j;e+=n*(f*(0.25*(h*h+l*h+l*l)+(0*h+0*l))+0+(f*(0.25*(k*k+m*k+m*m)+(0*k+0*m))+0))}a.mass=this.m_density*d;c*=1/d;b*=1/d;a.center.Set(c,b);a.I=this.m_density*e};b2PolygonShape.prototype.GetOBB=function(){return this.m_obb};
b2PolygonShape.prototype.GetCentroid=function(){return this.m_centroid};b2PolygonShape.prototype.GetVertexCount=function(){return this.m_vertexCount};b2PolygonShape.prototype.GetVertices=function(){return this.m_vertices};b2PolygonShape.prototype.GetCoreVertices=function(){return this.m_coreVertices};b2PolygonShape.prototype.GetNormals=function(){return this.m_normals};b2PolygonShape.prototype.GetFirstVertex=function(a){return b2Math.b2MulX(a,this.m_coreVertices[0])};
b2PolygonShape.prototype.Centroid=function(a){return b2Math.b2MulX(a,this.m_centroid)};b2PolygonShape.prototype.Support=function(a,c,b){var d;d=a.R;var e=c*d.col1.x+b*d.col1.y;d=c*d.col2.x+b*d.col2.y;for(var c=0,b=this.m_coreVertices[0],f=b.x*e+b.y*d,g=1;g<this.m_vertexCount;++g)b=this.m_coreVertices[g],b=b.x*e+b.y*d,b>f&&(c=g,f=b);d=a.R;b=this.m_coreVertices[c];this.s_supportVec.x=a.position.x+(d.col1.x*b.x+d.col2.x*b.y);this.s_supportVec.y=a.position.y+(d.col1.y*b.x+d.col2.y*b.y);return this.s_supportVec};
b2PolygonShape.prototype.UpdateSweepRadius=function(a){for(var c,b=this.m_sweepRadius=0;b<this.m_vertexCount;++b){c=this.m_coreVertices[b];var d=c.x-a.x;c=c.y-a.y;d=Math.sqrt(d*d+c*c);if(d>this.m_sweepRadius)this.m_sweepRadius=d}};var b2ContactResult=function(){this.__varz();this.__constructor.apply(this,arguments)};b2ContactResult.prototype.__constructor=function(){};b2ContactResult.prototype.__varz=function(){this.position=new b2Vec2;this.normal=new b2Vec2;this.id=new b2ContactID};b2ContactResult.prototype.shape1=null;b2ContactResult.prototype.shape2=null;b2ContactResult.prototype.position=new b2Vec2;b2ContactResult.prototype.normal=new b2Vec2;b2ContactResult.prototype.normalImpulse=null;
b2ContactResult.prototype.tangentImpulse=null;b2ContactResult.prototype.id=new b2ContactID;var b2Island=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2Island.prototype.__constructor=function(a,c,b,d,e){var f=0;this.m_bodyCapacity=a;this.m_contactCapacity=c;this.m_jointCapacity=b;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=d;this.m_listener=e;this.m_bodies=Array(a);for(f=0;f<a;f++)this.m_bodies[f]=null;this.m_contacts=Array(c);for(f=0;f<c;f++)this.m_contacts[f]=null;this.m_joints=Array(b);for(f=0;f<b;f++)this.m_joints[f]=null;this.m_positionIterationCount=0};b2Island.prototype.__varz=function(){};
b2Island.s_reportCR=new b2ContactResult;b2Island.prototype.m_allocator=null;b2Island.prototype.m_listener=null;b2Island.prototype.m_bodies=null;b2Island.prototype.m_contacts=null;b2Island.prototype.m_joints=null;b2Island.prototype.m_bodyCount=0;b2Island.prototype.m_jointCount=0;b2Island.prototype.m_contactCount=0;b2Island.prototype.m_bodyCapacity=0;b2Island.prototype.m_contactCapacity=0;b2Island.prototype.m_jointCapacity=0;b2Island.prototype.m_positionIterationCount=0;
b2Island.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0};
b2Island.prototype.Solve=function(a,c,b,d){for(var e=0,f,e=0;e<this.m_bodyCount;++e)if(f=this.m_bodies[e],!f.IsStatic()&&(f.m_linearVelocity.x+=a.dt*(c.x+f.m_invMass*f.m_force.x),f.m_linearVelocity.y+=a.dt*(c.y+f.m_invMass*f.m_force.y),f.m_angularVelocity+=a.dt*f.m_invI*f.m_torque,f.m_force.SetZero(),f.m_torque=0,f.m_linearVelocity.Multiply(b2Math.b2Clamp(1-a.dt*f.m_linearDamping,0,1)),f.m_angularVelocity*=b2Math.b2Clamp(1-a.dt*f.m_angularDamping,0,1),f.m_linearVelocity.LengthSquared()>b2Settings.b2_maxLinearVelocitySquared&&
(f.m_linearVelocity.Normalize(),f.m_linearVelocity.x*=b2Settings.b2_maxLinearVelocity,f.m_linearVelocity.y*=b2Settings.b2_maxLinearVelocity),f.m_angularVelocity*f.m_angularVelocity>b2Settings.b2_maxAngularVelocitySquared))f.m_angularVelocity=f.m_angularVelocity<0?-b2Settings.b2_maxAngularVelocity:b2Settings.b2_maxAngularVelocity;c=new b2ContactSolver(a,this.m_contacts,this.m_contactCount,this.m_allocator);c.InitVelocityConstraints(a);for(e=0;e<this.m_jointCount;++e)f=this.m_joints[e],f.InitVelocityConstraints(a);
for(e=0;e<a.maxIterations;++e){c.SolveVelocityConstraints();for(var g=0;g<this.m_jointCount;++g)f=this.m_joints[g],f.SolveVelocityConstraints(a)}c.FinalizeVelocityConstraints();for(e=0;e<this.m_bodyCount;++e)if(f=this.m_bodies[e],!f.IsStatic())f.m_sweep.c0.SetV(f.m_sweep.c),f.m_sweep.a0=f.m_sweep.a,f.m_sweep.c.x+=a.dt*f.m_linearVelocity.x,f.m_sweep.c.y+=a.dt*f.m_linearVelocity.y,f.m_sweep.a+=a.dt*f.m_angularVelocity,f.SynchronizeTransform();if(b){for(e=0;e<this.m_jointCount;++e)f=this.m_joints[e],
f.InitPositionConstraints();for(this.m_positionIterationCount=0;this.m_positionIterationCount<a.maxIterations;++this.m_positionIterationCount){b=c.SolvePositionConstraints(b2Settings.b2_contactBaumgarte);g=!0;for(e=0;e<this.m_jointCount;++e)f=this.m_joints[e],f=f.SolvePositionConstraints(),g=g&&f;if(b&&g)break}}this.Report(c.m_constraints);if(d){d=Number.MAX_VALUE;c=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance;b=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance;
for(e=0;e<this.m_bodyCount;++e)if(f=this.m_bodies[e],f.m_invMass!=0){if((f.m_flags&b2Body.e_allowSleepFlag)==0)d=f.m_sleepTime=0;(f.m_flags&b2Body.e_allowSleepFlag)==0||f.m_angularVelocity*f.m_angularVelocity>b||b2Math.b2Dot(f.m_linearVelocity,f.m_linearVelocity)>c?d=f.m_sleepTime=0:(f.m_sleepTime+=a.dt,d=b2Math.b2Min(d,f.m_sleepTime))}if(d>=b2Settings.b2_timeToSleep)for(e=0;e<this.m_bodyCount;++e)f=this.m_bodies[e],f.m_flags|=b2Body.e_sleepFlag,f.m_linearVelocity.SetZero(),f.m_angularVelocity=0}};
b2Island.prototype.SolveTOI=function(a){for(var c=0,b=new b2ContactSolver(a,this.m_contacts,this.m_contactCount,this.m_allocator),c=0;c<a.maxIterations;++c)b.SolveVelocityConstraints();for(c=0;c<this.m_bodyCount;++c){var d=this.m_bodies[c];if(!d.IsStatic())d.m_sweep.c0.SetV(d.m_sweep.c),d.m_sweep.a0=d.m_sweep.a,d.m_sweep.c.x+=a.dt*d.m_linearVelocity.x,d.m_sweep.c.y+=a.dt*d.m_linearVelocity.y,d.m_sweep.a+=a.dt*d.m_angularVelocity,d.SynchronizeTransform()}for(c=0;c<a.maxIterations;++c)if(b.SolvePositionConstraints(0.75))break;
this.Report(b.m_constraints)};
b2Island.prototype.Report=function(a){if(this.m_listener!=null)for(var c=0;c<this.m_contactCount;++c){var b=this.m_contacts[c],d=a[c],e=b2Island.s_reportCR;e.shape1=b.m_shape1;e.shape2=b.m_shape2;for(var f=e.shape1.m_body,g=b.m_manifoldCount,b=b.GetManifolds(),h=0;h<g;++h){var i=b[h];e.normal.SetV(i.normal);for(var j=0;j<i.pointCount;++j){var k=i.points[j],l=d.points[j];e.position=f.GetWorldPoint(k.localPoint1);e.normalImpulse=l.normalImpulse;e.tangentImpulse=l.tangentImpulse;e.id.key=k.id.key;this.m_listener.Result(e)}}}};
b2Island.prototype.AddBody=function(a){this.m_bodies[this.m_bodyCount++]=a};b2Island.prototype.AddContact=function(a){this.m_contacts[this.m_contactCount++]=a};b2Island.prototype.AddJoint=function(a){this.m_joints[this.m_jointCount++]=a};var b2ManifoldPoint=function(){this.__varz();this.__constructor.apply(this,arguments)};b2ManifoldPoint.prototype.__constructor=function(){};b2ManifoldPoint.prototype.__varz=function(){this.localPoint1=new b2Vec2;this.localPoint2=new b2Vec2;this.id=new b2ContactID};b2ManifoldPoint.prototype.localPoint1=new b2Vec2;b2ManifoldPoint.prototype.localPoint2=new b2Vec2;b2ManifoldPoint.prototype.separation=null;b2ManifoldPoint.prototype.normalImpulse=null;b2ManifoldPoint.prototype.tangentImpulse=null;
b2ManifoldPoint.prototype.id=new b2ContactID;b2ManifoldPoint.prototype.Reset=function(){this.localPoint1.SetZero();this.localPoint2.SetZero();this.tangentImpulse=this.normalImpulse=this.separation=0;this.id.key=0};b2ManifoldPoint.prototype.Set=function(a){this.localPoint1.SetV(a.localPoint1);this.localPoint2.SetV(a.localPoint2);this.separation=a.separation;this.normalImpulse=a.normalImpulse;this.tangentImpulse=a.tangentImpulse;this.id.key=a.id.key};var b2Math=function(){this.__varz();this.__constructor.apply(this,arguments)};b2Math.prototype.__constructor=function(){};b2Math.prototype.__varz=function(){};b2Math.b2Vec2_zero=new b2Vec2(0,0);b2Math.b2Mat22_identity=new b2Mat22(0,new b2Vec2(1,0),new b2Vec2(0,1));b2Math.b2XForm_identity=new b2XForm(b2Math.b2Vec2_zero,b2Math.b2Mat22_identity);b2Math.b2IsValid=function(a){return isFinite(a)};b2Math.b2Dot=function(a,c){return a.x*c.x+a.y*c.y};b2Math.b2CrossVV=function(a,c){return a.x*c.y-a.y*c.x};
b2Math.b2CrossVF=function(a,c){return new b2Vec2(c*a.y,-c*a.x)};b2Math.b2CrossFV=function(a,c){return new b2Vec2(-a*c.y,a*c.x)};b2Math.b2MulMV=function(a,c){return new b2Vec2(a.col1.x*c.x+a.col2.x*c.y,a.col1.y*c.x+a.col2.y*c.y)};b2Math.b2MulTMV=function(a,c){return new b2Vec2(b2Math.b2Dot(c,a.col1),b2Math.b2Dot(c,a.col2))};b2Math.b2MulX=function(a,c){var b=b2Math.b2MulMV(a.R,c);b.x+=a.position.x;b.y+=a.position.y;return b};
b2Math.b2MulXT=function(a,c){var b=b2Math.SubtractVV(c,a.position),d=b.x*a.R.col1.x+b.y*a.R.col1.y;b.y=b.x*a.R.col2.x+b.y*a.R.col2.y;b.x=d;return b};b2Math.AddVV=function(a,c){return new b2Vec2(a.x+c.x,a.y+c.y)};b2Math.SubtractVV=function(a,c){return new b2Vec2(a.x-c.x,a.y-c.y)};b2Math.b2Distance=function(a,c){var b=a.x-c.x,d=a.y-c.y;return Math.sqrt(b*b+d*d)};b2Math.b2DistanceSquared=function(a,c){var b=a.x-c.x,d=a.y-c.y;return b*b+d*d};b2Math.MulFV=function(a,c){return new b2Vec2(a*c.x,a*c.y)};
b2Math.AddMM=function(a,c){return new b2Mat22(0,b2Math.AddVV(a.col1,c.col1),b2Math.AddVV(a.col2,c.col2))};b2Math.b2MulMM=function(a,c){return new b2Mat22(0,b2Math.b2MulMV(a,c.col1),b2Math.b2MulMV(a,c.col2))};b2Math.b2MulTMM=function(a,c){var b=new b2Vec2(b2Math.b2Dot(a.col1,c.col1),b2Math.b2Dot(a.col2,c.col1)),d=new b2Vec2(b2Math.b2Dot(a.col1,c.col2),b2Math.b2Dot(a.col2,c.col2));return new b2Mat22(0,b,d)};b2Math.b2Abs=function(a){return a>0?a:-a};
b2Math.b2AbsV=function(a){return new b2Vec2(b2Math.b2Abs(a.x),b2Math.b2Abs(a.y))};b2Math.b2AbsM=function(a){return new b2Mat22(0,b2Math.b2AbsV(a.col1),b2Math.b2AbsV(a.col2))};b2Math.b2Min=function(a,c){return a<c?a:c};b2Math.b2MinV=function(a,c){return new b2Vec2(b2Math.b2Min(a.x,c.x),b2Math.b2Min(a.y,c.y))};b2Math.b2Max=function(a,c){return a>c?a:c};b2Math.b2MaxV=function(a,c){return new b2Vec2(b2Math.b2Max(a.x,c.x),b2Math.b2Max(a.y,c.y))};
b2Math.b2Clamp=function(a,c,b){return b2Math.b2Max(c,b2Math.b2Min(a,b))};b2Math.b2ClampV=function(a,c,b){return b2Math.b2MaxV(c,b2Math.b2MinV(a,b))};b2Math.b2Swap=function(a,c){var b=a[0];a[0]=c[0];c[0]=b};b2Math.b2Random=function(){return Math.random()*2-1};b2Math.b2RandomRange=function(a,c){var b=Math.random();return(c-a)*b+a};b2Math.b2NextPowerOfTwo=function(a){a|=a>>1&2147483647;a|=a>>2&1073741823;a|=a>>4&268435455;a|=a>>8&16777215;a|=a>>16&65535;return a+1};
b2Math.b2IsPowerOfTwo=function(a){return a>0&&(a&a-1)==0};var b2CircleDef=function(){b2ShapeDef.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2CircleDef.prototype,b2ShapeDef.prototype);b2CircleDef.prototype._super=function(){b2ShapeDef.prototype.__constructor.apply(this,arguments)};b2CircleDef.prototype.__constructor=function(){this.type=b2Shape.e_circleShape;this.radius=1};b2CircleDef.prototype.__varz=function(){this.localPosition=new b2Vec2(0,0)};b2CircleDef.prototype.localPosition=new b2Vec2(0,0);
b2CircleDef.prototype.radius=null;var b2ContactPoint=function(){this.__varz();this.__constructor.apply(this,arguments)};b2ContactPoint.prototype.__constructor=function(){};b2ContactPoint.prototype.__varz=function(){this.position=new b2Vec2;this.velocity=new b2Vec2;this.normal=new b2Vec2;this.id=new b2ContactID};b2ContactPoint.prototype.shape1=null;b2ContactPoint.prototype.shape2=null;b2ContactPoint.prototype.position=new b2Vec2;b2ContactPoint.prototype.velocity=new b2Vec2;b2ContactPoint.prototype.normal=new b2Vec2;
b2ContactPoint.prototype.separation=null;b2ContactPoint.prototype.friction=null;b2ContactPoint.prototype.restitution=null;b2ContactPoint.prototype.id=new b2ContactID;var b2PolygonContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolygonContact.prototype,b2Contact.prototype);b2PolygonContact.prototype._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};b2PolygonContact.prototype.__constructor=function(a,c){this._super(a,c);this.m_manifold=this.m_manifolds[0];this.m_manifold.pointCount=0};
b2PolygonContact.prototype.__varz=function(){this.m0=new b2Manifold;this.m_manifolds=[new b2Manifold]};b2PolygonContact.s_evalCP=new b2ContactPoint;b2PolygonContact.Create=function(a,c){return new b2PolygonContact(a,c)};b2PolygonContact.Destroy=function(){};b2PolygonContact.prototype.m0=new b2Manifold;b2PolygonContact.prototype.m_manifolds=[new b2Manifold];b2PolygonContact.prototype.m_manifold=null;
b2PolygonContact.prototype.Evaluate=function(a){var c,b,d,e=this.m_shape1.m_body,f=this.m_shape2.m_body,g,h=0;this.m0.Set(this.m_manifold);b2Collision.b2CollidePolygons(this.m_manifold,this.m_shape1,e.m_xf,this.m_shape2,f.m_xf);var i=[!1,!1];g=b2PolygonContact.s_evalCP;g.shape1=this.m_shape1;g.shape2=this.m_shape2;g.friction=this.m_friction;g.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){for(h=0;h<this.m_manifold.pointCount;++h){var j=this.m_manifold.points[h];j.normalImpulse=0;
j.tangentImpulse=0;var k=!1,l=j.id._key;for(c=0;c<this.m0.pointCount;++c)if(i[c]!=!0&&(d=this.m0.points[c],d.id._key==l)){i[c]=!0;j.normalImpulse=d.normalImpulse;j.tangentImpulse=d.tangentImpulse;k=!0;if(a!=null)g.position=e.GetWorldPoint(j.localPoint1),c=e.GetLinearVelocityFromLocalPoint(j.localPoint1),b=f.GetLinearVelocityFromLocalPoint(j.localPoint2),g.velocity.Set(b.x-c.x,b.y-c.y),g.normal.SetV(this.m_manifold.normal),g.separation=j.separation,g.id.key=l,a.Persist(g);break}if(k==!1&&a!=null)g.position=
e.GetWorldPoint(j.localPoint1),c=e.GetLinearVelocityFromLocalPoint(j.localPoint1),b=f.GetLinearVelocityFromLocalPoint(j.localPoint2),g.velocity.Set(b.x-c.x,b.y-c.y),g.normal.SetV(this.m_manifold.normal),g.separation=j.separation,g.id.key=l,a.Add(g)}this.m_manifoldCount=1}else this.m_manifoldCount=0;if(a!=null)for(h=0;h<this.m0.pointCount;++h)if(!i[h])d=this.m0.points[h],g.position=e.GetWorldPoint(d.localPoint1),c=e.GetLinearVelocityFromLocalPoint(d.localPoint1),b=f.GetLinearVelocityFromLocalPoint(d.localPoint2),
g.velocity.Set(b.x-c.x,b.y-c.y),g.normal.SetV(this.m0.normal),g.separation=d.separation,g.id.key=d.id._key,a.Remove(g)};b2PolygonContact.prototype.GetManifolds=function(){return this.m_manifolds};var b2MouseJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2MouseJoint.prototype,b2Joint.prototype);b2MouseJoint.prototype._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
b2MouseJoint.prototype.__constructor=function(a){this._super(a);this.m_target.SetV(a.target);var c=this.m_target.x-this.m_body2.m_xf.position.x,b=this.m_target.y-this.m_body2.m_xf.position.y,d=this.m_body2.m_xf.R;this.m_localAnchor.x=c*d.col1.x+b*d.col1.y;this.m_localAnchor.y=c*d.col2.x+b*d.col2.y;this.m_maxForce=a.maxForce;this.m_impulse.SetZero();b=this.m_body2.m_mass;d=2*b2Settings.b2_pi*a.frequencyHz;c=2*b*a.dampingRatio*d;a=a.timeStep*b*d*d;this.m_gamma=1/(c+a);this.m_beta=a/(c+a)};
b2MouseJoint.prototype.__varz=function(){this.K=new b2Mat22;this.K1=new b2Mat22;this.K2=new b2Mat22;this.m_localAnchor=new b2Vec2;this.m_target=new b2Vec2;this.m_impulse=new b2Vec2;this.m_mass=new b2Mat22;this.m_C=new b2Vec2};b2MouseJoint.prototype.K=new b2Mat22;b2MouseJoint.prototype.K1=new b2Mat22;b2MouseJoint.prototype.K2=new b2Mat22;b2MouseJoint.prototype.m_localAnchor=new b2Vec2;b2MouseJoint.prototype.m_target=new b2Vec2;b2MouseJoint.prototype.m_impulse=new b2Vec2;
b2MouseJoint.prototype.m_mass=new b2Mat22;b2MouseJoint.prototype.m_C=new b2Vec2;b2MouseJoint.prototype.m_maxForce=null;b2MouseJoint.prototype.m_beta=null;b2MouseJoint.prototype.m_gamma=null;b2MouseJoint.prototype.GetAnchor1=function(){return this.m_target};b2MouseJoint.prototype.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor)};b2MouseJoint.prototype.GetReactionForce=function(){return this.m_impulse};b2MouseJoint.prototype.GetReactionTorque=function(){return 0};
b2MouseJoint.prototype.SetTarget=function(a){this.m_body2.IsSleeping()&&this.m_body2.WakeUp();this.m_target=a};
b2MouseJoint.prototype.InitVelocityConstraints=function(a){var c=this.m_body2,b;b=c.m_xf.R;var d=this.m_localAnchor.x-c.m_sweep.localCenter.x,e=this.m_localAnchor.y-c.m_sweep.localCenter.y,f=b.col1.x*d+b.col2.x*e,e=b.col1.y*d+b.col2.y*e,d=f;b=c.m_invMass;f=c.m_invI;this.K1.col1.x=b;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=b;this.K2.col1.x=f*e*e;this.K2.col2.x=-f*d*e;this.K2.col1.y=-f*d*e;this.K2.col2.y=f*d*d;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=
this.m_gamma;this.K.Invert(this.m_mass);this.m_C.x=c.m_sweep.c.x+d-this.m_target.x;this.m_C.y=c.m_sweep.c.y+e-this.m_target.y;c.m_angularVelocity*=0.98;var g=a.dt*this.m_impulse.x,a=a.dt*this.m_impulse.y;c.m_linearVelocity.x+=b*g;c.m_linearVelocity.y+=b*a;c.m_angularVelocity+=f*(d*a-e*g)};
b2MouseJoint.prototype.SolveVelocityConstraints=function(a){var c=this.m_body2,b,d,e;b=c.m_xf.R;var f=this.m_localAnchor.x-c.m_sweep.localCenter.x,g=this.m_localAnchor.y-c.m_sweep.localCenter.y;d=b.col1.x*f+b.col2.x*g;g=b.col1.y*f+b.col2.y*g;f=d;d=c.m_linearVelocity.x+-c.m_angularVelocity*g;var h=c.m_linearVelocity.y+c.m_angularVelocity*f;b=this.m_mass;d=d+this.m_beta*a.inv_dt*this.m_C.x+this.m_gamma*a.dt*this.m_impulse.x;e=h+this.m_beta*a.inv_dt*this.m_C.y+this.m_gamma*a.dt*this.m_impulse.y;h=-a.inv_dt*
(b.col1.x*d+b.col2.x*e);b=-a.inv_dt*(b.col1.y*d+b.col2.y*e);d=this.m_impulse.x;e=this.m_impulse.y;this.m_impulse.x+=h;this.m_impulse.y+=b;h=this.m_impulse.Length();h>this.m_maxForce&&this.m_impulse.Multiply(this.m_maxForce/h);h=this.m_impulse.x-d;b=this.m_impulse.y-e;h*=a.dt;a=a.dt*b;c.m_linearVelocity.x+=c.m_invMass*h;c.m_linearVelocity.y+=c.m_invMass*a;c.m_angularVelocity+=c.m_invI*(f*a-g*h)};b2MouseJoint.prototype.SolvePositionConstraints=function(){return!0};var b2CircleContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2CircleContact.prototype,b2Contact.prototype);b2CircleContact.prototype._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};b2CircleContact.prototype.__constructor=function(a,c){this._super(a,c);this.m_manifold=this.m_manifolds[0];this.m_manifold.pointCount=0;var b=this.m_manifold.points[0];b.normalImpulse=0;b.tangentImpulse=0};
b2CircleContact.prototype.__varz=function(){this.m_manifolds=[new b2Manifold];this.m0=new b2Manifold};b2CircleContact.s_evalCP=new b2ContactPoint;b2CircleContact.Create=function(a,c){return new b2CircleContact(a,c)};b2CircleContact.Destroy=function(){};b2CircleContact.prototype.m_manifolds=[new b2Manifold];b2CircleContact.prototype.m0=new b2Manifold;b2CircleContact.prototype.m_manifold=null;
b2CircleContact.prototype.Evaluate=function(a){var c,b,d;c=this.m_shape1.m_body;b=this.m_shape2.m_body;this.m0.Set(this.m_manifold);b2Collision.b2CollideCircles(this.m_manifold,this.m_shape1,c.m_xf,this.m_shape2,b.m_xf);var e=b2CircleContact.s_evalCP;e.shape1=this.m_shape1;e.shape2=this.m_shape2;e.friction=this.m_friction;e.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){this.m_manifoldCount=1;var f=this.m_manifold.points[0];if(this.m0.pointCount==0){if(f.normalImpulse=0,f.tangentImpulse=
0,a)e.position=c.GetWorldPoint(f.localPoint1),c=c.GetLinearVelocityFromLocalPoint(f.localPoint1),b=b.GetLinearVelocityFromLocalPoint(f.localPoint2),e.velocity.Set(b.x-c.x,b.y-c.y),e.normal.SetV(this.m_manifold.normal),e.separation=f.separation,e.id.key=f.id._key,a.Add(e)}else if(d=this.m0.points[0],f.normalImpulse=d.normalImpulse,f.tangentImpulse=d.tangentImpulse,a)e.position=c.GetWorldPoint(f.localPoint1),c=c.GetLinearVelocityFromLocalPoint(f.localPoint1),b=b.GetLinearVelocityFromLocalPoint(f.localPoint2),
e.velocity.Set(b.x-c.x,b.y-c.y),e.normal.SetV(this.m_manifold.normal),e.separation=f.separation,e.id.key=f.id._key,a.Persist(e)}else if(this.m_manifoldCount=0,this.m0.pointCount>0&&a)d=this.m0.points[0],e.position=c.GetWorldPoint(d.localPoint1),c=c.GetLinearVelocityFromLocalPoint(d.localPoint1),b=b.GetLinearVelocityFromLocalPoint(d.localPoint2),e.velocity.Set(b.x-c.x,b.y-c.y),e.normal.SetV(this.m0.normal),e.separation=d.separation,e.id.key=d.id._key,a.Remove(e)};
b2CircleContact.prototype.GetManifolds=function(){return this.m_manifolds};var b2PulleyJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PulleyJoint.prototype,b2Joint.prototype);b2PulleyJoint.prototype._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
b2PulleyJoint.prototype.__constructor=function(a){this._super(a);this.m_ground=this.m_body1.m_world.m_groundBody;this.m_groundAnchor1.x=a.groundAnchor1.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=a.groundAnchor1.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=a.groundAnchor2.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=a.groundAnchor2.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(a.localAnchor1);this.m_localAnchor2.SetV(a.localAnchor2);this.m_ratio=a.ratio;this.m_constant=
a.length1+this.m_ratio*a.length2;this.m_maxLength1=b2Math.b2Min(a.maxLength1,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength);this.m_maxLength2=b2Math.b2Min(a.maxLength2,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio);this.m_limitForce2=this.m_limitForce1=this.m_force=0};
b2PulleyJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2;this.m_groundAnchor2=new b2Vec2;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_u1=new b2Vec2;this.m_u2=new b2Vec2};b2PulleyJoint.b2_minPulleyLength=2;b2PulleyJoint.prototype.m_ground=null;b2PulleyJoint.prototype.m_groundAnchor1=new b2Vec2;b2PulleyJoint.prototype.m_groundAnchor2=new b2Vec2;b2PulleyJoint.prototype.m_localAnchor1=new b2Vec2;b2PulleyJoint.prototype.m_localAnchor2=new b2Vec2;
b2PulleyJoint.prototype.m_u1=new b2Vec2;b2PulleyJoint.prototype.m_u2=new b2Vec2;b2PulleyJoint.prototype.m_constant=null;b2PulleyJoint.prototype.m_ratio=null;b2PulleyJoint.prototype.m_maxLength1=null;b2PulleyJoint.prototype.m_maxLength2=null;b2PulleyJoint.prototype.m_pulleyMass=null;b2PulleyJoint.prototype.m_limitMass1=null;b2PulleyJoint.prototype.m_limitMass2=null;b2PulleyJoint.prototype.m_force=null;b2PulleyJoint.prototype.m_limitForce1=null;b2PulleyJoint.prototype.m_limitForce2=null;
b2PulleyJoint.prototype.m_positionImpulse=null;b2PulleyJoint.prototype.m_limitPositionImpulse1=null;b2PulleyJoint.prototype.m_limitPositionImpulse2=null;b2PulleyJoint.prototype.m_state=0;b2PulleyJoint.prototype.m_limitState1=0;b2PulleyJoint.prototype.m_limitState2=0;b2PulleyJoint.prototype.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};b2PulleyJoint.prototype.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};
b2PulleyJoint.prototype.GetReactionForce=function(){var a=this.m_u2.Copy();a.Multiply(this.m_force);return a};b2PulleyJoint.prototype.GetReactionTorque=function(){return 0};b2PulleyJoint.prototype.GetGroundAnchor1=function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor1);return a};b2PulleyJoint.prototype.GetGroundAnchor2=function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor2);return a};
b2PulleyJoint.prototype.GetLength1=function(){var a=this.m_body1.GetWorldPoint(this.m_localAnchor1),c=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(c*c+a*a)};b2PulleyJoint.prototype.GetLength2=function(){var a=this.m_body2.GetWorldPoint(this.m_localAnchor2),c=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(c*c+a*a)};
b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio};
b2PulleyJoint.prototype.InitVelocityConstraints=function(a){var c=this.m_body1,b=this.m_body2,d;d=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=d.col1.x*e+d.col2.x*f,f=d.col1.y*e+d.col2.y*f,e=g;d=b.m_xf.R;var h=this.m_localAnchor2.x-b.m_sweep.localCenter.x,i=this.m_localAnchor2.y-b.m_sweep.localCenter.y,g=d.col1.x*h+d.col2.x*i,i=d.col1.y*h+d.col2.y*i,h=g;d=b.m_sweep.c.x+h;var g=b.m_sweep.c.y+i,j=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,
k=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(c.m_sweep.c.x+e-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),c.m_sweep.c.y+f-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(d-j,g-k);d=this.m_u1.Length();g=this.m_u2.Length();d>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/d):this.m_u1.SetZero();g>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/g):this.m_u2.SetZero();this.m_constant-d-this.m_ratio*g>0?(this.m_state=b2Joint.e_inactiveLimit,this.m_force=
0):(this.m_state=b2Joint.e_atUpperLimit,this.m_positionImpulse=0);d<this.m_maxLength1?(this.m_limitState1=b2Joint.e_inactiveLimit,this.m_limitForce1=0):(this.m_limitState1=b2Joint.e_atUpperLimit,this.m_limitPositionImpulse1=0);g<this.m_maxLength2?(this.m_limitState2=b2Joint.e_inactiveLimit,this.m_limitForce2=0):(this.m_limitState2=b2Joint.e_atUpperLimit,this.m_limitPositionImpulse2=0);d=e*this.m_u1.y-f*this.m_u1.x;g=h*this.m_u2.y-i*this.m_u2.x;this.m_limitMass1=c.m_invMass+c.m_invI*d*d;this.m_limitMass2=
b.m_invMass+b.m_invI*g*g;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;a.warmStarting?(d=a.dt*(-this.m_force-this.m_limitForce1)*this.m_u1.x,g=a.dt*(-this.m_force-this.m_limitForce1)*this.m_u1.y,j=a.dt*(-this.m_ratio*this.m_force-this.m_limitForce2)*this.m_u2.x,a=a.dt*(-this.m_ratio*this.m_force-this.m_limitForce2)*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*
d,c.m_linearVelocity.y+=c.m_invMass*g,c.m_angularVelocity+=c.m_invI*(e*g-f*d),b.m_linearVelocity.x+=b.m_invMass*j,b.m_linearVelocity.y+=b.m_invMass*a,b.m_angularVelocity+=b.m_invI*(h*a-i*j)):this.m_limitForce2=this.m_limitForce1=this.m_force=0};
b2PulleyJoint.prototype.SolveVelocityConstraints=function(a){var c=this.m_body1,b=this.m_body2,d;d=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=d.col1.x*e+d.col2.x*f,f=d.col1.y*e+d.col2.y*f,e=g;d=b.m_xf.R;var h=this.m_localAnchor2.x-b.m_sweep.localCenter.x,i=this.m_localAnchor2.y-b.m_sweep.localCenter.y,g=d.col1.x*h+d.col2.x*i,i=d.col1.y*h+d.col2.y*i,h=g,j,k;if(this.m_state==b2Joint.e_atUpperLimit)d=c.m_linearVelocity.x+-c.m_angularVelocity*
f,g=c.m_linearVelocity.y+c.m_angularVelocity*e,j=b.m_linearVelocity.x+-b.m_angularVelocity*i,k=b.m_linearVelocity.y+b.m_angularVelocity*h,d=-(this.m_u1.x*d+this.m_u1.y*g)-this.m_ratio*(this.m_u2.x*j+this.m_u2.y*k),k=-a.inv_dt*this.m_pulleyMass*d,d=this.m_force,this.m_force=b2Math.b2Max(0,this.m_force+k),k=this.m_force-d,d=-a.dt*k*this.m_u1.x,g=-a.dt*k*this.m_u1.y,j=-a.dt*this.m_ratio*k*this.m_u2.x,k=-a.dt*this.m_ratio*k*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*d,c.m_linearVelocity.y+=c.m_invMass*
g,c.m_angularVelocity+=c.m_invI*(e*g-f*d),b.m_linearVelocity.x+=b.m_invMass*j,b.m_linearVelocity.y+=b.m_invMass*k,b.m_angularVelocity+=b.m_invI*(h*k-i*j);if(this.m_limitState1==b2Joint.e_atUpperLimit)d=c.m_linearVelocity.x+-c.m_angularVelocity*f,g=c.m_linearVelocity.y+c.m_angularVelocity*e,d=-(this.m_u1.x*d+this.m_u1.y*g),k=-a.inv_dt*this.m_limitMass1*d,d=this.m_limitForce1,this.m_limitForce1=b2Math.b2Max(0,this.m_limitForce1+k),k=this.m_limitForce1-d,d=-a.dt*k*this.m_u1.x,g=-a.dt*k*this.m_u1.y,c.m_linearVelocity.x+=
c.m_invMass*d,c.m_linearVelocity.y+=c.m_invMass*g,c.m_angularVelocity+=c.m_invI*(e*g-f*d);if(this.m_limitState2==b2Joint.e_atUpperLimit)j=b.m_linearVelocity.x+-b.m_angularVelocity*i,k=b.m_linearVelocity.y+b.m_angularVelocity*h,d=-(this.m_u2.x*j+this.m_u2.y*k),k=-a.inv_dt*this.m_limitMass2*d,d=this.m_limitForce2,this.m_limitForce2=b2Math.b2Max(0,this.m_limitForce2+k),k=this.m_limitForce2-d,j=-a.dt*k*this.m_u2.x,k=-a.dt*k*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*j,b.m_linearVelocity.y+=b.m_invMass*
k,b.m_angularVelocity+=b.m_invI*(h*k-i*j)};
b2PulleyJoint.prototype.SolvePositionConstraints=function(){var a=this.m_body1,c=this.m_body2,b,d=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,e=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,f=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,g=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,h,i,j,k,l,m,n,o=0;if(this.m_state==b2Joint.e_atUpperLimit)b=a.m_xf.R,h=this.m_localAnchor1.x-a.m_sweep.localCenter.x,i=this.m_localAnchor1.y-a.m_sweep.localCenter.y,l=b.col1.x*h+b.col2.x*
i,i=b.col1.y*h+b.col2.y*i,h=l,b=c.m_xf.R,j=this.m_localAnchor2.x-c.m_sweep.localCenter.x,k=this.m_localAnchor2.y-c.m_sweep.localCenter.y,l=b.col1.x*j+b.col2.x*k,k=b.col1.y*j+b.col2.y*k,j=l,l=a.m_sweep.c.x+h,m=a.m_sweep.c.y+i,n=c.m_sweep.c.x+j,b=c.m_sweep.c.y+k,this.m_u1.Set(l-d,m-e),this.m_u2.Set(n-f,b-g),b=this.m_u1.Length(),l=this.m_u2.Length(),b>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/b):this.m_u1.SetZero(),l>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/l):this.m_u2.SetZero(),b=this.m_constant-
b-this.m_ratio*l,o=b2Math.b2Max(o,-b),b=b2Math.b2Clamp(b+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),b*=-this.m_pulleyMass,l=this.m_positionImpulse,this.m_positionImpulse=b2Math.b2Max(0,this.m_positionImpulse+b),b=this.m_positionImpulse-l,l=-b*this.m_u1.x,m=-b*this.m_u1.y,n=-this.m_ratio*b*this.m_u2.x,b=-this.m_ratio*b*this.m_u2.y,a.m_sweep.c.x+=a.m_invMass*l,a.m_sweep.c.y+=a.m_invMass*m,a.m_sweep.a+=a.m_invI*(h*m-i*l),c.m_sweep.c.x+=c.m_invMass*n,c.m_sweep.c.y+=c.m_invMass*b,c.m_sweep.a+=
c.m_invI*(j*b-k*n),a.SynchronizeTransform(),c.SynchronizeTransform();if(this.m_limitState1==b2Joint.e_atUpperLimit)b=a.m_xf.R,h=this.m_localAnchor1.x-a.m_sweep.localCenter.x,i=this.m_localAnchor1.y-a.m_sweep.localCenter.y,l=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=l,l=a.m_sweep.c.x+h,m=a.m_sweep.c.y+i,this.m_u1.Set(l-d,m-e),b=this.m_u1.Length(),b>b2Settings.b2_linearSlop?(this.m_u1.x*=1/b,this.m_u1.y*=1/b):this.m_u1.SetZero(),b=this.m_maxLength1-b,o=b2Math.b2Max(o,-b),b=b2Math.b2Clamp(b+b2Settings.b2_linearSlop,
-b2Settings.b2_maxLinearCorrection,0),b*=-this.m_limitMass1,d=this.m_limitPositionImpulse1,this.m_limitPositionImpulse1=b2Math.b2Max(0,this.m_limitPositionImpulse1+b),b=this.m_limitPositionImpulse1-d,l=-b*this.m_u1.x,m=-b*this.m_u1.y,a.m_sweep.c.x+=a.m_invMass*l,a.m_sweep.c.y+=a.m_invMass*m,a.m_sweep.a+=a.m_invI*(h*m-i*l),a.SynchronizeTransform();if(this.m_limitState2==b2Joint.e_atUpperLimit)b=c.m_xf.R,j=this.m_localAnchor2.x-c.m_sweep.localCenter.x,k=this.m_localAnchor2.y-c.m_sweep.localCenter.y,
l=b.col1.x*j+b.col2.x*k,k=b.col1.y*j+b.col2.y*k,j=l,n=c.m_sweep.c.x+j,b=c.m_sweep.c.y+k,this.m_u2.Set(n-f,b-g),l=this.m_u2.Length(),l>b2Settings.b2_linearSlop?(this.m_u2.x*=1/l,this.m_u2.y*=1/l):this.m_u2.SetZero(),b=this.m_maxLength2-l,o=b2Math.b2Max(o,-b),b=b2Math.b2Clamp(b+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),b*=-this.m_limitMass2,d=this.m_limitPositionImpulse2,this.m_limitPositionImpulse2=b2Math.b2Max(0,this.m_limitPositionImpulse2+b),b=this.m_limitPositionImpulse2-d,
n=-b*this.m_u2.x,b=-b*this.m_u2.y,c.m_sweep.c.x+=c.m_invMass*n,c.m_sweep.c.y+=c.m_invMass*b,c.m_sweep.a+=c.m_invI*(j*b-k*n),c.SynchronizeTransform();return o<b2Settings.b2_linearSlop};var b2RevoluteJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2RevoluteJoint.prototype,b2Joint.prototype);b2RevoluteJoint.prototype._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
b2RevoluteJoint.prototype.__constructor=function(a){this._super(a);this.m_localAnchor1.SetV(a.localAnchor1);this.m_localAnchor2.SetV(a.localAnchor2);this.m_referenceAngle=a.referenceAngle;this.m_pivotForce.Set(0,0);this.m_limitPositionImpulse=this.m_limitForce=this.m_motorForce=0;this.m_lowerAngle=a.lowerAngle;this.m_upperAngle=a.upperAngle;this.m_maxMotorTorque=a.maxMotorTorque;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor};
b2RevoluteJoint.prototype.__varz=function(){this.K=new b2Mat22;this.K1=new b2Mat22;this.K2=new b2Mat22;this.K3=new b2Mat22;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_pivotForce=new b2Vec2;this.m_pivotMass=new b2Mat22};b2RevoluteJoint.tImpulse=new b2Vec2;b2RevoluteJoint.prototype.K=new b2Mat22;b2RevoluteJoint.prototype.K1=new b2Mat22;b2RevoluteJoint.prototype.K2=new b2Mat22;b2RevoluteJoint.prototype.K3=new b2Mat22;b2RevoluteJoint.prototype.m_localAnchor1=new b2Vec2;
b2RevoluteJoint.prototype.m_localAnchor2=new b2Vec2;b2RevoluteJoint.prototype.m_pivotForce=new b2Vec2;b2RevoluteJoint.prototype.m_motorForce=null;b2RevoluteJoint.prototype.m_limitForce=null;b2RevoluteJoint.prototype.m_limitPositionImpulse=null;b2RevoluteJoint.prototype.m_pivotMass=new b2Mat22;b2RevoluteJoint.prototype.m_motorMass=null;b2RevoluteJoint.prototype.m_enableMotor=null;b2RevoluteJoint.prototype.m_maxMotorTorque=null;b2RevoluteJoint.prototype.m_motorSpeed=null;
b2RevoluteJoint.prototype.m_enableLimit=null;b2RevoluteJoint.prototype.m_referenceAngle=null;b2RevoluteJoint.prototype.m_lowerAngle=null;b2RevoluteJoint.prototype.m_upperAngle=null;b2RevoluteJoint.prototype.m_limitState=0;b2RevoluteJoint.prototype.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};b2RevoluteJoint.prototype.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};b2RevoluteJoint.prototype.GetReactionForce=function(){return this.m_pivotForce};
b2RevoluteJoint.prototype.GetReactionTorque=function(){return this.m_limitForce};b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_body2.m_sweep.a-this.m_body1.m_sweep.a-this.m_referenceAngle};b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_body2.m_angularVelocity-this.m_body1.m_angularVelocity};b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit};b2RevoluteJoint.prototype.EnableLimit=function(a){this.m_enableLimit=a};
b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle};b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle};b2RevoluteJoint.prototype.SetLimits=function(a,c){this.m_lowerAngle=a;this.m_upperAngle=c};b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor};b2RevoluteJoint.prototype.EnableMotor=function(a){this.m_enableMotor=a};b2RevoluteJoint.prototype.SetMotorSpeed=function(a){this.m_motorSpeed=a};
b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};b2RevoluteJoint.prototype.SetMaxMotorTorque=function(a){this.m_maxMotorTorque=a};b2RevoluteJoint.prototype.GetMotorTorque=function(){return this.m_motorForce};
b2RevoluteJoint.prototype.InitVelocityConstraints=function(a){var c=this.m_body1,b=this.m_body2,d,e;d=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y;e=d.col1.x*f+d.col2.x*g;g=d.col1.y*f+d.col2.y*g;f=e;d=b.m_xf.R;var h=this.m_localAnchor2.x-b.m_sweep.localCenter.x,i=this.m_localAnchor2.y-b.m_sweep.localCenter.y;e=d.col1.x*h+d.col2.x*i;i=d.col1.y*h+d.col2.y*i;h=e;d=c.m_invMass;e=b.m_invMass;var j=c.m_invI,k=b.m_invI;this.K1.col1.x=d+e;this.K1.col2.x=
0;this.K1.col1.y=0;this.K1.col2.y=d+e;this.K2.col1.x=j*g*g;this.K2.col2.x=-j*f*g;this.K2.col1.y=-j*f*g;this.K2.col2.y=j*f*f;this.K3.col1.x=k*i*i;this.K3.col2.x=-k*h*i;this.K3.col1.y=-k*h*i;this.K3.col2.y=k*h*h;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Invert(this.m_pivotMass);this.m_motorMass=1/(j+k);if(this.m_enableMotor==!1)this.m_motorForce=0;if(this.m_enableLimit){var l=b.m_sweep.a-c.m_sweep.a-this.m_referenceAngle;if(b2Math.b2Abs(this.m_upperAngle-this.m_lowerAngle)<
2*b2Settings.b2_angularSlop)this.m_limitState=b2Joint.e_equalLimits;else if(l<=this.m_lowerAngle){if(this.m_limitState!=b2Joint.e_atLowerLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atLowerLimit}else if(l>=this.m_upperAngle){if(this.m_limitState!=b2Joint.e_atUpperLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atUpperLimit}else this.m_limitState=b2Joint.e_inactiveLimit,this.m_limitForce=0}else this.m_limitForce=0;a.warmStarting?(c.m_linearVelocity.x-=a.dt*d*this.m_pivotForce.x,c.m_linearVelocity.y-=
a.dt*d*this.m_pivotForce.y,c.m_angularVelocity-=a.dt*j*(f*this.m_pivotForce.y-g*this.m_pivotForce.x+this.m_motorForce+this.m_limitForce),b.m_linearVelocity.x+=a.dt*e*this.m_pivotForce.x,b.m_linearVelocity.y+=a.dt*e*this.m_pivotForce.y,b.m_angularVelocity+=a.dt*k*(h*this.m_pivotForce.y-i*this.m_pivotForce.x+this.m_motorForce+this.m_limitForce)):(this.m_pivotForce.SetZero(),this.m_limitForce=this.m_motorForce=0);this.m_limitPositionImpulse=0};
b2RevoluteJoint.prototype.SolveVelocityConstraints=function(a){var c=this.m_body1,b=this.m_body2,d,e;d=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y;e=d.col1.x*f+d.col2.x*g;g=d.col1.y*f+d.col2.y*g;f=e;d=b.m_xf.R;var h=this.m_localAnchor2.x-b.m_sweep.localCenter.x,i=this.m_localAnchor2.y-b.m_sweep.localCenter.y;e=d.col1.x*h+d.col2.x*i;i=d.col1.y*h+d.col2.y*i;h=e;e=b.m_linearVelocity.x+-b.m_angularVelocity*i-c.m_linearVelocity.x- -c.m_angularVelocity*
g;var j=b.m_linearVelocity.y+b.m_angularVelocity*h-c.m_linearVelocity.y-c.m_angularVelocity*f;d=-a.inv_dt*(this.m_pivotMass.col1.x*e+this.m_pivotMass.col2.x*j);e=-a.inv_dt*(this.m_pivotMass.col1.y*e+this.m_pivotMass.col2.y*j);this.m_pivotForce.x+=d;this.m_pivotForce.y+=e;d*=a.dt;e*=a.dt;c.m_linearVelocity.x-=c.m_invMass*d;c.m_linearVelocity.y-=c.m_invMass*e;c.m_angularVelocity-=c.m_invI*(f*e-g*d);b.m_linearVelocity.x+=b.m_invMass*d;b.m_linearVelocity.y+=b.m_invMass*e;b.m_angularVelocity+=b.m_invI*
(h*e-i*d);if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits)f=-a.inv_dt*this.m_motorMass*(b.m_angularVelocity-c.m_angularVelocity-this.m_motorSpeed),g=this.m_motorForce,this.m_motorForce=b2Math.b2Clamp(this.m_motorForce+f,-this.m_maxMotorTorque,this.m_maxMotorTorque),f=this.m_motorForce-g,c.m_angularVelocity-=c.m_invI*a.dt*f,b.m_angularVelocity+=b.m_invI*a.dt*f;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){g=-a.inv_dt*this.m_motorMass*(b.m_angularVelocity-c.m_angularVelocity);
if(this.m_limitState==b2Joint.e_equalLimits)this.m_limitForce+=g;else if(this.m_limitState==b2Joint.e_atLowerLimit)f=this.m_limitForce,this.m_limitForce=b2Math.b2Max(this.m_limitForce+g,0),g=this.m_limitForce-f;else if(this.m_limitState==b2Joint.e_atUpperLimit)f=this.m_limitForce,this.m_limitForce=b2Math.b2Min(this.m_limitForce+g,0),g=this.m_limitForce-f;c.m_angularVelocity-=c.m_invI*a.dt*g;b.m_angularVelocity+=b.m_invI*a.dt*g}};
b2RevoluteJoint.prototype.SolvePositionConstraints=function(){var a,c=this.m_body1,b=this.m_body2,d=0,d=c.m_xf.R,e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=d.col1.x*e+d.col2.x*f,f=d.col1.y*e+d.col2.y*f,e=g,d=b.m_xf.R;a=this.m_localAnchor2.x-b.m_sweep.localCenter.x;var h=this.m_localAnchor2.y-b.m_sweep.localCenter.y,g=d.col1.x*a+d.col2.x*h,h=d.col1.y*a+d.col2.y*h;a=g;var g=b.m_sweep.c.x+a-(c.m_sweep.c.x+e),i=b.m_sweep.c.y+h-(c.m_sweep.c.y+f),d=
Math.sqrt(g*g+i*i),j=c.m_invMass,k=b.m_invMass,l=c.m_invI,m=b.m_invI;this.K1.col1.x=j+k;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=j+k;this.K2.col1.x=l*f*f;this.K2.col2.x=-l*e*f;this.K2.col1.y=-l*e*f;this.K2.col2.y=l*e*e;this.K3.col1.x=m*h*h;this.K3.col2.x=-m*a*h;this.K3.col1.y=-m*a*h;this.K3.col2.y=m*a*a;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(b2RevoluteJoint.tImpulse,-g,-i);g=b2RevoluteJoint.tImpulse.x;i=b2RevoluteJoint.tImpulse.y;c.m_sweep.c.x-=c.m_invMass*
g;c.m_sweep.c.y-=c.m_invMass*i;c.m_sweep.a-=c.m_invI*(e*i-f*g);b.m_sweep.c.x+=b.m_invMass*g;b.m_sweep.c.y+=b.m_invMass*i;b.m_sweep.a+=b.m_invI*(a*i-h*g);c.SynchronizeTransform();b.SynchronizeTransform();e=0;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){a=b.m_sweep.a-c.m_sweep.a-this.m_referenceAngle;f=0;if(this.m_limitState==b2Joint.e_equalLimits)a=b2Math.b2Clamp(a,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection),f=-this.m_motorMass*a,e=b2Math.b2Abs(a);
else if(this.m_limitState==b2Joint.e_atLowerLimit)a-=this.m_lowerAngle,e=b2Math.b2Max(0,-a),a=b2Math.b2Clamp(a+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0),f=-this.m_motorMass*a,a=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+f,0),f=this.m_limitPositionImpulse-a;else if(this.m_limitState==b2Joint.e_atUpperLimit)a-=this.m_upperAngle,e=b2Math.b2Max(0,a),a=b2Math.b2Clamp(a-b2Settings.b2_angularSlop,0,b2Settings.b2_maxAngularCorrection),
f=-this.m_motorMass*a,a=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+f,0),f=this.m_limitPositionImpulse-a;c.m_sweep.a-=c.m_invI*f;b.m_sweep.a+=b.m_invI*f;c.SynchronizeTransform();b.SynchronizeTransform()}return d<=b2Settings.b2_linearSlop&&e<=b2Settings.b2_angularSlop};var b2PrismaticJoint=function(){b2Joint.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PrismaticJoint.prototype,b2Joint.prototype);b2PrismaticJoint.prototype._super=function(){b2Joint.prototype.__constructor.apply(this,arguments)};
b2PrismaticJoint.prototype.__constructor=function(a){this._super(a);this.m_localAnchor1.SetV(a.localAnchor1);this.m_localAnchor2.SetV(a.localAnchor2);this.m_localXAxis1.SetV(a.localAxis1);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=a.referenceAngle;this.m_linearJacobian.SetZero();this.m_torque=this.m_angularMass=this.m_force=this.m_linearMass=0;this.m_motorJacobian.SetZero();this.m_limitPositionImpulse=this.m_limitForce=this.m_motorForce=this.m_motorMass=
0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor};b2PrismaticJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_localXAxis1=new b2Vec2;this.m_localYAxis1=new b2Vec2;this.m_linearJacobian=new b2Jacobian;this.m_motorJacobian=new b2Jacobian};
b2PrismaticJoint.prototype.m_localAnchor1=new b2Vec2;b2PrismaticJoint.prototype.m_localAnchor2=new b2Vec2;b2PrismaticJoint.prototype.m_localXAxis1=new b2Vec2;b2PrismaticJoint.prototype.m_localYAxis1=new b2Vec2;b2PrismaticJoint.prototype.m_refAngle=null;b2PrismaticJoint.prototype.m_linearJacobian=new b2Jacobian;b2PrismaticJoint.prototype.m_linearMass=null;b2PrismaticJoint.prototype.m_force=null;b2PrismaticJoint.prototype.m_angularMass=null;b2PrismaticJoint.prototype.m_torque=null;
b2PrismaticJoint.prototype.m_motorJacobian=new b2Jacobian;b2PrismaticJoint.prototype.m_motorMass=null;b2PrismaticJoint.prototype.m_motorForce=null;b2PrismaticJoint.prototype.m_limitForce=null;b2PrismaticJoint.prototype.m_limitPositionImpulse=null;b2PrismaticJoint.prototype.m_lowerTranslation=null;b2PrismaticJoint.prototype.m_upperTranslation=null;b2PrismaticJoint.prototype.m_maxMotorForce=null;b2PrismaticJoint.prototype.m_motorSpeed=null;b2PrismaticJoint.prototype.m_enableLimit=null;
b2PrismaticJoint.prototype.m_enableMotor=null;b2PrismaticJoint.prototype.m_limitState=0;b2PrismaticJoint.prototype.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)};b2PrismaticJoint.prototype.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)};
b2PrismaticJoint.prototype.GetReactionForce=function(){var a=this.m_body1.m_xf.R;return new b2Vec2(this.m_limitForce*this.m_limitForce*(a.col1.x*this.m_localXAxis1.x+a.col2.x*this.m_localXAxis1.y)+this.m_force*this.m_force*(a.col1.x*this.m_localYAxis1.x+a.col2.x*this.m_localYAxis1.y),this.m_limitForce*this.m_limitForce*(a.col1.y*this.m_localXAxis1.x+a.col2.y*this.m_localXAxis1.y)+this.m_force*this.m_force*(a.col1.y*this.m_localYAxis1.x+a.col2.y*this.m_localYAxis1.y))};
b2PrismaticJoint.prototype.GetReactionTorque=function(){return this.m_torque};b2PrismaticJoint.prototype.GetJointTranslation=function(){var a=this.m_body1,c=this.m_body2,b=a.GetWorldPoint(this.m_localAnchor1),d=c.GetWorldPoint(this.m_localAnchor2),c=d.x-b.x,b=d.y-b.y,a=a.GetWorldVector(this.m_localXAxis1);return a.x*c+a.y*b};
b2PrismaticJoint.prototype.GetJointSpeed=function(){var a=this.m_body1,c=this.m_body2,b;b=a.m_xf.R;var d=this.m_localAnchor1.x-a.m_sweep.localCenter.x,e=this.m_localAnchor1.y-a.m_sweep.localCenter.y,f=b.col1.x*d+b.col2.x*e,e=b.col1.y*d+b.col2.y*e,d=f;b=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y,f=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=f;b=c.m_sweep.c.x+g-(a.m_sweep.c.x+d);var f=c.m_sweep.c.y+h-(a.m_sweep.c.y+e),i=a.GetWorldVector(this.m_localXAxis1),
j=a.m_linearVelocity,k=c.m_linearVelocity,a=a.m_angularVelocity,c=c.m_angularVelocity;return b*-a*i.y+f*a*i.x+(i.x*(k.x+-c*h-j.x- -a*e)+i.y*(k.y+c*g-j.y-a*d))};b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit};b2PrismaticJoint.prototype.EnableLimit=function(a){this.m_enableLimit=a};b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation};
b2PrismaticJoint.prototype.SetLimits=function(a,c){this.m_lowerTranslation=a;this.m_upperTranslation=c};b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor};b2PrismaticJoint.prototype.EnableMotor=function(a){this.m_enableMotor=a};b2PrismaticJoint.prototype.SetMotorSpeed=function(a){this.m_motorSpeed=a};b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};b2PrismaticJoint.prototype.SetMaxMotorForce=function(a){this.m_maxMotorForce=a};
b2PrismaticJoint.prototype.GetMotorForce=function(){return this.m_motorForce};
b2PrismaticJoint.prototype.InitVelocityConstraints=function(a){var c=this.m_body1,b=this.m_body2,d,e;d=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y;e=d.col1.x*f+d.col2.x*g;g=d.col1.y*f+d.col2.y*g;f=e;d=b.m_xf.R;var h=this.m_localAnchor2.x-b.m_sweep.localCenter.x,i=this.m_localAnchor2.y-b.m_sweep.localCenter.y;e=d.col1.x*h+d.col2.x*i;i=d.col1.y*h+d.col2.y*i;h=e;e=c.m_invMass;var j=b.m_invMass,k=c.m_invI,l=b.m_invI;d=c.m_xf.R;var m=d.col1.x*
this.m_localYAxis1.x+d.col2.x*this.m_localYAxis1.y;d=d.col1.y*this.m_localYAxis1.x+d.col2.y*this.m_localYAxis1.y;var n=b.m_sweep.c.x+h-c.m_sweep.c.x,o=b.m_sweep.c.y+i-c.m_sweep.c.y;this.m_linearJacobian.linear1.x=-m;this.m_linearJacobian.linear1.y=-d;this.m_linearJacobian.linear2.x=m;this.m_linearJacobian.linear2.y=d;this.m_linearJacobian.angular1=-(n*d-o*m);this.m_linearJacobian.angular2=h*d-i*m;this.m_linearMass=e+k*this.m_linearJacobian.angular1*this.m_linearJacobian.angular1+j+l*this.m_linearJacobian.angular2*
this.m_linearJacobian.angular2;this.m_linearMass=1/this.m_linearMass;this.m_angularMass=k+l;if(this.m_angularMass>Number.MIN_VALUE)this.m_angularMass=1/this.m_angularMass;if(this.m_enableLimit||this.m_enableMotor)if(d=c.m_xf.R,m=d.col1.x*this.m_localXAxis1.x+d.col2.x*this.m_localXAxis1.y,d=d.col1.y*this.m_localXAxis1.x+d.col2.y*this.m_localXAxis1.y,this.m_motorJacobian.linear1.x=-m,this.m_motorJacobian.linear1.y=-d,this.m_motorJacobian.linear2.x=m,this.m_motorJacobian.linear2.y=d,this.m_motorJacobian.angular1=
-(n*d-o*m),this.m_motorJacobian.angular2=h*d-i*m,this.m_motorMass=e+k*this.m_motorJacobian.angular1*this.m_motorJacobian.angular1+j+l*this.m_motorJacobian.angular2*this.m_motorJacobian.angular2,this.m_motorMass=1/this.m_motorMass,this.m_enableLimit)if(f=m*(n-f)+d*(o-g),b2Math.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop)this.m_limitState=b2Joint.e_equalLimits;else if(f<=this.m_lowerTranslation){if(this.m_limitState!=b2Joint.e_atLowerLimit)this.m_limitForce=0;this.m_limitState=
b2Joint.e_atLowerLimit}else if(f>=this.m_upperTranslation){if(this.m_limitState!=b2Joint.e_atUpperLimit)this.m_limitForce=0;this.m_limitState=b2Joint.e_atUpperLimit}else this.m_limitState=b2Joint.e_inactiveLimit,this.m_limitForce=0;if(this.m_enableMotor==!1)this.m_motorForce=0;if(this.m_enableLimit==!1)this.m_limitForce=0;a.warmStarting?(f=a.dt*(this.m_force*this.m_linearJacobian.linear1.y+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear1.y),g=a.dt*(this.m_force*this.m_linearJacobian.linear2.x+
(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear2.x),h=a.dt*(this.m_force*this.m_linearJacobian.linear2.y+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear2.y),i=a.dt*(this.m_force*this.m_linearJacobian.angular1-this.m_torque+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.angular1),n=a.dt*(this.m_force*this.m_linearJacobian.angular2+this.m_torque+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.angular2),c.m_linearVelocity.x+=e*a.dt*(this.m_force*
this.m_linearJacobian.linear1.x+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear1.x),c.m_linearVelocity.y+=e*f,c.m_angularVelocity+=k*i,b.m_linearVelocity.x+=j*g,b.m_linearVelocity.y+=j*h,b.m_angularVelocity+=l*n):this.m_motorForce=this.m_limitForce=this.m_torque=this.m_force=0;this.m_limitPositionImpulse=0};
b2PrismaticJoint.prototype.SolveVelocityConstraints=function(a){var c=this.m_body1,b=this.m_body2,d=c.m_invMass,e=b.m_invMass,f=c.m_invI,g=b.m_invI,h;h=this.m_linearJacobian.Compute(c.m_linearVelocity,c.m_angularVelocity,b.m_linearVelocity,b.m_angularVelocity);h*=-a.inv_dt*this.m_linearMass;this.m_force+=h;h*=a.dt;c.m_linearVelocity.x+=d*h*this.m_linearJacobian.linear1.x;c.m_linearVelocity.y+=d*h*this.m_linearJacobian.linear1.y;c.m_angularVelocity+=f*h*this.m_linearJacobian.angular1;b.m_linearVelocity.x+=
e*h*this.m_linearJacobian.linear2.x;b.m_linearVelocity.y+=e*h*this.m_linearJacobian.linear2.y;b.m_angularVelocity+=g*h*this.m_linearJacobian.angular2;h=-a.inv_dt*this.m_angularMass*(b.m_angularVelocity-c.m_angularVelocity);this.m_torque+=h;h*=a.dt;c.m_angularVelocity-=f*h;b.m_angularVelocity+=g*h;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){h=this.m_motorJacobian.Compute(c.m_linearVelocity,c.m_angularVelocity,b.m_linearVelocity,b.m_angularVelocity)-this.m_motorSpeed;h*=-a.inv_dt*
this.m_motorMass;var i=this.m_motorForce;this.m_motorForce=b2Math.b2Clamp(this.m_motorForce+h,-this.m_maxMotorForce,this.m_maxMotorForce);h=this.m_motorForce-i;h*=a.dt;c.m_linearVelocity.x+=d*h*this.m_motorJacobian.linear1.x;c.m_linearVelocity.y+=d*h*this.m_motorJacobian.linear1.y;c.m_angularVelocity+=f*h*this.m_motorJacobian.angular1;b.m_linearVelocity.x+=e*h*this.m_motorJacobian.linear2.x;b.m_linearVelocity.y+=e*h*this.m_motorJacobian.linear2.y;b.m_angularVelocity+=g*h*this.m_motorJacobian.angular2}if(this.m_enableLimit&&
this.m_limitState!=b2Joint.e_inactiveLimit){h=this.m_motorJacobian.Compute(c.m_linearVelocity,c.m_angularVelocity,b.m_linearVelocity,b.m_angularVelocity);i=-a.inv_dt*this.m_motorMass*h;if(this.m_limitState==b2Joint.e_equalLimits)this.m_limitForce+=i;else if(this.m_limitState==b2Joint.e_atLowerLimit)h=this.m_limitForce,this.m_limitForce=b2Math.b2Max(this.m_limitForce+i,0),i=this.m_limitForce-h;else if(this.m_limitState==b2Joint.e_atUpperLimit)h=this.m_limitForce,this.m_limitForce=b2Math.b2Min(this.m_limitForce+
i,0),i=this.m_limitForce-h;h=a.dt*i;c.m_linearVelocity.x+=d*h*this.m_motorJacobian.linear1.x;c.m_linearVelocity.y+=d*h*this.m_motorJacobian.linear1.y;c.m_angularVelocity+=f*h*this.m_motorJacobian.angular1;b.m_linearVelocity.x+=e*h*this.m_motorJacobian.linear2.x;b.m_linearVelocity.y+=e*h*this.m_motorJacobian.linear2.y;b.m_angularVelocity+=g*h*this.m_motorJacobian.angular2}};
b2PrismaticJoint.prototype.SolvePositionConstraints=function(){var a,c,b=this.m_body1,d=this.m_body2,e=b.m_invMass,f=d.m_invMass,g=b.m_invI,h=d.m_invI,i;a=b.m_xf.R;var j=this.m_localAnchor1.x-b.m_sweep.localCenter.x,k=this.m_localAnchor1.y-b.m_sweep.localCenter.y;i=a.col1.x*j+a.col2.x*k;k=a.col1.y*j+a.col2.y*k;j=i;a=d.m_xf.R;var l=this.m_localAnchor2.x-d.m_sweep.localCenter.x,m=this.m_localAnchor2.y-d.m_sweep.localCenter.y;i=a.col1.x*l+a.col2.x*m;m=a.col1.y*l+a.col2.y*m;j=b.m_sweep.c.x+j;k=b.m_sweep.c.y+
k;i=d.m_sweep.c.x+i;m=d.m_sweep.c.y+m;a=b.m_xf.R;var n=(a.col1.x*this.m_localYAxis1.x+a.col2.x*this.m_localYAxis1.y)*(i-j)+(a.col1.y*this.m_localYAxis1.x+a.col2.y*this.m_localYAxis1.y)*(m-k),n=b2Math.b2Clamp(n,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);c=-this.m_linearMass*n;b.m_sweep.c.x+=e*c*this.m_linearJacobian.linear1.x;b.m_sweep.c.y+=e*c*this.m_linearJacobian.linear1.y;b.m_sweep.a+=g*c*this.m_linearJacobian.angular1;d.m_sweep.c.x+=f*c*this.m_linearJacobian.linear2.x;
d.m_sweep.c.y+=f*c*this.m_linearJacobian.linear2.y;d.m_sweep.a+=h*c*this.m_linearJacobian.angular2;n=b2Math.b2Abs(n);c=d.m_sweep.a-b.m_sweep.a-this.m_refAngle;c=b2Math.b2Clamp(c,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection);var o=-this.m_angularMass*c;b.m_sweep.a-=b.m_invI*o;d.m_sweep.a+=d.m_invI*o;b.SynchronizeTransform();d.SynchronizeTransform();o=b2Math.b2Abs(c);if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){a=b.m_xf.R;j=this.m_localAnchor1.x-b.m_sweep.localCenter.x;
k=this.m_localAnchor1.y-b.m_sweep.localCenter.y;i=a.col1.x*j+a.col2.x*k;k=a.col1.y*j+a.col2.y*k;j=i;a=d.m_xf.R;l=this.m_localAnchor2.x-d.m_sweep.localCenter.x;m=this.m_localAnchor2.y-d.m_sweep.localCenter.y;i=a.col1.x*l+a.col2.x*m;m=a.col1.y*l+a.col2.y*m;j=b.m_sweep.c.x+j;k=b.m_sweep.c.y+k;i=d.m_sweep.c.x+i;m=d.m_sweep.c.y+m;a=b.m_xf.R;m=(a.col1.x*this.m_localXAxis1.x+a.col2.x*this.m_localXAxis1.y)*(i-j)+(a.col1.y*this.m_localXAxis1.x+a.col2.y*this.m_localXAxis1.y)*(m-k);a=0;if(this.m_limitState==
b2Joint.e_equalLimits)a=b2Math.b2Clamp(m,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),a*=-this.m_motorMass,n=b2Math.b2Max(n,b2Math.b2Abs(c));else if(this.m_limitState==b2Joint.e_atLowerLimit)a=m-this.m_lowerTranslation,n=b2Math.b2Max(n,-a),a=b2Math.b2Clamp(a+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),a*=-this.m_motorMass,c=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+a,0),a=this.m_limitPositionImpulse-
c;else if(this.m_limitState==b2Joint.e_atUpperLimit)a=m-this.m_upperTranslation,n=b2Math.b2Max(n,a),a=b2Math.b2Clamp(a-b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),a*=-this.m_motorMass,c=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+a,0),a=this.m_limitPositionImpulse-c;b.m_sweep.c.x+=e*a*this.m_motorJacobian.linear1.x;b.m_sweep.c.y+=e*a*this.m_motorJacobian.linear1.y;b.m_sweep.a+=g*a*this.m_motorJacobian.angular1;d.m_sweep.c.x+=f*
a*this.m_motorJacobian.linear2.x;d.m_sweep.c.y+=f*a*this.m_motorJacobian.linear2.y;d.m_sweep.a+=h*a*this.m_motorJacobian.angular2;b.SynchronizeTransform();d.SynchronizeTransform()}return n<=b2Settings.b2_linearSlop&&o<=b2Settings.b2_angularSlop};var ClipVertex=function(){this.__varz();this.__constructor.apply(this,arguments)};ClipVertex.prototype.__constructor=function(){};ClipVertex.prototype.__varz=function(){this.v=new b2Vec2;this.id=new b2ContactID};ClipVertex.prototype.v=new b2Vec2;ClipVertex.prototype.id=new b2ContactID;var b2NullContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2NullContact.prototype,b2Contact.prototype);b2NullContact.prototype._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};b2NullContact.prototype.__constructor=function(){};b2NullContact.prototype.__varz=function(){};b2NullContact.prototype.Evaluate=function(){};b2NullContact.prototype.GetManifolds=function(){return null};var b2PolyAndCircleContact=function(){b2Contact.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2PolyAndCircleContact.prototype,b2Contact.prototype);b2PolyAndCircleContact.prototype._super=function(){b2Contact.prototype.__constructor.apply(this,arguments)};
b2PolyAndCircleContact.prototype.__constructor=function(a,c){this._super(a,c);this.m_manifold=this.m_manifolds[0];b2Settings.b2Assert(this.m_shape1.m_type==b2Shape.e_polygonShape);b2Settings.b2Assert(this.m_shape2.m_type==b2Shape.e_circleShape);this.m_manifold.pointCount=0;var b=this.m_manifold.points[0];b.normalImpulse=0;b.tangentImpulse=0};b2PolyAndCircleContact.prototype.__varz=function(){this.m_manifolds=[new b2Manifold];this.m0=new b2Manifold};b2PolyAndCircleContact.s_evalCP=new b2ContactPoint;
b2PolyAndCircleContact.Create=function(a,c){return new b2PolyAndCircleContact(a,c)};b2PolyAndCircleContact.Destroy=function(){};b2PolyAndCircleContact.prototype.m_manifolds=[new b2Manifold];b2PolyAndCircleContact.prototype.m0=new b2Manifold;b2PolyAndCircleContact.prototype.m_manifold=null;
b2PolyAndCircleContact.prototype.Evaluate=function(a){var c=0,b,d,e,f=this.m_shape1.m_body,g=this.m_shape2.m_body;this.m0.Set(this.m_manifold);b2Collision.b2CollidePolygonAndCircle(this.m_manifold,this.m_shape1,f.m_xf,this.m_shape2,g.m_xf);var h=[!1,!1],i=b2PolyAndCircleContact.s_evalCP;i.shape1=this.m_shape1;i.shape2=this.m_shape2;i.friction=this.m_friction;i.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){for(c=0;c<this.m_manifold.pointCount;++c){var j=this.m_manifold.points[c];
j.normalImpulse=0;j.tangentImpulse=0;var k=!1,l=j.id._key;for(b=0;b<this.m0.pointCount;++b)if(h[b]!=!0&&(e=this.m0.points[b],e.id._key==l)){h[b]=!0;j.normalImpulse=e.normalImpulse;j.tangentImpulse=e.tangentImpulse;k=!0;if(a!=null)i.position=f.GetWorldPoint(j.localPoint1),b=f.GetLinearVelocityFromLocalPoint(j.localPoint1),d=g.GetLinearVelocityFromLocalPoint(j.localPoint2),i.velocity.Set(d.x-b.x,d.y-b.y),i.normal.SetV(this.m_manifold.normal),i.separation=j.separation,i.id.key=l,a.Persist(i);break}if(k==
!1&&a!=null)i.position=f.GetWorldPoint(j.localPoint1),b=f.GetLinearVelocityFromLocalPoint(j.localPoint1),d=g.GetLinearVelocityFromLocalPoint(j.localPoint2),i.velocity.Set(d.x-b.x,d.y-b.y),i.normal.SetV(this.m_manifold.normal),i.separation=j.separation,i.id.key=l,a.Add(i)}this.m_manifoldCount=1}else this.m_manifoldCount=0;if(a!=null)for(c=0;c<this.m0.pointCount;++c)if(!h[c])e=this.m0.points[c],i.position=f.GetWorldPoint(e.localPoint1),b=f.GetLinearVelocityFromLocalPoint(e.localPoint1),d=g.GetLinearVelocityFromLocalPoint(e.localPoint2),
i.velocity.Set(d.x-b.x,d.y-b.y),i.normal.SetV(this.m0.normal),i.separation=e.separation,i.id.key=e.id._key,a.Remove(i)};b2PolyAndCircleContact.prototype.GetManifolds=function(){return this.m_manifolds};var b2ContactManager=function(){b2PairCallback.prototype.__varz.call(this);this.__varz();this.__constructor.apply(this,arguments)};extend(b2ContactManager.prototype,b2PairCallback.prototype);b2ContactManager.prototype._super=function(){b2PairCallback.prototype.__constructor.apply(this,arguments)};b2ContactManager.prototype.__constructor=function(){this.m_world=null;this.m_destroyImmediate=!1};b2ContactManager.prototype.__varz=function(){this.m_nullContact=new b2NullContact};
b2ContactManager.s_evalCP=new b2ContactPoint;b2ContactManager.prototype.m_world=null;b2ContactManager.prototype.m_nullContact=new b2NullContact;b2ContactManager.prototype.m_destroyImmediate=null;
b2ContactManager.prototype.PairAdded=function(a,c){var b=a,d=c,e=b.m_body,f=d.m_body;if(e.IsStatic()&&f.IsStatic())return this.m_nullContact;if(b.m_body==d.m_body)return this.m_nullContact;if(f.IsConnected(e))return this.m_nullContact;if(this.m_world.m_contactFilter!=null&&this.m_world.m_contactFilter.ShouldCollide(b,d)==!1)return this.m_nullContact;var g=b2Contact.Create(b,d,this.m_world.m_blockAllocator);if(g==null)return this.m_nullContact;b=g.m_shape1;d=g.m_shape2;e=b.m_body;f=d.m_body;g.m_prev=
null;g.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null)this.m_world.m_contactList.m_prev=g;this.m_world.m_contactList=g;g.m_node1.contact=g;g.m_node1.other=f;g.m_node1.prev=null;g.m_node1.next=e.m_contactList;if(e.m_contactList!=null)e.m_contactList.prev=g.m_node1;e.m_contactList=g.m_node1;g.m_node2.contact=g;g.m_node2.other=e;g.m_node2.prev=null;g.m_node2.next=f.m_contactList;if(f.m_contactList!=null)f.m_contactList.prev=g.m_node2;f.m_contactList=g.m_node2;++this.m_world.m_contactCount;
return g};b2ContactManager.prototype.PairRemoved=function(a,c,b){b!=null&&b!=this.m_nullContact&&this.Destroy(b)};
b2ContactManager.prototype.Destroy=function(a){var c=a.m_shape1,b=a.m_shape2,d=a.m_manifoldCount;if(d>0&&this.m_world.m_contactListener){var e=c.m_body,f=b.m_body,g=a.GetManifolds(),h=b2ContactManager.s_evalCP;h.shape1=a.m_shape1;h.shape2=a.m_shape2;h.friction=a.m_friction;h.restitution=a.m_restitution;for(var i=0;i<d;++i){var j=g[i];h.normal.SetV(j.normal);for(var k=0;k<j.pointCount;++k){var l=j.points[k];h.position=e.GetWorldPoint(l.localPoint1);var m=e.GetLinearVelocityFromLocalPoint(l.localPoint1),
n=f.GetLinearVelocityFromLocalPoint(l.localPoint2);h.velocity.Set(n.x-m.x,n.y-m.y);h.separation=l.separation;h.id.key=l.id._key;this.m_world.m_contactListener.Remove(h)}}}if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_world.m_contactList)this.m_world.m_contactList=a.m_next;c=c.m_body;b=b.m_body;if(a.m_node1.prev)a.m_node1.prev.next=a.m_node1.next;if(a.m_node1.next)a.m_node1.next.prev=a.m_node1.prev;if(a.m_node1==c.m_contactList)c.m_contactList=a.m_node1.next;
if(a.m_node2.prev)a.m_node2.prev.next=a.m_node2.next;if(a.m_node2.next)a.m_node2.next.prev=a.m_node2.prev;if(a.m_node2==b.m_contactList)b.m_contactList=a.m_node2.next;b2Contact.Destroy(a,this.m_world.m_blockAllocator);--this.m_world.m_contactCount};b2ContactManager.prototype.Collide=function(){for(var a=this.m_world.m_contactList;a;a=a.m_next){var c=a.m_shape2.m_body;(!a.m_shape1.m_body.IsSleeping()||!c.IsSleeping())&&a.Update(this.m_world.m_contactListener)}};var b2World=function(){this.__varz();this.__constructor.apply(this,arguments)};
b2World.prototype.__constructor=function(a,c,b){this.m_boundaryListener=this.m_destructionListener=null;this.m_contactFilter=b2ContactFilter.b2_defaultFilter;this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_contactListener=null;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;b2World.m_positionCorrection=!0;b2World.m_warmStarting=!0;b2World.m_continuousPhysics=!0;this.m_allowSleep=b;this.m_gravity=c;this.m_lock=!1;this.m_inv_dt0=0;this.m_contactManager.m_world=this;
this.m_broadPhase=new b2BroadPhase(a,this.m_contactManager);this.m_groundBody=this.CreateBody(new b2BodyDef)};b2World.prototype.__varz=function(){this.m_contactManager=new b2ContactManager};b2World.m_positionCorrection=null;b2World.m_warmStarting=null;b2World.m_continuousPhysics=null;b2World.s_jointColor=new b2Color(0.5,0.8,0.8);b2World.s_coreColor=new b2Color(0.9,0.6,0.6);b2World.s_xf=new b2XForm;b2World.prototype.m_blockAllocator=null;b2World.prototype.m_stackAllocator=null;
b2World.prototype.m_lock=null;b2World.prototype.m_broadPhase=null;b2World.prototype.m_contactManager=new b2ContactManager;b2World.prototype.m_bodyList=null;b2World.prototype.m_jointList=null;b2World.prototype.m_contactList=null;b2World.prototype.m_bodyCount=0;b2World.prototype.m_contactCount=0;b2World.prototype.m_jointCount=0;b2World.prototype.m_gravity=null;b2World.prototype.m_allowSleep=null;b2World.prototype.m_groundBody=null;b2World.prototype.m_destructionListener=null;
b2World.prototype.m_boundaryListener=null;b2World.prototype.m_contactFilter=null;b2World.prototype.m_contactListener=null;b2World.prototype.m_debugDraw=null;b2World.prototype.m_inv_dt0=null;b2World.prototype.m_positionIterationCount=0;b2World.prototype.SetDestructionListener=function(a){this.m_destructionListener=a};b2World.prototype.SetBoundaryListener=function(a){this.m_boundaryListener=a};b2World.prototype.SetContactFilter=function(a){this.m_contactFilter=a};
b2World.prototype.SetContactListener=function(a){this.m_contactListener=a};b2World.prototype.SetDebugDraw=function(a){this.m_debugDraw=a};b2World.prototype.Validate=function(){this.m_broadPhase.Validate()};b2World.prototype.GetProxyCount=function(){return this.m_broadPhase.m_proxyCount};b2World.prototype.GetPairCount=function(){return this.m_broadPhase.m_pairManager.m_pairCount};
b2World.prototype.CreateBody=function(a){if(this.m_lock==!0)return null;a=new b2Body(a,this);a.m_prev=null;if(a.m_next=this.m_bodyList)this.m_bodyList.m_prev=a;this.m_bodyList=a;++this.m_bodyCount;return a};
b2World.prototype.DestroyBody=function(a){if(this.m_lock!=!0){for(var c=a.m_jointList;c;){var b=c,c=c.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(b.joint);this.DestroyJoint(b.joint)}for(c=a.m_shapeList;c;)b=c,c=c.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeShape(b),b.DestroyProxy(this.m_broadPhase),b2Shape.Destroy(b,this.m_blockAllocator);if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_bodyList)this.m_bodyList=
a.m_next;--this.m_bodyCount}};
b2World.prototype.CreateJoint=function(a){var c=b2Joint.Create(a,this.m_blockAllocator);c.m_prev=null;if(c.m_next=this.m_jointList)this.m_jointList.m_prev=c;this.m_jointList=c;++this.m_jointCount;c.m_node1.joint=c;c.m_node1.other=c.m_body2;c.m_node1.prev=null;if(c.m_node1.next=c.m_body1.m_jointList)c.m_body1.m_jointList.prev=c.m_node1;c.m_body1.m_jointList=c.m_node1;c.m_node2.joint=c;c.m_node2.other=c.m_body1;c.m_node2.prev=null;if(c.m_node2.next=c.m_body2.m_jointList)c.m_body2.m_jointList.prev=c.m_node2;
c.m_body2.m_jointList=c.m_node2;if(a.collideConnected==!1)for(var a=a.body1.m_shapeCount<a.body2.m_shapeCount?a.body1:a.body2,b=a.m_shapeList;b;b=b.m_next)b.RefilterProxy(this.m_broadPhase,a.m_xf);return c};
b2World.prototype.DestroyJoint=function(a){var c=a.m_collideConnected;if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_jointList)this.m_jointList=a.m_next;var b=a.m_body1,d=a.m_body2;b.WakeUp();d.WakeUp();if(a.m_node1.prev)a.m_node1.prev.next=a.m_node1.next;if(a.m_node1.next)a.m_node1.next.prev=a.m_node1.prev;if(a.m_node1==b.m_jointList)b.m_jointList=a.m_node1.next;a.m_node1.prev=null;a.m_node1.next=null;if(a.m_node2.prev)a.m_node2.prev.next=a.m_node2.next;if(a.m_node2.next)a.m_node2.next.prev=
a.m_node2.prev;if(a.m_node2==d.m_jointList)d.m_jointList=a.m_node2.next;a.m_node2.prev=null;a.m_node2.next=null;b2Joint.Destroy(a,this.m_blockAllocator);--this.m_jointCount;if(c==!1){a=b.m_shapeCount<d.m_shapeCount?b:d;for(c=a.m_shapeList;c;c=c.m_next)c.RefilterProxy(this.m_broadPhase,a.m_xf)}};b2World.prototype.Refilter=function(a){a.RefilterProxy(this.m_broadPhase,a.m_body.m_xf)};b2World.prototype.SetWarmStarting=function(a){b2World.m_warmStarting=a};
b2World.prototype.SetPositionCorrection=function(a){b2World.m_positionCorrection=a};b2World.prototype.SetContinuousPhysics=function(a){b2World.m_continuousPhysics=a};b2World.prototype.GetBodyCount=function(){return this.m_bodyCount};b2World.prototype.GetJointCount=function(){return this.m_jointCount};b2World.prototype.GetContactCount=function(){return this.m_contactCount};b2World.prototype.SetGravity=function(a){this.m_gravity=a};b2World.prototype.GetGroundBody=function(){return this.m_groundBody};
b2World.prototype.Step=function(a,c){this.m_lock=!0;var b=new b2TimeStep;b.dt=a;b.maxIterations=c;b.inv_dt=a>0?1/a:0;b.dtRatio=this.m_inv_dt0*a;b.positionCorrection=b2World.m_positionCorrection;b.warmStarting=b2World.m_warmStarting;this.m_contactManager.Collide();b.dt>0&&this.Solve(b);b2World.m_continuousPhysics&&b.dt>0&&this.SolveTOI(b);this.DrawDebugData();this.m_inv_dt0=b.inv_dt;this.m_lock=!1};
b2World.prototype.Query=function(a,c,b){for(var d=Array(b),a=this.m_broadPhase.QueryAABB(a,d,b),b=0;b<a;++b)c[b]=d[b];return a};b2World.prototype.GetBodyList=function(){return this.m_bodyList};b2World.prototype.GetJointList=function(){return this.m_jointList};
b2World.prototype.Solve=function(a){var c;this.m_positionIterationCount=0;var b=new b2Island(this.m_bodyCount,this.m_contactCount,this.m_jointCount,this.m_stackAllocator,this.m_contactListener);for(c=this.m_bodyList;c;c=c.m_next)c.m_flags&=~b2Body.e_islandFlag;for(var d=this.m_contactList;d;d=d.m_next)d.m_flags&=~b2Contact.e_islandFlag;for(d=this.m_jointList;d;d=d.m_next)d.m_islandFlag=!1;for(var d=Array(this.m_bodyCount),e=this.m_bodyList;e;e=e.m_next)if(!(e.m_flags&(b2Body.e_islandFlag|b2Body.e_sleepFlag|
b2Body.e_frozenFlag))&&!e.IsStatic()){b.Clear();var f=0;d[f++]=e;for(e.m_flags|=b2Body.e_islandFlag;f>0;)if(c=d[--f],b.AddBody(c),c.m_flags&=~b2Body.e_sleepFlag,!c.IsStatic()){for(var g,h=c.m_contactList;h;h=h.next)if(!(h.contact.m_flags&(b2Contact.e_islandFlag|b2Contact.e_nonSolidFlag))&&h.contact.m_manifoldCount!=0)b.AddContact(h.contact),h.contact.m_flags|=b2Contact.e_islandFlag,g=h.other,g.m_flags&b2Body.e_islandFlag||(d[f++]=g,g.m_flags|=b2Body.e_islandFlag);for(c=c.m_jointList;c;c=c.next)if(c.joint.m_islandFlag!=
!0)b.AddJoint(c.joint),c.joint.m_islandFlag=!0,g=c.other,g.m_flags&b2Body.e_islandFlag||(d[f++]=g,g.m_flags|=b2Body.e_islandFlag)}b.Solve(a,this.m_gravity,b2World.m_positionCorrection,this.m_allowSleep);if(b.m_positionIterationCount>this.m_positionIterationCount)this.m_positionIterationCount=b.m_positionIterationCount;for(f=0;f<b.m_bodyCount;++f)c=b.m_bodies[f],c.IsStatic()&&(c.m_flags&=~b2Body.e_islandFlag)}for(c=this.m_bodyList;c;c=c.m_next)c.m_flags&(b2Body.e_sleepFlag|b2Body.e_frozenFlag)||c.IsStatic()||
c.SynchronizeShapes()==!1&&this.m_boundaryListener!=null&&this.m_boundaryListener.Violation(c);this.m_broadPhase.Commit()};
b2World.prototype.SolveTOI=function(a){var c,b,d,e=new b2Island(this.m_bodyCount,b2Settings.b2_maxTOIContactsPerIsland,0,this.m_stackAllocator,this.m_contactListener),f=Array(this.m_bodyCount);for(c=this.m_bodyList;c;c=c.m_next)c.m_flags&=~b2Body.e_islandFlag,c.m_sweep.t0=0;var g;for(g=this.m_contactList;g;g=g.m_next)g.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(;;){c=null;var h=1;for(g=this.m_contactList;g;g=g.m_next)if(!(g.m_flags&(b2Contact.e_slowFlag|b2Contact.e_nonSolidFlag))){b=
1;if(g.m_flags&b2Contact.e_toiFlag)b=g.m_toi;else{b=g.m_shape1;d=g.m_shape2;b=b.m_body;d=d.m_body;if((b.IsStatic()||b.IsSleeping())&&(d.IsStatic()||d.IsSleeping()))continue;var i=b.m_sweep.t0;if(b.m_sweep.t0<d.m_sweep.t0)i=d.m_sweep.t0,b.m_sweep.Advance(i);else if(d.m_sweep.t0<b.m_sweep.t0)i=b.m_sweep.t0,d.m_sweep.Advance(i);b=b2TimeOfImpact.TimeOfImpact(g.m_shape1,b.m_sweep,g.m_shape2,d.m_sweep);b>0&&b<1&&(b=(1-b)*i+b,b>1&&(b=1));g.m_toi=b;g.m_flags|=b2Contact.e_toiFlag}Number.MIN_VALUE<b&&b<h&&
(c=g,h=b)}if(c==null||1-100*Number.MIN_VALUE<h)break;b=c.m_shape1;d=c.m_shape2;b=b.m_body;d=d.m_body;b.Advance(h);d.Advance(h);c.Update(this.m_contactListener);c.m_flags&=~b2Contact.e_toiFlag;if(c.m_manifoldCount!=0){c=b;c.IsStatic()&&(c=d);e.Clear();g=0;f[g++]=c;for(c.m_flags|=b2Body.e_islandFlag;g>0;)if(c=f[--g],e.AddBody(c),c.m_flags&=~b2Body.e_sleepFlag,!c.IsStatic())for(c=c.m_contactList;c;c=c.next)if(e.m_contactCount!=e.m_contactCapacity&&!(c.contact.m_flags&(b2Contact.e_islandFlag|b2Contact.e_slowFlag|
b2Contact.e_nonSolidFlag))&&c.contact.m_manifoldCount!=0)e.AddContact(c.contact),c.contact.m_flags|=b2Contact.e_islandFlag,b=c.other,b.m_flags&b2Body.e_islandFlag||(b.IsStatic()==!1&&(b.Advance(h),b.WakeUp()),f[g++]=b,b.m_flags|=b2Body.e_islandFlag);g=new b2TimeStep;g.dt=(1-h)*a.dt;g.inv_dt=1/g.dt;g.maxIterations=a.maxIterations;e.SolveTOI(g);for(h=h=0;h<e.m_bodyCount;++h)if(c=e.m_bodies[h],c.m_flags&=~b2Body.e_islandFlag,!(c.m_flags&(b2Body.e_sleepFlag|b2Body.e_frozenFlag))&&!c.IsStatic()){c.SynchronizeShapes()==
!1&&this.m_boundaryListener!=null&&this.m_boundaryListener.Violation(c);for(c=c.m_contactList;c;c=c.next)c.contact.m_flags&=~b2Contact.e_toiFlag}for(h=0;h<e.m_contactCount;++h)g=e.m_contacts[h],g.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);this.m_broadPhase.Commit()}}};
b2World.prototype.DrawJoint=function(a){var c=a.m_body1,b=a.m_body2,d=c.m_xf.position,e=b.m_xf.position,f=a.GetAnchor1(),g=a.GetAnchor2(),h=b2World.s_jointColor;switch(a.m_type){case b2Joint.e_distanceJoint:this.m_debugDraw.DrawSegment(f,g,h);break;case b2Joint.e_pulleyJoint:c=a.GetGroundAnchor1();a=a.GetGroundAnchor2();this.m_debugDraw.DrawSegment(c,f,h);this.m_debugDraw.DrawSegment(a,g,h);this.m_debugDraw.DrawSegment(c,a,h);break;case b2Joint.e_mouseJoint:this.m_debugDraw.DrawSegment(f,g,h);break;
default:c!=this.m_groundBody&&this.m_debugDraw.DrawSegment(d,f,h),this.m_debugDraw.DrawSegment(f,g,h),b!=this.m_groundBody&&this.m_debugDraw.DrawSegment(e,g,h)}};
b2World.prototype.DrawShape=function(a,c,b,d){var e=b2World.s_coreColor;switch(a.m_type){case b2Shape.e_circleShape:var f=b2Math.b2MulX(c,a.m_localPosition),a=a.m_radius;this.m_debugDraw.DrawSolidCircle(f,a,c.R.col1,b);d&&this.m_debugDraw.DrawCircle(f,a-b2Settings.b2_toiSlop,e);break;case b2Shape.e_polygonShape:for(var f=0,g=a.GetVertexCount(),h=a.GetVertices(),i=Array(b2Settings.b2_maxPolygonVertices),f=0;f<g;++f)i[f]=b2Math.b2MulX(c,h[f]);this.m_debugDraw.DrawSolidPolygon(i,g,b);if(d){b=a.GetCoreVertices();
for(f=0;f<g;++f)i[f]=b2Math.b2MulX(c,b[f]);this.m_debugDraw.DrawPolygon(i,g,e)}}};
b2World.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var a=this.m_debugDraw.GetFlags(),c=0,b,d,e=new b2Vec2,f=new b2Vec2,g=new b2Vec2,h=new b2Color(0,0,0),i,j=new b2AABB,k=new b2AABB,l=[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2];if(a&b2DebugDraw.e_shapeBit){c=(a&b2DebugDraw.e_coreShapeBit)==b2DebugDraw.e_coreShapeBit;for(b=this.m_bodyList;b;b=b.m_next){i=b.m_xf;for(d=b.GetShapeList();d;d=d.m_next)b.IsStatic()?this.DrawShape(d,i,new b2Color(0.5,
0.9,0.5),c):b.IsSleeping()?this.DrawShape(d,i,new b2Color(0.5,0.5,0.9),c):this.DrawShape(d,i,new b2Color(0.9,0.9,0.9),c)}}if(a&b2DebugDraw.e_jointBit)for(c=this.m_jointList;c;c=c.m_next)this.DrawJoint(c);if(a&b2DebugDraw.e_pairBit){b=this.m_broadPhase;e.Set(1/b.m_quantizationFactor.x,1/b.m_quantizationFactor.y);h.Set(0.9,0.9,0.3);for(c=0;c<b2Pair.b2_tableCapacity;++c)for(d=b.m_pairManager.m_hashTable[c];d!=b2Pair.b2_nullPair;){d=b.m_pairManager.m_pairs[d];i=b.m_proxyPool[d.proxyId1];var m=b.m_proxyPool[d.proxyId2];
j.lowerBound.x=b.m_worldAABB.lowerBound.x+e.x*b.m_bounds[0][i.lowerBounds[0]].value;j.lowerBound.y=b.m_worldAABB.lowerBound.y+e.y*b.m_bounds[1][i.lowerBounds[1]].value;j.upperBound.x=b.m_worldAABB.lowerBound.x+e.x*b.m_bounds[0][i.upperBounds[0]].value;j.upperBound.y=b.m_worldAABB.lowerBound.y+e.y*b.m_bounds[1][i.upperBounds[1]].value;k.lowerBound.x=b.m_worldAABB.lowerBound.x+e.x*b.m_bounds[0][m.lowerBounds[0]].value;k.lowerBound.y=b.m_worldAABB.lowerBound.y+e.y*b.m_bounds[1][m.lowerBounds[1]].value;
k.upperBound.x=b.m_worldAABB.lowerBound.x+e.x*b.m_bounds[0][m.upperBounds[0]].value;k.upperBound.y=b.m_worldAABB.lowerBound.y+e.y*b.m_bounds[1][m.upperBounds[1]].value;f.x=0.5*(j.lowerBound.x+j.upperBound.x);f.y=0.5*(j.lowerBound.y+j.upperBound.y);g.x=0.5*(k.lowerBound.x+k.upperBound.x);g.y=0.5*(k.lowerBound.y+k.upperBound.y);this.m_debugDraw.DrawSegment(f,g,h);d=d.next}}if(a&b2DebugDraw.e_aabbBit){b=this.m_broadPhase;f=b.m_worldAABB.lowerBound;g=b.m_worldAABB.upperBound;e.Set(1/b.m_quantizationFactor.x,
1/b.m_quantizationFactor.y);h.Set(0.9,0.3,0.9);for(c=0;c<b2Settings.b2_maxProxies;++c)if(k=b.m_proxyPool[c],k.IsValid()!=!1)j.lowerBound.x=f.x+e.x*b.m_bounds[0][k.lowerBounds[0]].value,j.lowerBound.y=f.y+e.y*b.m_bounds[1][k.lowerBounds[1]].value,j.upperBound.x=f.x+e.x*b.m_bounds[0][k.upperBounds[0]].value,j.upperBound.y=f.y+e.y*b.m_bounds[1][k.upperBounds[1]].value,l[0].Set(j.lowerBound.x,j.lowerBound.y),l[1].Set(j.upperBound.x,j.lowerBound.y),l[2].Set(j.upperBound.x,j.upperBound.y),l[3].Set(j.lowerBound.x,
j.upperBound.y),this.m_debugDraw.DrawPolygon(l,4,h);l[0].Set(f.x,f.y);l[1].Set(g.x,f.y);l[2].Set(g.x,g.y);l[3].Set(f.x,g.y);this.m_debugDraw.DrawPolygon(l,4,new b2Color(0.3,0.9,0.9))}if(a&b2DebugDraw.e_obbBit){h.Set(0.5,0.3,0.5);for(b=this.m_bodyList;b;b=b.m_next){i=b.m_xf;for(d=b.GetShapeList();d;d=d.m_next)if(d.m_type==b2Shape.e_polygonShape){e=d.GetOBB();c=e.extents;l[0].Set(-c.x,-c.y);l[1].Set(c.x,-c.y);l[2].Set(c.x,c.y);l[3].Set(-c.x,c.y);for(c=0;c<4;++c)j=e.R,f=l[c],g=e.center.x+(j.col1.x*f.x+
j.col2.x*f.y),l[c].y=e.center.y+(j.col1.y*f.x+j.col2.y*f.y),l[c].x=g,j=i.R,g=i.position.x+(j.col1.x*f.x+j.col2.x*f.y),l[c].y=i.position.y+(j.col1.y*f.x+j.col2.y*f.y),l[c].x=g;this.m_debugDraw.DrawPolygon(l,4,h)}}}if(a&b2DebugDraw.e_centerOfMassBit)for(b=this.m_bodyList;b;b=b.m_next)i=b2World.s_xf,i.R=b.m_xf.R,i.position=b.GetWorldCenter(),this.m_debugDraw.DrawXForm(i)}};
